See GGR4.100.changes for the original changes around moving from 3.9e to
pK4.0.15.

========== GGR4.101 [21 Feb 2017]

.gitignore
CHANGES
   Files added.

Makefile:
   Change the PROGRAM build from em to uemacs

epath.h:
   Fix a left-over from build testing - change the startup file name
   from  nuemacs.rc to uemacs.rc

word.c
   Change justpara() so that it can handle unicode characters, based on
   the fillpara() code from merging.
   Get the correct indent from column, not byte offset.
   Handle leading whitespace in the paragraph to reformat.
   Make the temporary buffer dynamically allocated, to cater for long
   strings with no spaces.
   Add punctuation handling in ggr-mode.

etc/uemacs.rc
   Bind EscR to search-reverse (not the default replace-string).

etc/uemacs.hlp
   Put back that Metas that had been changed to Esc.

complet.c
   Replace strncpy() calls to populate choices with memcpy(), as we
   have to nul-terminate manually anyway.

eval.c
exec.c
input.c
   Replace strncpy() calls followed by "manual" nul-termination with
   memcpy() ones.

lock.c
   Replace strncpy() call into tmpname with just strcpy(), as fname
   can't be more the NFILEN anyway.

README
readme.39e
   Moved both to the archive directory.

version.h
etc/uemacs.hlp
   Update to version GGR4.101

========== GGR4.102 [22 Feb 2017]

word.c
   Right-justification in fillpara() was leaving an extra space at eol
   after a punctuation mark.
   Increment gap as well if dotflag is set.

word.c
   justify-paragraph (Esc-J) changes had stopped it working at the
   start of a buffer and if there was no whitespace at the start of the
   paragraph.
   Ignore whitedelete() result and force w_doto to 0 (since at the
   start of the buffer it seems to end up as 1).

buffer,c
   Just entering <CR> when prompted for "Use buffer:" (^XB) used to
   take you back to the last one, but now takes you to "main".
   Add back a save of b_name to savnam in swbuffer() missed in the
   migration.

tcap.c
display.c
   Add test for SCROLLCODE around some declarations to avoid
   compilation warnings if this is turned off.

version.h
etc/uemacs.hlp
   Update to version GGR4.102

========== GGR4.103 [22 Feb 2017]

display.c
   Fix a display issue on de-extending a line (coming back to <~col 80
   after having gone beyond there on a long line).
   Looks like a code migration issue.  The loop in upddex() contained
   the 3.9e code, but with the now-absent w_fcol changed to w_fcolor,
   which was set to 7 resulting in an off-by-7 on the redisplay (the
   underlying data was OK, so a redisplay fixed things).
   Replaced with the 4.1 code (but kept the GGR fix on the loop
   constraint).

version.h
etc/uemacs.hlp
   Update to version GGR4.103

========== GGR4.104 [22 Feb 2017]

input.c
   Ensure that getstring doesn't return a garbage buffer, regardless of
   returned status.
   But beware that some callers use the output buffer as a temporary
   prompt buffer!

edef.h
efunc.h
globals.c
names.c
word.c
etc/uemacs.rc
   Add eos_chars() function, eos_list global list and eos-chars
   macro-callable function to set eos_list.
   Use the eos_list in both justpara() and fillpara() for end of
   sentence character handling (an additional space) and remove any
   such added space from the final sentence of a paragraph.
   Define the standard GGR setting ( .!? ) in uemacs.rc.

.gitignore
   Added core

archive/example.rc
   Added.

version.h
etc/uemacs.hlp
   Update to version GGR4.104

========== GGR4.105 [25 Feb2017]

docs/utf8.info
test-files/combining-diacritics
   Added

Makefile
   Replace "-D_BSD_SOURCE -D_SVID_SOURCE" with "-D_DEFAULT_SOURCE" in
   DEFINES for Linux. Some distros warn about this.

basic.c
   Use next_utf8_offset()/prev_utf8_offset() to find start of utf8
   characters.

display.c
   In updpos() we need to allow for the same number of characters
   used by vtputc() for *all* non-printing characters.

globals.c
names.c
random.c
word.c
edef.h
efunc.h
etc/uemacs.rc
   Rename *ggr.mode to *ggr.style, as it isn't a mode.

random.c
   Tidy up the current position display code in showcpos().

utf8.c
utf8.h
   Use MAX_UTF8_LEN for max length of a utf8 sequence. Which, since
   2003, is 4 (not 6).
   Add next_utf8_offset() and prev_utf8_offset() functions.
   Removed is_beginning_utf8().

word.c
   Change prompt in eos_chars() and display current setting.

version.h
etc/uemacs.hlp
   Update to version GGR4.105

========== GGR4.106 [26 Feb 2017]

Makefile
   Add back "-D_BSD_SOURCE -D_SVID_SOURCE" while keeping
   "-D_DEFAULT_SOURCE" in DEFINES for Linux.
   Both need to be there for a transitional period.
   Also added "-D_DEFAULT_SOURCE" to the non-Linux branches as the
   uemacs code itself doesn't use any of them so is just setting them
   for system header files, which can use them or not as they see fit.

archive/original-git.log
   The log of changes from the original pK4.0.15 git repository.

etc/uemacs.rc
   Add a description of some environment variable settings and set
   $overlap to 2 (which was the value used by 3.9e).

fileio.c
file.c
   Check for strcpy()ing a name to itself, which happens when
   activating an inactive buffer.
   The action of strcpy() is undefined for overlapping strings.
   On a Mac it will crash...

display.c
   Change the unexplained 4 in several malloc()s to be sizeof(unicode_t).

basic.c
   Correct the fix in forwpage() to stop before we loop round, and
   hence stay on the last line, not go one past it.
   (Incorrectly merged from 3.9e.)

input.c
   Remove a redundant set of braces around (c == (CONTROL|'I')) as
   otherwise the Mac compiler warns about a possible intended
   assignment.

version.h
etc/uemacs.hlp
   Update to version GGR4.106

========== GGR4.107...

README
CHANGES
KNOWN_ISSUES
   Added README, moved CHANGES and BUGS (=> KNOWN_ISSUES) up to main
   directory.

random.c
   In cinsert(), skip over trailing blank space when looking for a
   trailing '{' and keep correct indent count (not one less for blank
   lines).

charset.h
efunc.h
estruct.h
   Add #ifndef lines to allow for multiple inclusion.

bind.c
input.c
efunc.h
   Change ostring() calls to mlputs and some tidying.
   Remove unused outstring and (now) unused ostring code and
   declarations.

input.c
   getname() code re-indented to make it readable.
   Changed a while() loop to for().
   Increment ttcol during TTputc calls in the expansion code.

word.c
   Ensure that text comes back in the original order after multiple
   successive delete-previous-word calls.

main.c
   Extended usage() to list all available options.
   Added -h (for --help) and -V (for --version) options.
   Allow options to be given as separate tokens.
   Add -d option for specifying config/help directories.

bind.c
eval.c
exec.c
globals.c
main.c
spawn.c
edef.h
efunc.h
epath.h
   Redo code that looks for start-up/help files etc.
   Add INTABLE and INPATH modes to flook(). Fix calls in bind.c,
   eval.c, exec.c, spawn.c
   to use the appropriate setting.
   Only look in current directory in flook() is the insecure (-i)
   command line option has been given.
   Add set_pathname() to bind.c to allow the command-line processing to
   alter the directory path to one given location.
   Add -i (insecure) command line option and associated global flag.
   Alter the structure set-ups in epath.h.  You can now set the default
   table values by defining DFLT_PATH in the compilation options.  The
   help and start-up file names are now uemacs.hlp and uemacs.rc in all
   cases.

version.h
etc/uemacs.hlp
   Update to version GGR4.107

========== GGR4.108...

display.c
   Add NULL as missing 3rd arg (unused) in updateline() for MEMMAP &
   !SCROLLCODE call.

input.c
   Extend the VT220 conditional code inclusion to cover the
      if (c == 128+27) // goto handle_CSI;
   given that the target label is VT220 dependent.

input.c
   #ifdef for MSC not MSDOS when checking mbdepth against MAXDEPTH.

word.c
   Define "int c" within the #ifndef GGR_MODE block.

tcap.c
   Move includes of curses.h and term.h to be within the #if TERMCAP
   block.

display.c
globals.c
edef.h
   Make chg_width and chg_height global (also used by spawn.c).

spawn.c
   Moved code to force full window redraw into force_resize() and call
   this before returning from any function with a system() call.

termio.c
   Fix ANSI prototyping on some functions.

utf8.c
   Fix prev_utf8_offset() to use char for marker and valmask, so we
   don't end up sign-extending into an int and failing tests.

version.h
etc/uemacs.hlp
   Update to version GGR4.108

========== GGR4.109...
The Great Glyphing code change...

Most of this is about adding a structure to describe a character
displayed at a column (a glyph) which may contain multiple utf8
characters when some are Combining Diacritical Marks, or Zerowidth.
The glyph structure mainly affects vtputc() and updateline() (and
their callers) in display.c, but handling of zerowidth entities
extends elsewhere too.

Makefile
   Use gnu99, not c99 as the --std.

basic.c
   Skip over zerowidth characters in getgoal().
   Tell next_utf8_offset(), prev_utf8_offset() to go to the start of a
   glyph (i.e skip over zerowidth chars).

bind.c
   In bindtokey() and unbindkey() don't write out the message line
   (mini-buffer) prompts if we are processing start-up files.

display.c
   Explicitly initialize scrflags to 0.
   Move vtcol and vtrow to local static storage (display.c is the only
   user).
   Change struct video to have an array of struct glyph rather than
   unicode_t at the end. Changed parameters to affected routines.
   Added set_glyph(), extend_glyph() clone_glyph(), glyph_same(),
   glyph_same_array(), is_space(), TTputglyph() and TTput1char() as
   static functions.
   Add ttput1c() for external callers to reach TTput1char().
   Change vtinit() to setup a struct glyph array for the *whole*
   vscreen and pscreen arrays (not just the currently in use).
   Make the input to vtputc() an *unsigned* int.
   vtputc() now checks for a unicode character over the maximum allowed,
   and display the replacement character for it.
   vtputc() will extend any preceding character glyph on finding a
   zerowidth one.
   vtputc(), vteeol(), updgar(), scrolls(), updext() now call
   set_glyph() to add a character to vscreen.
   scrolls(), texttest() use glyph_same_array() and updateline() uses
   glyph_same() to check for a display change.
   endofline() and updateline() now use is_space() to check for a
   space, so we can cater for any added zerowidth modifiers.
   TTputc() calls were replace with TTputglyph()/TTput1char() ones and
   those functions adjust ttcol.
   Added a missing third arg (as NULL) to another updateline() call.
   Removed use of n as a column counter in modeline(), as vtcol is
   already doing it. Also "unblocked" a code section to remove an
   unnecessary extra level of indentation.
   Use clone_glyph to move vscreen glyphs to pscreen ones in
   updateline().
   Use sigaction(), not signal(), to set-up signals (portability).

edef.h
   Removed vtrow and vtcol (now local to display.c).

efunc.h
   Added ttput1c() and mlreplyall(). Removed (unused) do_backtrace().

estruct.h
   Include utf8.h.
   Define END_UCLIST.
   Lined up comments.

etc/uemacs.rc
   Added some char-replace settings.

globals.c
   Removed vtrow and vtcol (now local to display.c).

input.c
   Added mlreplyall() to get all of the function args in one go when
   called from a start-up script.
   Some TTputc() calls changed to ttput1c().
   Add a SIGWINCH (if defined) handler for getstring to abort the
   minibuffer if it occurs.  Being in a minibuffer confuses the redraw.
   Needs various signal block to ensure we don't pass though
   set-up/take-down code twice.

line.c
line.h
   Added lgetglyph() to get the struct glyph for the current character
   (or just its length).
   Changed ldelchar() to use lgetglyph() for how many bytes to remove.

main.c
   Some TTputc() calls changed to ttput1c().
   Removed the no longer used #define maindef
   Use sigaction(), not signal(), to set-up signals (portability).

names.c
   Added "char-replace" => char_replace() function mapping.

random.c
   In showcpos() use lgetglyph() to get the full glyph data for the
   current character. Display the number of bytes (and unicode
   characters( used in the glyph if more than one.
   Update getccol() to handle zerowidth characters.
   Modified twiddle() to handle multibyte and zerowidth characters.

spawn.c
   Some TTputc() calls changed to ttput1c().

utf8.c
utf8.h
   Modified utf8_to_unicode() to check that the resulting character is
   not more than the maximum utf8 allows.
   next_utf8_offset() and prev_utf8_offset() now have an option to skip
   over zerowidth characters.
   Added zerowidth_type() function and associated data structure.
   Added char_replace() function to map non- (or poorly) represented
   characters to a (user-configurable) replacement one. The list of
   what to map is also user-configurable.
   Added display_for() to work out what should be displayed for a given
   unicode character.

word.c
   Changed the end-of-sentence coding to use END_UCLIST as an end
   marker rather than 0xffffffff (for consistency).

test-files/combining-diacritics
   Added a few more lines

test-files/1ffff
test-files/3uc-test
test-files/3uc-together
test-files/3uc-together-twiddle
test-files/overrun.txt
   Added some small test files. May extend/document more later.

TODO
   Added to the top-level, as a reminder....

version.h
etc/uemacs.hlp
   Update to version GGR4.109

========== GGR4.110

tcap.c
   Change tcapkclose() to not send TE for the systems where it has just
   sent it in tcapclose().

bind.c
   If flook is sent a pathname, check just that and don't look in HOME,
   along PATH or in the table.

spawn.c
   Forbid the running of external commands when you are in the
   minibuffer (spawncli(), spawn(), execprg() and pipecmd()).
   There's a forced redraw on return, which ends up clearing the
   minibuffer data, while displaying its status in the status line.

estruct.h
   Set XONXOFF and NATIONL to 0 if GGR_MODE is defined.

posix.c
   Add turning off of IXON if XONXOFF is not set (as done in termio.c).
   Enables ctl-Q and ctl-S to be usable for commands.

bind.c
names.c
efunc.h
   Added an include-file command (for use in start-up files) to include
   another file for processing at that point.

word.c
   Fix justpara() and fillpara() when adding an eos space at the end of
   a line in the middle of a paragraph.

main.c
   Redo command line parsing.
   Add options:
      -c<filepath> replacement for default rc file
      -x<filepath> an additional rc file

version.h
etc/uemacs.hlp
   Update to version GGR4.110

========== GGR4.111

bind.c
exec.c
names.c
efunc.h
   Merge the include-file code added in GGR4.110 with execute-file, as
   they are essentially the same.

main.c
   Further command line handling tidying up.
   Fix -v/-e option handling when mixed in with filenames.
   Remove second startup file check (after handling filenames) and the
   now-redundant startflag variable.

display.c
spawn.c
   Fix up for screen refresh on return from external commands.
   Call newscreensize() at beginning and end of update(). Add a new arg
   to it to stop it calling update() when it is called from the start
   of update(). This ensures that term.t_nrow and term.t_ncol are set
   to "correct" values before we set off. [display.c]
   In updgar() and updupd() only update the minibuffer line when we are
   actually using the minibuffer. This allows us to remove the added
   mberase() call at the end of newscreensize(). [display.c]

   Add get_orig_size() to save the original screen size before
   system() calls.
   force_resize() checks the current col/rows and only sets the chg*
   variables to force a redraw if things have changed and also to set
   term.t_nrow and term.t_ncol back to what they were, not to 0, which
   can cause redraw issues in display.c.
   Renamed to check_for_resize(). [spawn.c]

version.h
etc/uemacs.hlp
   Update to version GGR4.111

========== GGR4.112

main.c
   Fix the -e/-v handling once we get to looking for files on the
   command line. You can use -v/-e to toggle view mode on/off as you go
   through the file list.

display.c
file.c
main.c
region.c
   Add in some buffer-narrowing code missed in the GGR migration to
   prevent you saving a narrowed buffer without first being queried.
   [display.c, file.c]
   In quickexit(), add back the mlwrite("\n") call when Saving files.
   This lets the user see which is affected if there is a narrowed
   buffer involved.  Also, if the user aborts redraw the screen to
   remove these filenames.  [display.c]
   When narrowing a region, move whichever of mark and point is further
   through the file to the start of the next line if they are not at
   the start of a line.  So you get any line if you are in the middle
   of it (this already happens to whichever is first in the file).
   When rewidening, redraw the screen with the start of the narrowed
   region in the middle of the window, which makes it more obvious that the
   other text has returned.
   [region.c]

version.h
etc/uemacs.hlp
   Update to version GGR4.112

========== GGR4.113
word.c
   Fix the re-allocation need check for wbuf to cater for char vs.
   unicode_t sizes.

tcap.c
   Make curses.h and term.h inclusion conditional, so CygWin and MinGW
   builds can work.

display.c
efunc.h
   Allow mlforce() to take a variable number of args by changing
   mlwrite() to mlwrite_ap() and making both mlwrite() and mlforce()
   front ends to that.

bind.c
buffer.c
ebind.h
edef.h
efunc.h
estruct.h
exec.c
globals.c
main.c
   Make the key table dynamically assigned (so no longer a fixed
   maximum number of bindings) and enable key binding to user-defined
   procedures.
   Add checks for given buffer/procedure name being too long. Silent
   truncation to 14/15 characters could result in running an
   unintended procedure.
   Change "special" buffer names from *name* to /name, since the
   latter leaves more room for "name" and also cannot be generated
   from a filename.

etc/uemacs.rc
   Updated to use the new buffer-to-key binding implemented above.
   This runs the user-defined store-procedure methods directly.
   Entries from the 40 hard-wired store-macro names are no longer
   used.

main.c
   Fix -v/-V handling for consistency.

../CHANGES
../KNOWN_ISSUES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.113

========== GGR4.114

epath.h
   Set DFLT_PATH to the "standard" locations of /opt/local/etc/ then
   /usr/local/etc/ for Unix-style systems.


buffer.c
exec.c
file.c
line.h
   Added lfillchars macro to fill line text buffer using memcpy()
   rather than looping one char at a time.

line.c
   linstr() takes a char * arg, but was passing this on to linsert(),
   which expects a unicode arg, and runs unicode_to_utf8() on it!
   Changed linstr() to call linsert_byte() instead.

etc/uemacs.rc
   Removed H (horizontal scrolling) mode from the toggle-lmode and
   toggle-gmode macros, as it no longer exists.


buffer.c
exec.c
file.c
globals.c
line.c
main.c
names.c
spawn.c
efunc.h
estruct.h
   Added code to handle "phonetic translation tables" on input.
   This allows you to define a table of strings that will be mapped to
   other strings, allowing for simple input of utf-8 characters.
   You may have multiple tables, but only one is ever "ready". Usage is
   defined by a mode (Phon) which may be turned on/off.

ptt/czech.cmd
   Created a ptt/ directory for ptt tables and added a Czech one.

../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.114

========== GGR4.115

ptt/czech.cmd
   Fix the z~ mapping.

basic.c
random.c
utf8.c
utf8.h
   Remove the unneeded third arg (maxlen) from prev_utf8_offset(). When
   going backwards the *minimum* offset is always 0!

Makefile
exec.c
   make use of the Julia language utf8/unicode library
      https://julialang.org/utf8proc/
   to detect character types.

      This first test was to determine the character type for a
      beginning-of-word test in phonetic translation table handling.

   The Julia language utf8/unicode library is now a pre-requisite for
   this version of uemacs (an beyond).

Simplify the code by removing various ifdefs by noting that we always
want:
   PKCODE = 1              // We are extending the pK version
   GGR_MODE = 1            // We really are extending the pK version
   EBCDIC = 0, ASCII = 1      // We're using Unicode
   VMS = 0                // No longer of use...
This will simplify the switch to using the Julia language utf8/unicode
library generally.

>>> VMS deletions
Makefile
vmsvt.c
   Deleted.

complet.c
file.c
fileio.c
input.c
main.c
search.c
spawn.c
termio.c
epath.h
estruct.h
   Deleted VMS references.

isearch.c
   Deleted IS_VMSFORW and IS_VMSQUOTE (also from estruct.h)

>>> EBCDIC/ASCII removal
estruct.h
   Delete EBCDIC. Enable all ASCII.
   Also remove IBMCHR, as we will be replacing isletter(), islower() and
   isupper() with unicode versions.

>>> GGR_MODE forced
display.c
word.c
estruct.h
   Removed GGR_MODE assuming it to be set.
   Also removed NATIONL, as we will be replacing isletter(), islower()
   and isupper() with unicode versions [estruct.h].

>>> PKCODE forced
ansi.c
basic.c
display.c
file.c
fileio.c
globals.c
ibmpc.c
input.c
isearch.c
main.c
names.c
random.c
search.c
spawn.c
tcap.c
termio.c
word.c
ebind.h
edef.h
estruct.h
   Removed PKCODE assuming it to be set.
   Except for:
     Enable "#" for truncated files. [display.c]

basic.c
word.c
   forword(), backword(), upperword(), lowerword() and capword() were
   changed to know about display characters (glyphs) and also to use the
   Julia utf8 library for character types (letters/non-letters) and case
   changing (upper letter to/from lower letter).
   Updated some comments to reflect that backchar()/forwchar() move by n
   display characters (glyphs) not bytes (have done since GGR4.109).

basic.c
display.c
exec.c
line.c
random.c
utf8.c
word.c
line.h
utf8.h
   Changed all references to glyph (including comments) to use grapheme
   instead, as that is what the Unicode documentation uses for the
   concept of the data to describe a sequence of coded characters that
   ‘should be kept together’ and there a glyph is something different.
   No code change.

exec.c
random.c
   Changed token() [exec.c] to not add the starting quote to a quoted
   token (it never added the closing one!).
   Changed istring [random.c] to treat the response as a set of token,
   and handled Unicode (U+xxxx) and utf8 bytes (0x..) in those.
   This allows you to enter known Unicode character points and utf8 code
   sequences. "Normal" text strings can still be added - but you now
   need to put them in "..." if they contain spaces.

random.c
   In showcpos(), remove the printing of the decimal code, and just
   display the unicode codepoint as U+xxxx.

ptt/russian.cmd
ptt/czech.cmd
etc/uemacs.rc
   Added a Russian pttable and moved the toggle-ptmode key binding to
   the main start-up file.

etc/uemacs.hlp
   Added some information at the end about recent additions to macros
   (eos-chars, char-replace, pttables, use defined procedure key
   binding.

Makefile
   Added code to enable finding the Julia utf8proc lib, and exit with
   an error if unable to find it.

../PREREQUISITE
../README
   Added a specific note about the use of the Julia utf8proc lib and
   also commented on it in the README file.

Makefile
   Added code to look for curses term.h.
   Probably specifc to Oleg's router distros, but could be extended
   for others as necessary.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.115

========== GGR4.116

Makefile
   Allow for version numbering on any local utf8proc directory name.

edef.h
efunc.h
random.c
   Disable toggling Phon mode on via adjustmode() if no pt_table is
   yet defined.
   Made adjustmode() static.

eval.c
evar.h
   Add inmb system variable, so macros can check for being, and disable
   use, in the minibuffer.

etc/uemacs.rc
   Change toggle-lmode/toggle-gmode to check $inmb and simplified(?)
   code.
   Added "P" (Phon) as a valid mode to toggle.
   Standardized mode chars to be those used by buffer displays.

etc/uemacs.rc
   Make the file-hooks macro look at the filename for the buffer, not
   the buffer name, as it was failing on long filenames where the
   buffer name is truncated.

utf8.c
   Remove a bug introduced in GGR4.109 (why?  - unknown) that prevented
   unicode 0x80-0xbf being converted to utf8.

word.c
efunc.h
   Expose the ensure_case() function so that it can be used by the ptt
   code in exec.c

etc/uemacs.rc
   Tidy up (remove debug code...) of toggle-lmode/toggle-gmode change.

basic.c
display.c
utf8.c
   Change utf8_to_unicode() so that it checks the incoming args and
   returns a value of 0, with a returned codepoint of 0, if the index
   is outside the given len range,
   Corrected getgoal() [basic.c], mlwrite_ap() and mlputs() [display.c]
   to ensure they don't call utf8_to_unicode() with index >= len.

exec.c
globals.c
utf8.c
estruct.h
utf8.h
   NOTE: globals.c was erroneously checked in as part of commit:
    4cd83b90cab79e240492f882be91436b5d304db8
   Add code to handle casing options in Phonetic Translation tables.
   These can now do case modification of the replacement text.
   The tables can contain these commands:
      caseset-on        [which is the default setting]
      caseset-capinit1
      caseset-capinitall
      caseset-lowinit1
      caseset-lowinitall
      caseset-off
   Each applies to all following replacement rules until the next
   caseset-* command or the end of the table is reached,
   For caseset-off the replaced text is treated verbatim and it will do
   a verbatim replacement on a match.
   For the other cases the replaced text is checked case-insensitively.
   For caseset-on it will force upper-case of the replacement on a
   match if the first character in the replaced string is uppercase.
   For caseset-cap* it will uppercase the first character of the string
   (capinit1) or all words (capinitall).  The caseset-low* are similar,
   but force lowercase if the first character of the replaced string is
   lowercase.
   tolower_utf8(), uclen_utf8(), nocasecmp_utf8() and unicode_back_utf8()
   functions added [utf8.c]

line.c
   As utf8_to_unicode() now checks its args, lgetgrapheme() now needs
   to check for being at EOL and return a NL grapheme, so ldelchar()
   knows there is 1 byte to step over.

basic.c
exec.c
random.c
word.c
   Fix for delfword()/delbword(). These use forwchar()/backchar() to
   move over the section to delete, but these functions now move by
   grapheme, so you can no longer just count the number of calls and
   delete that number of bytes.
   Changed forwchar()/backchar() to return the number of bytes moved
   and fixed all callers accordingly.

ptt/czech.cmd
ptt/russian.cmd
   Edited to take account of the caseset-* commands to simplify/shorten
   tables.

basic.c
eval.c
exec.c
isearch.c
line.c
names.c
random.c
region.c
search.c
word.c
ebind.h
efunc.h
   Rename forwchar()/backchar() to forw_grapheme() and back_grapheme()
   as that is what they (now) do, and this should help to avoid
   confusion.
   Changed the return value of both functions on an incomplete move to
   be minus the actual move. Adjusted callers accordingly.


display.c
exec.c
estruct.h
   Added display-code option to ptt tables to let you give a
   2-character code to display in the mode line when it is on. It is
   preceded by "P-" and defaults to the first two characters of the
d    table name.
   Added an internal function, show_utf8(), to display.c to handle
   utf8 strings in the modeline.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.116

========== GGR4.117

exec.c
   Set the WFMODE mode on the buffer after setting the ptt table, so
   that the modeline gets updated with the change, if it is in use.

exec.c
   Unset ptt_storing after compiling a pttable in dobuf().

exec.c
names.c
efunc.h
   Added next-pttable function, to cycle through pttables.

posix.c
   Correct the number of characters to wait for.
   Only wait if we are at the start of an extended utf8 sequence, or
   have an Escape character.
   Replace the tcsetattr() call (doesn't seem to timeout on Ubuntu under
   Windows on Windows10?) with poll().

input.c
   Make display_handler dynamic, not static, so that it can handle
   recursion in the minibuffer.

basic.c
globals.c
word.c
edef.h
   Remove (unused) justflag from ctrulen(), renamed it to
   curline_empty() (which is how it is used) and simplified it.

etc/uemacs.rc
   Combined local and global toggle mode macros.
   Unbound Esc-^T (newwidth) as it is no longer needed with SIGWINCH
   handling and just messes up the display.

ptt/russian.cmd
   Fixes. Put non-alpha entries into caseset-off section and remove an
   uppercase setting (Y -> Ы) accidentally left in.

buffer.c
estruct.h
   Change the size of a buffer name (NBUFN) from 16 to 32. This is
   really to allow longer procedure names. makelist() in buffer.c was
   changed accordingly.

evar.h
   Change NVSIZE from 10 to 32. We aren't memory constrained nowadays.

random.c
   Update setccol() to handle zerowidth characters, and fix getccol().
   Reformatted (tidied) code of both.

line.c
line.h
   Updated lgetgrapheme() to return nothing if point is beyond end of
   line (shouldn't happen, but might in testing things that manipulate
   w_doto field).
   Added lputgrapheme() (currently unused...).

basic.c
   Fixed gotobop() and gotoeop() to check for whitespace, not inword(),
   and made them work properly at beginning/end of buffer.

random.c
   Fix forwdel() and backdel() calls in whitedelete to use (0, 1), not
   pass on the incoming f and n args!

eval.c
   Fix gettyp() to test for, and allow, negative numeric arg.

names.c
word.c
efunc.h
etc/uemacs.rc
   Combined the paragraph filling routines (fillpara() and justpara())
   into one main function (filler()) and make the old routines
   front-end this.
   Added makelist-region function, which is bound to M-^Q.
   Amended the lr-justify macro to work with the new fillpara().
   Bound  to M-^P in etc/uemacs.rc.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.117

========== GGR4.118

word.c
   Initialize status to FALSE in justpara() and fillpara() to avoid
   compiler warnings about possible undefined use.
   Don't add a newline in filler() if at end-of-buffer.
   Got to column, not byte offset, at end of buffer in justpara().

bind.c
etc/uemacs.rc
   Fix stock() to allow binding to M-^X in a command-file (could already
   bind it interactively).
   Bind execute-file to M-^X.

buffer.c
   Fix ltoa() to handle files >1GB by putting "+" in col1 of the size
   (not worth widening field, as such a size will not be common).
   Also correct array size definitions to match the new sizes.

names.c
word.c
efunc.h
etc/uemacs.rc
   Change makelist-region to use " o " as the label, and added
   numberlist-region to fill with (possibly) numbered paragraphs using
   the template stored in the user variable %list-indent-text.
   Fixed the region scan so that it works properly.
   In uemacs.rc, rebound makelist-region from M-^Q to M-/, bound
   numberlist-region to ^X-/ and set a default value of " %2d. " for
   %list-indent-text.

word.c
   After region_listmaker has run (for *list-region functions) set the
   mark to one character ahead of point, otherwise ctl-C will reformat
   the preceding paragraph - again.

etc/uemacs.hlp
   Added notes for makelist-region and numberlist-region and a
   description for the %list-indent-text user variable setting.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.118

========== GGR4.119

eval.c
evar.h
   Replaced the separate structure and tagging for environment
   variables and user functions (which had actually lead to an error if
   SCROLLCODE was not set!) with enums and in-structure settings.

bind.c
buffer.c
display.c
eval.c
file.c
globals.c
input.c
main.c
window.c
word.c
edef.h
estruct.h
evar.h
etc/uemacs.rc
   Re-added the horizontal scrolling code, having found it in an old
   version of 3.10 source from 1992.
   Reformatted several functions involved to use a 4-space indent.
   Renamed scrollcount to scrolljump. [display.c, eval.c, globals.c,
   edef.h, evar.h]
   Made update() re-entrant (by restoring incoming displaying value,
   not FALSE, at end) so that updpos() can call it (since it calls
   updpos()) to ensure we get an update as the cursor gets to the
   screen edge.
   Switch off horizontal scrolling around update() in the minibuffer
   [getstring() in input.c]

search.c
   Add a check in forwsearch() for being at end-of-buffer and fail if
   so.  If not the rest of the search code (both magical - mcscanner()
   and ordinary - scanner()) wraps round to the start and searches from
   there.

search.c
   Add the FAST search algorithm from 3.10 that was missed during the
   original GGR migration. It was in 3.9e (5 January 1988 comment).
   Defined FAST so as to use it.
   Note that the entire search code is still ASCII-centric.

buffer,c
file.c
   Added code to look for file-hooks-<<sfx>> function ahead of
   file-hooks, and to execute the first found.
   Moved the file-hooks running from swbuffer() and bfind() as the
   latter is reached before the filename is set when reading in a new
   file. The code is now in readin() and only run if lockfl is TRUE
   (which is an accidental convenience).
   So file-hooks now run for file loaded by filefind (^XF).
   They no longer run for files opened in VIEW mode (but that's fine,
   as none of the modes affects VIEW mode).

crypt.c
   Re-done to encrypt more than just ASCII codes (which meant that
   multi-byte utf8 characters were being left unchanged!).
   Now encrypts all bytes above and including space. This means we can
   never generate a newline, which would mess things up badly.
   Simplified the mod coding - mod95 function no longer required.

fileio.c
   Changed ffputline() to work in chunks, so it doesn't call fputc()
   (and possibly myencrypt()) once for each character written.
   Tidied up the whole file to 4-column indenting.

bind.c
   Moved mbstop() from buildlist() into desbind().

ebind.h
   Removed (temporarily?) the ^XD binding to bktoshell, as it messes up
   the tty (leaves it in raw mode?) and so is unusable.

line.c
   linstr() tidied up.  Removed the old linsert() code (in an "#if 0"
   section) and indented to a tab-stop of 4.

buffer.c
exec.c
   Check for excessive macro recursion.
   Also fixed the storeproc() call in storepttable() [exec.c] to not
   pass on the f and n args, as that could end up calling a numbered
   macro! Re-indented some code to a 4 tab-stop.

crypt.c
file.c
fileio.c
   Extended to encrypt all bytes. This required uemacs to be able to
   handle NUL characters on input, so ffputline() and ffgetline() were
   modified to do this. They also now work on 8kB blocks, rather than
   per-character, which significantly speeds up read/writing on large
   files.
   This makes the -n option a no-op.

globals.c
input.c
main.c
names.c
random.c
edef.h
efunc.h
estruct.h
etc/uemacs.rc
   A buffer (//kbd_macro) is now filled with the macro code for the
   keyboard macro as it is created. This allows you to edit it and/or
   save it to file for later execution.
   Various functions now need to add their result to the macro buffer.
   The running of this buffer has been bound to ^XV. The ^XE replay of
   the key strokes is currently unaltered, but these key-bidings may
   swap once this has moved beyond the experimental stage.
   Added insert-raw-string and macro-helper functions to enable this.

      modified:   edef.h
      modified:   file.c
      modified:   fileio.c
      modified:   globals.c


file.c
fileio.c
globals.c
edef.h
   Since ffputline() and ffgetline() now work via a cache there is no
   longer any need to run input into fline then copy it all into a
   struct line (which was done to avoid either doing a realloc on every
   character input or allocating unnecessarily large buffers for short
   lines). So modified ffgetline() callers to let ffgetline() call
   lalloc(), which it will mostly do once it knows the final line size
   and will reallocate and copy-over if required, and removed the
   related lfillchars() calls.
   Combined the read and write caches for ffputline() and ffgetline()
   since only one can ever be active at any one time.
   Removed ftrulen and fline, changed fline to be struct line *.

../KNOWN_ISSUES
../TODO
../CHANGES
version.h
etc/uemacs.hlp
   Notes about the non-ASCII search problem (for the next release?)
   Changed the PROGRAM_NAME_LONG from uEmacs/Pk to nuEmacs.
   Update to version GGR4.119.

========== GGR4.120

   Updates for encrypting files so as to make encryption compatible with
   JASSPA uemacs.
buffer.c
estruct.h
   Define and initialize b_keylen and b_EOLmissing in struct buffer.
crypt.c
   So no longer catenates your key to itself until it is at least 63
   chars long (the code is still there and can be enabled by setting
   PARANOID in the compile options).
file.c
   Use curbp->b_keylen, not strlen(curbp->b_key), as the key is
   self-encrypted and hence may contain a NUL.
fileio.c
   Handle the case of binary and crypt file which have no newline at the
   EOF.  We don't want to write these out if they weren't there
   originally.
   Added a heuristic test for where a file is binary.
   Newlines are now added *before* a line is written, except for the
   first call for a file write-out, and the final one is (probably)
   written in the flush call.
main.c
   Check that any command line given encryption key is not longer than a
   valid key length before copying it into the buffer.
   Save the keylength of the plaintext version as b_keylen.

buffer.c
file.c
   Moved the copy in of global modes in swbuffer() to be before the
   readin() call, as that runs file-hooks, which may well wish to set
   modes.
   Change file-hooks running order to be file-hooks then file-hooks-sfx,
   with each being run if it exists.

../README
../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.120.

========== GGR4.121

basic.c
eval.c
exec.c
file.c
isearch.c
line.c
names.c
random.c
region.c
search.c
word.c
ebind.h
efunc.h
   Restore forwchar()/backchar() functions for use by macros (as these
   require functions to return just TRUE or FALSE).
   These are just call-throughs to forw_grapheme() and back_grapheme(),
   which have now lost the unused "f" arg.
   Adjusted callers accordingly (all internal usage calls *_grapheme() not
   *char().

line.c
line.h
   Externalize the linsert_byte() call, as it's more efficient than
   linsert() when you know you have a byte, not a Unicode char.

random.c
   Changed string_getter() so that it doesn't process the results for
   rawstring() beyond unquoting a token.
   Modified istring() and rawstring() calls as a result.

main.c
   Modified the flush_kbd_text() so that text insertion can handle NUL
   characters.
   Extended the macro_helper() call to insert a NUL when given a 0 arg.
   Changed some linsert() calls to linsert_byte().

word.c
   Fix region_listmaker() to get the correct paragraph count.
   It was getting one too many of you were already at beyond the last
   character in a paragraph (at end-of-line).

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.121.

========== GGR4.122

main.c
   Don't update lastflag on a status display (i.e. showcpos()).
----------

buffer.c
file.c
globals.c
edef.h
   Set a flag before getfile() calls in filefind() and viewfile()
   [file.c] and readin() in swbuffer() [buffer.c] to say that we want to
   run file-hooks - don't use the lockfl value.
   Allows us to run file-hooks on view-file.
----------

 Fixes to handle double-width (or more) characters by using
 utf8proc_charwidth() for the column increment, not 1.

test-files/fillpara.long_jap.txt
   Test file
basic.c
   newcol in getgoal()
display.c
   curcol in updpos()
   Step back over any NUL graphemes when placing extended-line $ marker.
   [vtputc()]
   Pad the "unused" graphemes of multi-width characters with NUL. [vtputc()]
   When moving into a line extension, change any NULs following a
   multi-width character at the start of line to be spaces for correct
   alignment. [updext()]
random.c
   col in getccol().
   col in setccol().
word.c
   wordlen in filler().
----------

estruct.h
search.c
   Searching for utf8 chars (i.e. ones with a first byte >= 0x80) was
   failing as the search table was taking this to be a signed char!
   Defined a ch_as_uc() macro in estruct.h to cast to unsigned char, and
   used this where relevant.
crypt.c
line.c
posix.c
utf8.c
   Altered some (unsigned char) castings to use the ch_as_uc() macro.
----------

  Various changes to the minibuffer code so that PHON mode may be set
  there (to enable easier searching).  This meant that the minibuffer
  needed its own modeline display (to show PHON mode on/off, and which
  language).  At the same time I added code to names.c to allow
  searching by function address which enables us to use the per-function
  flags set there to allow/dis-allow usage in the minibuffer, rather
  than checking in each routine and calling mbstop() from there.

----- Details -----

Makefile
   Added idxsorter.c to the build and refreshed depends lists.

bind.c
   Added not_in_mb() call.
   getbind() now checks if in minibuffer and if call is allowed. If not
   it switches it to not_in_mb().

display.c
   Added mb_update() to display a modeline for the minibuffer, and set
   modeline() to call it if we are in the minibuffer.

edef.h
globals.c
   Added mb_info and not_in_mb_funcname definitions.

efunc.h
   Added not_in_mb(), init_namelookup(0 and func_info() definitions.

exec.c
   namedcmd() now checks if in minibuffer and if call is allowed.  If
   not it switches it to not_in_mb().

input.c
   Modified getstring() to show a modeline for the minibuffer. We also
   now return *all* of the minibuffer (not just the current line) as the
   value, which allows you to search for strings with newlines in.
   The ctl-I filename expansion only work on the current (visible) line
   contents, though.

main.c
   Added call to init_namelookup().

names.c
   Added init_namelookup() and func_info() to enable searching for
   function info by function address.

etc/uemacs.rc
   Remove minibuffer check from _mytoggle-mode

idxsorter.c
idxsorter.h
   Added sorting code.

NOTE!!!
   The indexed sorting code works, but could be improved.
   It currently sorts pointers as character arrays (which means it needs
   to know the endianness). Ideally it would sort these as numeric
   fields (and also then allow sorting of signed data).
----------

bind.c
buffer.c
exec.c
input.c
isearch.c
main.c
names.c
random.c
region.c
search.c
spawn.c
window.c
efunc.h
    Removed calls/references to mbstop().
    toggle-ptmode, add-mode, add-global-mode, delete-mode and
    delete-global-mode are now enabled in the minibuffer.
----------

bind.c
idxsorter.c
main.c
names.c
efunc.h
idxsorter.h
    Updated idxsort_fields() (in idxsorter.c) to handle numbers (signed,
    unsigned and pointers) "properly". It can also now sort
    NUL-terminated C-strings from in-memory pointers.
    Used this to provide quick lookups for key-bindings [bind.c] and
    function name lookups [names.c]
----------

input.c
    Added MDPHON to the list of modes allowed to persist in the minibuffer.
----------

  Added further indexing, and also code to delay indexing of bindings
  when processing a command buffer (which may well have multiple
  rebindings in it).

----- Details -----

bind.c
    Add indexed binary search for key mapping to bindtokey() and
    unbindchar() (previously only buffertokey() had it!)
    Move index_bindings() to be earlier in the file.
    Add key_index_valid global to trigger indexing rather then calling
    index_bindings(). As a result made index_bindings() a static function.
    Add pause_key_index_update global to delay indexing.
    Add back code to get_key_tab() to do a linear search when the index
    is invalid, but indexing is being delayed.
exec.c
    Set pause_key_index_update to 1 in dobuf() and restore original
    value on exit.
globals.c
    Add pause_key_index_update and initialize to 0.
main.c
    Add key_index_valid global to trigger indexing rather then calling
    index_bindings().
ebind.h
    Add key_index_valid and initialize to 0.
edef.h
    Add key_index_valid and pause_key_index_update.
efunc.h
    Removed index_bindings() declaration. It is now internal to bind.c.
----------

bind.c
exec.c
globals.c
edef.h
efunc.h
    Remember the keystroke for a "not in minibuffer" command and display
    that in the error message too.
----------

  Reworked getbind() to return a pointer to an information structure,
  rather than just a function address. This makes better use of the
  indexing.

----- Details -----

bind.c
    Renamed get_key_tab() to getbind() and changed callers of getbind()
    accordingly.  (Removed original getbind()).
    Removed getfname() and fncmatch() - no longer needed.
    Moved not_in_mb_error() to main.c

exec.c
    Fixed docmd() for to use name_info() not fncmatch().

input.c
    Fixed docmd() for to use name_info() not fncmatch().
    Corrected some fname->fnc->fname oddities in keyboard macro calls -
    just use fname directly.

main.c
    Modified to use new getbind() calls (mostly in execute()).
    Copied over not_in_mb_error() from bind.c.
    extend_keytab() now copies in init_keytab entries individually and
    sets the fi information pointer for each.

names.c
    Added back the final NULL entry to names[].  The binding listing
    code expects it to be there.

ebind.h
    Changed init_keytab[] to just be a list of key -> function items.

efunc.h
    Removed getfname() and fncmatch() declarations and changed getbind().

estruct.h
   Added name_bind pointer to key_tab structure.
   Added key_tab_init structure definition.
----------

spawn.c
    Fixed bktoshell by calling rtfrmshell(). It appears that the handler
    for SIGCONT doesn't get called on returning with "fg".
ebind.h
    Re-enabled the bktoshell key binding.
----------

  Move the minibuffer prompt back into the minibuffer. It didn't look
  right there, and would have become really odd with split windows once
  the modeline used for it was changed to that of the active window.

----- Details -----

bind.c
    Fix deskey so it display in the minibuffer.

display.c
    Put the minibuffer modeline handling back into modeline() and
    removed mb_update().
    The minibuffer now uses the active window modeline (which makes a
    difference with split windows). It displays abbreviated mode flags
    for the minibuffer, and also notes when it is multi-line.

globals.c
edef.h
    Modified mb_info structure fields.

input.c
    Put back the code to have the prompt in the minibuffer itself.

main.c
    Check for "skip_in_macro" before checking for namedcmd.

names.c
    The binary chop method in func_info() was changed to be one which
    always finds the first entry for any duplicated keys.
----------

  More indexing bits. Including adding the concept of a "next" index to
  the index sorting. Used this for building the keybinding list.

----- Details -----

bind.c
    Add indexing of the keytab data by function, and also create a
    "next" index for it (index_keystr(), next_getbyfnc(), getbyfnc()).
    Fix bindtokey() and buffertokey() to check the need extend_keytab()
    correctly, now that we are using indexed lookups.
    Modify buildlist() to use index routine calls while building the
    function list.

efunc.h
    Add nxti_name_info() declaration.

idxsorter.c
idxsorter.h
    Add make_next_idx() function.

main.c
    Don't declare an internal keytab_alloc_ents in main - there's a
    global of the same name!  Now named init_ents.

names.c
    Remove the end NULL entry from names[] (no longer needed as we use
    indexing to go through the entries).
    Create a "next" index for name_index[].
    Remove extraneous code lines (errant copy&paste?) at the end of
    func_info().
----------

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.122.

========== GGR4.123 [24 July 2017]

idxsorter.c
    Fix the index to be 0-based during the final permutation loop,
    rather than using a special "decrement-by-one" loop.
----------

efunc.h
isearch.c
search.c
    Fix incremental searching (which must have been failing for ages).
    scanmore() was moved form isearch.c to search.c, as it needs to set
    up the patterns and set mlenold and matchlen.

----------
basic.c
display.c
random.c
line.h
    Fix column counting when displaying a tab character, and remember to
    add the '$' at the right-hand column to indicate an over-long line.
    Missed/messed up in the double-width display changes.
    Created a macro for the common column-updating code.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.123.

========== GGR4.124 [28 Aug 2017]

buffer.c
    Return on abort, don't used saved name [usebuffer()].
    Add do_savnam check before saving buffer name [swbuffer()].
globals.c
edef.h
    Add do_savnam, initialized to 1.
main.c
    Change create_kbdmacro_buffer() to call kbdmac_buffer_toggle()
    to get to/from the macro buffer.
    Set do_savnam to 0 (and restore it to 1) around swbuffer() calls
    and save/restore curwp data across a GetTo/OutOf call pair
    [kbdmac_buffer_toggle()].
    Call end_kbdmacro() if recording a macro [ctrlg()].
    Set kbdmode = STOP in end_kbdmacro().

globals.c
    Initialize scrolljump to 0, not 1.

line.c
    If the buffer is empty add a dummy space before restoring text and
    remove it afterwards. Without this the restored text is left off the
    top of the screen and the mark ends up moving with dot [yank()].

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.124.

========== GGR4.125

bind.c
    Cast function pointers to void* before order comparison to remove
    warning on Mac. [getbyfnc()]
    Remove unused nptr variable. [buildlist()]
names.c
    Cast function pointers to void* before order comparison to remove
    warning on Mac. [func_info()]

display.c
    Simplify ex section code in extend_grapheme().
    DO NOT free any target ex field in clone_grapheme() as this is
    always a vscreen to pscreen copy, and we deal with alloc/free in the
    vscreen side. Also don't allocate one-too-many items.
    Correctly initialize all of the vscreen items (not every third one!).

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.125.

========== GGR4.126

pklock.c
   Replace (deprecated) cuserid() with getpwuid(geteuid())

eval.c
   gcc7 has an option to check for case statements that fall through
   implicitly. Enabling it found a bug here.
   Consequently decided to compile with -Wall -Wextra.
   As a result:
   * added /* Falls through */ comments in appropriate locations:
    main.c      search.c
   * removed some unused function parameters:
    fileio.c
   * added an UNUSED() macro for unused function parameters in:
    estruct.h
    basic.c     bind.c      buffer.c    crypt.c     display.c   exec.c
    file.c      input.c     isearch.c   line.c      main.c      random.c
    region.c    spawn.c     tcap.c      utf8.c      window.c
   * changed some int to be unsigned int:
    eval.c      exec.c      isearch.c   main.c      search.c    utf8.c
   * changed some code around a setjmp/longjmp pairing:
    input.c
   * moved "static" to be at the start of a declaration:
    utf8.c
   * used the function parameter width in filler() rather then the
     global fillcol:
    word.c

input.c
    Make two variables volatile to avoid warning about longjmp
    clobbering them.

../CHANGES
../README
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.126.

========== GGR4.127

main.c
    Correct an horrendous bug when inserting a new character. These
    arrive as unicode, but the code called linsert_byte() to insert this.
    The attached comment said "We get utf-8, not Unicode" - why is a
    mystery, as it was never inserting a string.
    This was resulting in attempts to add things like  (2-byte utf8 -
    0xc3 0xbc) ending up as "extended ASCII" (0xfc) and hence non-utf8!
    It also stopped any other extended characters from being entered at
    the keyboard.
eval.c
exec.c
    Rename linsert() to linsert_uc().
input.c
    Change linsert() of a char to be linsert_byte().
line.c
line.h
    Change linsert_byte() prototype to have a char as second parameter.
    Change linsert() to linsert_uc() and make the second parameter a
    unicode_t.
    Change lowrite() prototype to be a unicode_t.
random.c
word.c
    Change linsert() to linsert_uc().
    Change linsert() for space, tab, # and (*)char to use linsert_byte().

../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.127

========== GGR4.128

random.c
line.h
    Use update_screenpos_for_char macro in setccol().

display.c
    Use show_utf8() to display the buffer name.

file.c
    Change makename() and unqname() for unique buffer naming.
    When generating a buffername from a filename makename() now leaves
    4-chars at the end for unqname() to fill in with numbers to create a
    unique name.
    The routines also now handle unicode names.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.128

==========

globals.c
input.c
estruct.h
etc/uemacs.rc
    Added an "eQuiv" mode setting (for utf8 searching).
    No support code to use it yet.

search.c
estruct.h
    Removed MAGIC as a compile-time option - it is now hard-wired.
    Reformatted search.c ahead of editing for utf8 searching.

names.c
    Mark next-buffer as "not in mini-buffer".

input.c
    Check for winch_seen before calling ctrlg()/TTflush() on ABORT in
    getstring().
    This allows macro-collecting to continue over a window resize.

file.c
    Fix buffername generation in makename().

main.c
    Check for there actually *being* another argument before assigning
    it to -c/-d/-g/-k/-s/-x options.
    Add a (required) call to setpattern() for the -s option.
    Reformatted main() to use 4-space indents (also quickexit(),
    emergencyexit(), quit(), ctlxrp() and ctlxe ()).

----------

    Added a set of ring-buffers for the last search and replace buffers
    (one set each).
    This allows you to recall (and re-use) the last 10 search/replace
    strings.
    The mechanism requires a way to update the prompt in getstring()
    as it goes back to loop: This is done using prmpt_buf.

----- Details -----

edef.h
globals.c
    Removed duplicate pat and rpat declarations [edef.h].
    Added in_search_prompt and prmpt_buf. Initialized in globals.c.
    Changed some
         struct xxx {...};
         (extern) struct xxx xxx;
    definitions into
         typedef struct xxx_st;
         (extern) xxx_st xxx;

efunc.h
    Added init_search_ringbuffers(), next_sstr(), prev_sstr() and
    select_sstr() declarations.

input.c
    Changes to getstring().
    o Update the prompt if prmpt_buf.update is set.
    o Preload teh resutl buffer if prmpt_buf.preload is set.

main.c
    o Call init_search_ringbuffers().
    o Remap nextwind/prevwind/listbuffers to (respectively)
      next_sstr/prev_sstr/select_sstr if in_search_prompt is set.
    o Add vis_key_paras setting for no keystroke (not ring-buffer related!).

search.c
    o Added the code to handle search/replace ring buffers.
      init_search_ringbuffers(), update_ring(), previn_ring(),
      nextin_ring(), prev_sstr(), next_sstr() and select_sstr().
    o Modified readpattern() to handle the reprompts as we move through:
        * Take and restore a copy of in_search_prompt around the
          mlreplyt() call and set it to 1 for the call.
        * Set this_rt for the current call before *and* after the
          mlreplyt() call
        * Update the FAST search tables for any default string used.
        * Add the string to the ring buffers if it is a new string.
        * Save and restore the incoming base prompt
    o Reformatted many &mcpat[0] (and similar) to be just mcpat.
----------

../CHANGES
../README
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.129
   Added information on the search ring buffers to README and uemacs.hlp.

========== GGR4.130

random.c
    Changed backdel() to check that back_grapheme() succeeds before
    running kdelete() and marking the command as a CFKILL one.

display.c
    Fixed mlwrite_ap() to print (nil) when passed a NULL pointer to a
    string, rather than crashing with SIGSEGV.
    Reformatted code to 4-space indents.

----------

    Added a set of kill-buffers for the last deletes.
    If you yank (^Y) you can then do yank_prev_killbuf (Esc-Y) to change
    that yanked text with the previous deletes in turn. Only works if
    you do nothing else after the yank.
    Also works after yank-minibuffer.
    Note that yanking rotates the kill-ring list.

----- Details -----

ebind.h
    Add META-Y binding for yank_prev_killbuf.

edef.h
    Declare kused and kbufh to be arrays (of dimension KRING_SIZE).

estruct.h
    Define CFYANK flag. Set when last command is a yank*.

eval.c
    Moved getkill() up and removed unneeded additional declaration.
    Changed getkill() to use kbufh[0] not kbufh to get data.
    Forced a trailing null into the result - the kill buffers have a
    known length so don't have nul-terminated data strings.

globals.c
    Define kused and kbufh as arrays.

input.c
    Set a mark before restoring the last minibuffer in yankmb() so that
    yank_prev_killbuf(0 can replace the region.
    Mark yankmb() as a CFYANK function.

line.c
line.h
    kdelete() changed to delete the last item in the kbufh array, then
    move the rest down one (freeing the top entry).
    kinsert() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).
    yank() changed to use kbufh[0] (from kbufh).
    Added a rotate_kill_ring() function. Not bound by default, but can
    be run by Esc-x rkr.
    Added a yank_prev_killbuf() function to, if the previous command was
    a yank:
        o rotate the kill buffer (by any numeric arg)
        o remove the yanked region (discarding it - not putting it on the
          kill ring).
        o inserting the current top kill=ring buffer.

names.c
    Added an entry for rotate_kill_ring as "rkr".

word.c
    delbword() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).

----------

(search.c)
../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.

========== GGR4.131

edef.h
globals.c
input.c
region.c
(line.c)
    If the last command was a yank then kill_region doesn't need to save
    the killed text, as it is already at the top of the kill-ring.

efunc.h
eval.c
input.c
search.c
    Fix the code for replace-string (sreplace) so that it works again
    after the replace-ring code added in GGR4.130.
    Drop the code for search/replace prompt updating as we go through
    the search-ring into a function (new_prompt()). [efunc.h, search.c]
    Call new_prompt() if a macro sets $search or $replace [eval.c]
    Clear prmpt_buf.update on entry to getstring() in case some
    mis-coding(?) has left it set. [input.c]
    Let empty Replace strings go onto the replace-ring buffer [search.c]
    Fix the check for what to do on an empty response in getstring(). We
    do want to save empty Replaces, but not if the current top-of-ring
    is empty. [search.c]

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.

../README
(search.c)
(search.c)
../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.


========== GGR4.130

random.c
    Changed backdel() to check that back_grapheme() succeeds before
    running kdelete() and marking the command as a CFKILL one.

display.c
    Fixed mlwrite_ap() to print (nil) when passed a NULL pointer to a
    string, rather than crashing with SIGSEGV.
    Reformatted code to 4-space indents.

----------

    Added a set of kill-buffers for the last deletes.
    If you yank (^Y) you can then do yank_prev_killbuf (Esc-Y) to change
    that yanked text with the previous deletes in turn. Only works if
    you do nothing else after the yank.
    Also works after yank-minibuffer.
    Note that yanking rotates the kill-ring list.

----- Details -----

ebind.h
    Add META-Y binding for yank_prev_killbuf.

edef.h
    Declare kused and kbufh to be arrays (of dimension KRING_SIZE).

estruct.h
    Define CFYANK flag. Set when last command is a yank*.

eval.c
    Moved getkill() up and removed unneeded additional declaration.
    Changed getkill() to use kbufh[0] not kbufh to get data.
    Forced a trailing null into the result - the kill buffers have a
    known length so don't have nul-terminated data strings.

globals.c
    Define kused and kbufh as arrays.

input.c
    Set a mark before restoring the last minibuffer in yankmb() so that
    yank_prev_killbuf(0 can replace the region.
    Mark yankmb() as a CFYANK function.

line.c
line.h
    kdelete() changed to delete the last item in the kbufh array, then
    move the rest down one (freeing the top entry).
    kinsert() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).
    yank() changed to use kbufh[0] (from kbufh).
    Added a rotate_kill_ring() function. Not bound by default, but can
    be run by Esc-x rkr.
    Added a yank_prev_killbuf() function to, if the previous command was
    a yank:
        o rotate the kill buffer (by any numeric arg)
        o remove the yanked region (discarding it - not putting it on the
          kill ring).
        o inserting the current top kill=ring buffer.

names.c
    Added an entry for rotate_kill_ring as "rkr".

word.c
    delbword() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).

----------

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.131

========== GGR4.132

----------

    Fixes related to yanking and <CR> at the end of buffer.
    This could result in:
    o   mark and point both ending up at EOB (so yank-replace and
        kill-region both failed)
    o   an additional blank line added at end of buffer

ebind.h
line.c
line.h
names.c
    Rename yank_prev_killbuf to yank_replace (and yank-prev-killbuf to
    yank-replace) [ebind.h, line.c, line.h, names.c]
    If we are adding a newline at the end of the last line, and it is not
    empty, don't allocate a new line - just move w_dotp to the next line
    and set w_doto to 0. [line.c]
    Force the newline in lnewline() if a yank didn't start on the last line.
    [line.c]
    If yank() has no text to insert, still mark it as a yank (otherwise
    yank-replace can't get kick-started [line.c]

---------- Description of issue and solution.

To stop the "phantom" newline being added if you (say) yank a line of
text at End-of-buffer:

In lnewline(), if we are on the last line (actually next-line = the
headp) and are at the last character in the line (so not splitting a
line) and the line is not empty (so it's not a "dummy" last line) we
just update the current point (doto) the start of the next line - we
don't actually add any line at all.

But this leaves us with the issue of:

   ...text...
   <empty>
   <empty>

compared to:

   ...text...
   <empty>

If you enter text into the middle line of the former you get:

   ...text...
   new-text
   <empty>


while if you enter it into the empty (last) line of the latter you get:

   ...text...
   new-text
   <empty>

i.e. the same, as uemacs will add a final (logical) newline. But we need
to distinguish between the two if that new-text ends-with  a newline -
in the first case we want it to be added whilst on the latter we don't.

So, in yank (the newline function for <CR> is OK) I set a force_newline
flag if a newline is about to be inserted and we weren't on the last
line when starting the yank ( a fact that is already known for a fix-up
to mark when yanking at end-of-buffer).

----------

names.c
    Re-add a final NULL entry at the end of names[] as getname() uses a
    serial search and expects to find it there.

input.c
    In getname() take an exact match as found, even if it is also a
    partial match for something else. Otherwise you can never use
    "set" interactively.

edef.h
eval.c
evar.h
globals.c
line.c
    Add yank_mode variable. [edef.h, globals.c]
    Tie $yankmode environment variable to yank_mode. [eval.c, evar.h]
    Handle yank() and yank_replace() (was yank_prev_killbuf()) according
    to the user-defined style ("old" or "gnu"). [line.c]
    yanking an empty string must still set an empty region at the
    current location. [line.c]

    yank styles:
    old:
        ctl-Y (yank) inserts the last-killed string.
        Esc<n> ctl-Y inserts <n> copies.
        Esc-Y (yank_replace):
            if the last command was a yank this replaces that region
            with the previous kill-ring buffer entry, otherwise it
            just inserts the last-killed string (== ctl-Y).
        Esc<n> Esc-Y rotates the kill-buffers by <n> before doing the
        replace.

    gnu:
        ctl-Y (yank) inserts the last-killed string.
        Esc<n> ctl-Y rotates the kill-ring buffers by <n> then inserts
        the current "top" kill-ring string.
        Esc-Y (yank_replace):
            if the last command was not a yank it complains and does
            nothing
            otherwise it replaces that region with the previous
            kill-ring buffer entry
        Esc<n> Esc-Y rotates the kill-buffers by <n> before doing the
        replace.

    The default setting is "old". To change this use:
        set $yankmode gnu
    in your personal uemacs.rc file.

Makefile
main.c
    Add code to generate a stack trace dump on some signals (including
    TERM, so you can find out where a forever loop is).
    Built when TRACE=1 is supplied to the make command.
    This REQUIRES the addr2line program to be accessible.

line.c
    Improve the code to handle yanking into an empty buffer.
    Consolidate the setting of an empty-region at point before yanking.

(basic.c)
../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.132

========== GGR4.133

../PREREQUISITE
Makefile
main.c
    Rework the stack dump code to use libbacktrace.
    Enable the signal handler for all builds: the TRACE option now just
    adds the traceback dump.
    Reworked Makefile to look for the libbacktrace library.
    Added libbacktrace information to the PREREQUISITE file.

line.c
    Change the reposition() in when yanking into an empty buffer to
    put as much yanked text as possible on screen.

main.c
    Extended the stack dump handling to:
      o set stdout to autoflush, so that output interleaves correctly
        with stderr
      o save any modified buffers (and keyboard macro) as
        date-tagged files in a uemacs-dumps/ directory in the user HOME.
        An INDEX file there contains a mapping to the original file names.

Makefile
    Change to -g1 for TRACE, which is sufficient to get line numbers.

names.c
    Ignore the terminating NULL entry in the needed count for
    idxsort_fields().

edef.h
eval.c
evar.h
globals.c
efunc.h
main.c
Makefile
    Added the $autoclean environment variable.
    Add automatic uemacs-dumps/ directory cleanup on start-up based on
    the setting of the $autoclean environment variable.
      o -ve  don't do any
      o 0    remove all files at start-up
      o +ve  remove files older than <n> days
    The default $autoclean setting is 7. You may set your owne value in
    a start-up file.
    If you set the $autoclean variable after start-up that setting will
    have immediate affect for this run of uemacs.
    Added -D_GNU_SOURCE to Linux compile options.

../CHANGES
../PREREQUISITE
version.h
etc/uemacs.hlp
   Update to version GGR4.133

========== GGR4.134

Makefile
   Shell expand dlist before finding which ones exist - to expand any
   wildcard matching multiple entries.
   Changed dlist to blist for BCKT location finding.

buffer.c
edef.h
efunc.h
eval.c
evar.h
globals.c
word.c
etc/uemacs.rc
    Changed makelist-region and numberlist-region to use an environment
    variable (regionlist_text, regionlist_number) for the label rather
    than, respectively, a hard-wired value or user variable. [edef.h,
    eval.c, globals.c, word.c, etc/uemacs.rc]
    Also added const to kbdmacro_buffer and arg1 of bfind declaration
    [buffer.c, edef.h, efunc.h, globals.c]

----------

    Fixes to the minibuffer, and input, so that the minibuffer use
    doesn't need to be cancelled on SIGWINCH.
    (Plus some related tidying up).

---------- Details ----------
bind.c
efunc.h
exec.c
input.c
    Make the prompt a parameter to the getname() call, so that it can
    be redisplayed on a resize.
    getname() now checks for a return char of END_UCLIST (illegal) and
    redraws what it already has if it sees it.

display.c
efunc.h
    Make newscreensize() and external function.

edef.h
globals.c
    Extended mb_info definition to include saving wheadp.

input.c
    Set an internal flag to optionally disable syscall restarts around
    the TTgetc() call, so that we can tell a signal (SIGWINCH) has
    arrived and allow input routines to handle this.
    An illegal unicode value (UC_LIST) is returned and not recorded to
    macros.
    Make the SIGWINCH handler set SA_RESTART on set-up.
    Simplify the original signal handling on leaving getstring().
    Remove the setjmp/longjmp calls and associated flags.
    The handler now saves curbp, curwp and wheadp on first entry and
    restores these before running the resize code. It then sets things
    back. If it arrives from a minibuffer it copies the whole curwp
    structure, as minibuffers all now share the same struct window.
    Create the struct window for minibuffers.
    Base minibuffer names on the minibuffer level "//minib%04d" and
    removed tmpnam().

----------

Makefile
    Fix variable re-usage that lead to missing library locations.

edef.h
estruct.h
file.c
fileio.c
globals.c
main.c
etc/uemacs.rc
    Added a DOS mode, for files with DOS line endings.
    If the first line of a file ends with \r\n the buffer is put into
    DOS mode, and the \r is remove from all lines. This only affects
    reading a file into a new buffer. [file.c]
    Writing out a buffer in DOS mode will write \r\n at the end of each
    line. [fileio.c]
    You can toggle the DOS mode in a buffer, but it only has an effect
    when reading in or writing out a file.
    Included files are also checked for DOS endings, but do not change
    the current buffer mode.
    Add a workaround to (re)display the number of lines read in for the
    first file given on the command line, as otherwise it is lost in the
    initial screen drawing [file.c, globals.c, main.c, edef.h]

Makefile
    Make TRACE the default for x86_64 if the backtrace include file can
    be found, and change the option to NOTRACE to turn it off.

edef.h
globals.c
input.c
line.c
line.h
    Add a kill ring for the last minibuffers.
    Moved the minibuffer saving and yankmb() code into line.c (with
    yank/yank_replace). Enabled local static declarations rather than
    global ones.
    getstring() now calls addto_lastmb_ring() rather than copying to
    lastmb directly.
    Added static lins_nc() routine to insert a known byte count from a
    pointer, rather than a C-string. [line.c]
    Added the yank() tests for handling empty buffer and end of buffer
    to yankmb(). These routines are now very similar, but sufficiently
    different to keep them separate.

    NOTE!!
    Minibuffers (and hence search strings) are usually limited in size -
    often to 128 characters.  This is silently truncated if you overstep
    the length, so a yankmb() might not get all that you expect if you
    copy a large region into a minibuffer.  The kill ring always
    contains all of a delete.

display.c
estruct.h
input.c
line.c
random.c
utf8.c
word.c
    Changed END_UCLIST to be UEM_NOCHAR, better fitting a more general
    usage.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.134

==========

display.c
edef.h
exec.c
globals.c
random.c
    Remove modename[] and just use mode2name[] case-insensitively in tests.


buffer.c
file.c
    Run resetkey() after file-hooks run [file.c]
    Set the b_active flag before running readin() (and hence before
    file-hooks run) [buffer.c]

file.c
    Fix minibuffer display when reading a non-existent file given on the
    command line ([New file]).

exec.c
main.c
estruct.h
    Allow store-procedure to set skip_in_macro and not_mb flags for
    the stored buffer code and check for this in execute().

names.c
etc/uemacs.rc
    Tag more functions as not_mb ones.
    names.c:
        change-file-name, change-screen-size,  change-screen-width,
        count-words, move-window-down, move-window-up, name-buffer,
        restore-window, save-window, scroll-next-up, scroll-next-down,
        set-encryption-key, set-fill-column, unmark-buffer
    etc/uemacs.rc
        spell-check, lr-justify

word.c
    Use linsert_uc() to add the wbuf word, not linsert_byte(), as it is
    a unicode array.

line.c
line.h
names.c
    Change yankmb() to check the yank_mode setting (as yank() does).
    Change rotate_kill_ring() to be an internal, rather than a bindable,
    function.
    Mark lowrite() and ldelnewline() as static, not external.
    Removed lgetchar() - lgetgrapheme() must be used.
    Mark lputgrapheme() as CURRENTLY_UNUSED.

random.c
ebind.h
estruct.h
    When in DOS mode, allow for the extra \r at the end of each line
    when reporting the position in showcpos().
    Reformat file to 4-space indenting.
    Assume NBRACE is set (remove old insbrace() code) and remove its
    setting from estruct.h.
    Assume CFENCE is set.
    [Also main.c and names.c fixups later...]

----------
Various removals for optional code. Just set these to be on - there is
sufficient memory in systems nowadays.
This makes the code easier to read.
----------

ebind.h estruct.h exec.c names.c word.c
    Assume PROC is set.

buffer.c crypt.c ebind.h estruct.h file.c fileio.c main.c names.c
    Assume CRYPT is set.

basic.c buffer.c crypt.c ebind.h estruct.h file.c fileio.c main.c
names.c word.c
    Assume WORDPRO is set.

ebind.h estruct.h isearch.c names.c
    Assume ISRCH is set.

bind.c ebind.h estruct.h names.c
    Assume APROP is set.

bind.c ebind.h estruct.h names.c random.c
    Assume AEDIT is set.

display.c estruct.h main.c
    Assume CLEAN is NOT SET!

ansi.c bind.c epath.h estruct.h file.c fileio.c search.c spawn.c tcap.c
termio.c vt52.c
    Remove V7 and EGA.

ansi.c basic.c display.c estruct.h eval.c evar.h ibmpc.c line.c random.c
tcap.c vt52.c window.c
    Assume SCROLLCODE and CVMVAS are set.

estruct.h eval.c main.c termio.c
    Assume TYPEAH is set.
    Remove unused ADDCR from estruct.h

posix.c
estruct.h
Makefile
tcap.c
    Enable compiling under CygWin.
    If __CYGWIN__ is set, define __linux__  [estruct.h]
    Set compilation options if under CygWin [Makefile]
    Set undefined (non-POSIX) XCASE, ECHOPRT and PENDIN to 0 [posix.c]
    Do include curses.h and term,.h for CygWin [tcap.c]


display.c
eval.c
exec.c
main.c
random.c
efunc.h
    Change itoa() to ue_itoa() to avoid name-clash in CygWin.

efunc.h
display.c
    Fixes for handling the ex field in graphemes.
    Add no_free flag to set_grapheme() and set it when calling for a
    pscreen entry. Also make the function static (and move it up the file)
    as it is only used here.
    Don't allocate space for an existing ex section in clone_grapheme.
    This was a memory leak, as we never free from pscreen.

estruct.h fileio.c
    Assume CTRLZ is NOT SET!


bind.c complet.c ebind.h epath.h estruct.h file.c fileio.c input.c
main.c spawn.c termio.c
    Assume MSDOS is NOT SET!

main.c
    Add SIGABRT to the list of signals handled.

estruct.h search.c
    Assume TURBO is NOT SET!

estruct.h input.c search.c
    Assume MSC is NOT SET!

eval.c
exec.c
line.c
line.h
main.c
random.c
   Rename ldelchar() to ldelgrapheme(), as that is what it does.

../CHANGES
version.h
etc/uemacs.hlp
../test-files/multi-uc-graphemes
   Update to version GGR4.135

========== GGR4.136

main.c
    Use buffer (proc) name when reporting that an execute-procedure
    cannot be run in the mini-buffer.

line.c
    Run through the correct pointers in kdelete.
    Keep mark on original line if at eol when adding a newline.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.136

========== GGR4.137

search.c
    Add four missing ch_as_uc() macros wrappers for isalpha calls.
    Affects old systems that use a lookup table.

pklock.c
    Make compilation conditional on FILOCK being set.

display.c
    Rename TTput1char to be TTput_1uc, as it handles unicode.

line.c
    Use the correct pointer to get np when freeing multi-block kill
    buffer ring text in kdelete().

eval.c
file.c
globals.c
edef.h
evar.h
    Add an autodos system variable to enable/disable the DOS file
    detection as a file is read.
    The default setting is TRUE.
    NOTE that this flag is checked, and the pre-buffer DOS flag
    set/unset at any re-reading of a file.

etc/uemacs.rc
    Extended the toggle-mode code to have an "F" option, which toggles
    the autodos flag value.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.137

========== GGR4.138

random.c
    Make gl_descr larger to prevent gcc8.2 (Ubuntu 18.10) warning about
    snprintf() possibly having too much to put into the buffer.

input.c
    Handle a bug in gcc4.4.7 that reports "may be used uninitialized"
    for restoring wsave. Add more comments to save/restore blocks.
    Simplify inmb setting.

input.c
    A better fix for the "may be used uninitialized" issue with
    gcc4.4.7.


buffer.c
input.c
region.c
    Fixes to check for the BFNAROW flag being set on reading in a file to
    a buffer.
    Without this you can narrow a file, re-read it, then widen it again
    to get a modified file (entire file within the region of the file)
    that is marked as unmodified.
-----
    If bclear() is about to clear a narrowed buffer, then widen it first
    so that all lines may be freed. [buffer.c]

    Clear the minibuffer line of the prompt at end of mlyesno().
    (Format all file to my 4-space standard.) [input.c]

    sleep(1), rather than reposition, at end of widen() if n is passed
    in as -ve. [region.c]
-----

line.c
    Speed up the most-likely case (an ASCII char) [linsert_uc].

Makefile
epath.h
    Enable a static arm7l build for Android (for use with SS Helper).

random.c
    Count { and } more intelligently in C-mode, so it works better for
    Perl.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.138

========== GGR4.139

complet.c
fileio.c
lock.c
efunc.h
estruct.h
    Combined the expand_tilde() and expand_shell functions into
    fixup_fname() and removed the conditional compilation bits.
    Extended fixup_fname() to handle any leading (multiple) ".."
    directories to mean "get $PWD, strip that number of entries and
    append the rest".
    This is to handle this sort of case:
     o  A user's HOME is /home/user
     o  They have a symlink, slw, to a working dir /workdir/user.
     o  In their HOME they cd slw.
     o  Now that can cat ../.bashrc and it will cat what they expect.
     o  Previously, uemacs ../.bashrc would try to open /workdir/.bashrc
        as the .. would be relative to the physical location.
     o  This changes means it uses an edit of $PWD, so opens the
        expected file.

     If you really want to go via the physical location you can use
     ./../.bashrc.

     Reformatted (tidied) code of complet.c and lock.c.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.139

========== GGR4.140

etc/uemacs.rc
fileio.c
    Check that we only open *files* for reading/writing and also for the
    &EXIst macro function. [fileio.c]
    Remove code that checks for environment variables in filenames. It
    leads to inconsistent handling of $ in filenames. [fileio.c]
    Added an expand-envvar macro function, bound to Esc-$. [uemacs.rc].

exec.c
line.c
    Report the name of a function when we can't find it. [exec.c]
    Mark code buffers as read-only whilst they are being executed. [exec.c]
    Add read-only check to linstr(), to avoid incorrect error
    message. [line.c]
    Fix insspace() to check that linsert_byte() succeeded. [line.c]

bind.c
globals.c
main.c
edef.h
    Remember current_command when running one. [bind.c]
    Mark that we are running a function when we are. [main.c]
    Change rdonly() to display the offending command and buffer if
    we are running a function at the time. [main.c]

buffer.c
    Check when going to a buffer that it is active and, if not, read in
    its file.

bind.c
exec.c
buffer.c
    Reformatted (tidied) code of recently-changed files.

ptt/czech.cmd -> etc/czech.cmd
ptt/russian.cmd -> etc/russian.cmd
    Move *.ptt files to etc/, which is where they need to be installed.
    Remove the ptt/ directory.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.140

========== GGR4.141

bind.c
buffer.c
file.c
input.c
main.c
efunc.h
    Disable making keyboard macro buffer be the current buffer while it
    is being collected.
    Add arg to swbuffer() to allow switch to actually add the macro text.
    Add return code checks to swbuffer() calls.
    Minor change to end_kbdmacro() call in ctlxrp() [main.c]

bind.c
    Simplify the prefix key coding.

bind.c
exec.c
input.c
efunc.h
    Return name_bind struct from getname() rather than just the function.
    Changed the two callers to handle this - they now have more info available.

bind.c
    Display, and allow in commands, the 2-char sequence "^?" for Delete (0x7f).

main.c
    Fix the ~/uemacs-dumps clean-up code to actually work (multiple errors).

buffer.c
main.c
names.c
    Allow negative arg to "next-buffer" (nextbuffer()). [buffer.c]
    Take any numeric arg to "select-buffer" (usebuffer()) to mean go
    back to previous buffer without prompting.  [buffer.c]
    Remove any numeric arg message from the mini-buffer before executing
    a command [main.c], and add comment to execute() call in getstring()
    that mlerase() after execute() isn't needed there.  [input.c]
    Disable "select-buffer" when in the mini-buffer.  [names.c]


exec.c
main.c
efunc.h
    Add code to remember the text of the last command line run in a
    buffer for reexecute.
    Fix addto_kbdmacro() to record a 0 numeric arg when it is set. [main.c]
    docmd() is only used in exec.c, so make it static there. [efunc.h, exec.c]
    Add struct line_info and struct line_seen. [exec.c]
    Add push_lsb(), pop_lsb(), switch_lsb_lines(). [exex.c]
    docmd() use *_lsb code to preserve commands and, if the command is
    "reexecute", recurse with the previous command. [exec.c]
    Tidy up the 40 numeric macro functions by using a generating macro.
    [exec.c]

globals.c
input.c
main.c
search.c
edef.h
    Fixes for keyboard macro so that reexecute and numeric multipliers
    work for it.
    Merge saved c/f/n vars into a last_arg structure. [edef.h,
    globals.c, input.c, main.c]
    Only record getstring input to macro text buffer if there is some.
    [input.c]
    If getpattern() inserts the default reply for searching, add that to
    the macro text buffer. [search.c]
    If in reexecute mode, put mapped search function names into the
    macro text buffer, not the originals. [main.c]
    Save last c/f/n when in PLAY kbdmode, so reexecute works, but don;t
    save them for ctlxrp. [main.c]
    Modify ctlxe() and ctlxrp() so that things like Esc2^Xe Esc3^C work
    as expected (keyboard macro runs 6 times). [main.c]

globals.c
input.c
main.c
edef.h
efunc.h
    Move the (identical) numeric prefix code in main.c and input.c into
    a function (multiplier_check()) and get them both to call it.
    [main.c, input.c, efunc.h]
    Redefined (and renamed) the last_arg structure to func_arg.
    [globals.c, input.c, edef.h]

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.141

========== GGR4.142

Some utf8 changes

bind.c
efunc.h
    Changed character case check in stock() to handle utf8 strings.
    Made all internal functions static, removed them from efunc.h and
    re-ordered some functions accordingly.

input.c
efunc.h
line.h
    Changed character case check on input to handle unicode chars.
    Added ensure_uppercase() to do the mapping.
    Move yankmb() declaration from efunc.h to line.h.

eval.c
efunc.h
    Checked mklower() and mkupper() for utf8, but they only deal with
    ASCII text. In the process made all internal routines static,
    removed them from efunc.h and re-ordered some functions accordingly.
    Reformatted/tidied code.

buffer.c
exec.c
file.c
isearch.c
lock.c
random.c
search.c
efunc.h
    Removed all extern definitions of functions only used in one file
    and made them static. Re-ordered/reformatted files in the process.
    Removed:
        makelist, ltoa, addline [buffer.c]
        freewhile [exec.c]
        ifile [file.c]
        checknext, match_pat, promptpattern, get_char, uneat, reeat [isearch.c]
        unlock, lckerror [lock.c]
        tabsize (a variable), cinsert [random.c]
        savematch, delins, rmcclear [search.c]
        non-existent meexit, sys, shellprog, execprog
    This shrunk the Intel x64 binary by >2%.

region.c
utf8.c
utf8.h
    Add a generic utf8_recase() function. Change tolower_utf8() to use
    it. [utf8.c, utf8.h]
    Change lowerregion() and upperregion() to be front-ends to
    casechange_region(), which uses utf8_recase() and so now handles
    unicode recasing. [region.c]
    Re-ordered/reformatted region.c and utf8.c.

exec.c
region.c
word.c
utf8.c
efunc.h
utf8.h
    Simplify ensure_case() to use utf8proc_toupper/tolower/totitle
    directly and do nothing if the result is the same as the input.
    Insert replacement *before* deleting original, so mark is moved
    correctly if it directly follows the original.
    Add code to fix-up mark location if ensure_case() changes byte-count
    of the character.
    Add special case of ß -> SS for UTF8_UPPER. [word.c]
    Use the UTF8_UPPER/UTF8_LOWER/UTF8_TITLE option names from
    utf8_recase() and changed callers to reflect this. [exec.c, word.c]
    Remove tolower_utf8() [utf8.c/h] and change caller [exec.c] to use
    utf8_recase().
    Changed utf8_recase() calling sequence [utf8.c/h] to return more
    info (via an mstr struct) and updated callers [exec.c, region.c].

ansi.c
basic.c
eval.c
exec.c
ibmpc.c
names.c
pklock.c
posix.c
spawn.c
tcap.c
termio.c
usage.c
version.c
vt52.c
window.c
wrapper.c
charset.h
ebind.h
estruct.h
line.h
    Finally decided to tidy up all source files to use 4-space indenting.
    No actual code changes except:
    o Removed abs() from eval.c and efunc.h, as it's a C library function.
    o Removed '#undef abs' checking from estruct.h


Makefile
bind.c
buffer.c
display.c
eval.c
exec.c
fileio.c
globals.c
input.c
line.c
lock.c
main.c
names.c
search.c
utf8.c
window.c
word.c
wrapper.c
estruct.h
edef.h
efunc.h
evar.h
wrapper.h (deleted)
    Change all malloc/realloc calls to Xmalloc/Xrealloc, so that the
    check for failure (NULL pointer returned) is only done in one place.
    For those calls which check for NULL, removed that test and any
    dependent code block.
    If such an error does occur then exit - as we are in real trouble.
    Changed wrapper.c to contain Xmalloc() and Xrealloc() definitions
    and removed the existing (unused) xmkstemp() and xmalloc().
    Deleted wrapper.h [Makefile]
    Removed the unused code for memory stats envram, EVRAM and the
    associated $ram system variable, RAMSIZE and RAMSHOW. [eval.c,
    globals.c, main.c, edef.h, estruct.h, evar.h]
    Moved two bits of common code into a static get_display_code()
    function. [exec.c]
    Tidied up the failexit/failexit2/noram goto label usage [exec.c]

main.c
    In end_kbdmacro() restore f_arg from p_arg if we were in PLAY mode,
    as this gets called on a macro abort, and we need to reset things so
    that re-executing a macro (clt-C) re-executes the macro after it
    aborts, not re-executes the failing command.

search.c
    Drop the common search-loop code into forwscanner()/backscanner().
    This means that the end-of-buffer check is now done for forwhunt()
    as well as forwsearch().

eval.c
input.c
search.c
../TODO
    Fixes for tgetc() returning a unicode char, not an ASCII one.
    Just change char c to int c [input.c, search.c]
    For eval.c:
        o Fix GTKey to handle unicode input and return a utf-8 string.
        o Fix UPPer and LOWer to work with utf-8 strings.
        o Fix CHR to work with codes > 255. Allow hex and U+... codes
    Removed this from TODO list.

utf8.c
    Fix utf8_recase() to check for len == 0 *after* obtaining the real
    length.

isearch.c
    Use strcpy() not strncpy() to copy back pat_save in isearch().
    Removes compiler warning on Debian buster, and is better code.

Makefile
complet.c [deleted]
input.c
efunc.h
    Included code from complet.c into input.c, as that was the only user
    of it.
    Made previously external routines (comp_file() and comp_buffer())
    static.
    Removed complet.c references. [Makefile, efunc.h]
    Dropped matching loop from comp_file() and comp_buffer() into an
    internal matcher() function.
    Replaced strncpy() call for moving so_far into choices with code to
    limit so_far size, then use strcpy(). Removes compiler warning on
    Debian buster, and is better code.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.142

========== GGR4.143

utf8.c
utf8.h
    Re-order some code and extended comments about how to use
    utf8_recase(). Changed to being a void() function - any unknown
    casing request is handled as TITLE case. No real code change.

version.c
    Print utf8proc version as well.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.143

========== GGR4.144

-----
Changes to how re-exec (ctl-C) works for some commands that require
further input.
Under re-exec, just execute the previous input rather then get (the
same) info from the user again.

exec.c
    In namedcmd() save the last function and re-use it when in
    reexecute.
    Also change ":" to "name:" in prompt.
    In execcmd() change ":" to "command:" in prompt.
    In do_cmd(), replace the line_seen *lsb structures with a
    prev_line_seen that is always updated before exit. This handles
    recursion (e.g. a reexecute of a command buffer that itself contains
    reexecute commands).
    In execproc() and execbuf() save the last buffer name and re-use it
    when in reexecute.
    In execfile() save the last buffer filename and re-use it when in
    reexecute.

random.c
    In quote() save the char to quote and re-use it when in reexecute.

spawn.c
    Combine spawn() and execprg() into simple front-ends to a common
    back-end and remember last run common, for reexecute.
    Remember last command for pipecmd() and filter_buffer() as well,
    using a common command-line fetcher.
    Fix filter_buffer() to not prompt to "Discard changes" if original
    buffer was modified.

main.c
names.c
search.c
    Use inreex flag internally to handle reexecuting searches rather
    than remapping function calls to *hunt() [search.c, main.c]
    Remove hunt-forward and hunt-backward from name binding list as they
    are no longer needed for macro-running [names.c]
    Put "reexecute" into the keyboard macro buffer, rather than adding a
    copy of the actual previous command. [main.c]
-----

version.c
    Display the GCC version used to compile, compile date/time and libc
    version in use at run-time.

globals.c
edef.h
    Remove unused quotec variable.

basic.c
bind.c
eval.c
exec.c
file.c
input.c
isearch.c
main.c
random.c
region.c
spawn.c
window.c
word.c
estruct.h
    Add MLbkt macro for MLpre/MLpost bracketting of fixed text.
    No real code change.

exec.c
globals.c
names.c
random.c
search.c
spawn.c
edef.h
efunc.h
estruct.h
    Added the ability to turn the "extended" reexecute arg functionality
    on/off on a per-handler basis. The "args-in-reexec" command.
    Structure data and setting. [edef.h, efunc.h, estruct.h, globals.c,
    names.c, random.c ]
    Add the per-handler test to current inreex checks for:
        o namedcmd(), execproc(), execbuf() and execfile() [exec.c]
        o Added (missed) inreex handling to execcmd() [exec.c]
        o quote() [random.c]
        o forwsearch() and backsearch() [search.c]
        o spawn(), execprg(), pipecmd() and filter_buffer() [spawn.c]
    Removed the realloc() from reexec handling by using a large enough
    static buffer instead [spawn.c]

    By default all "extended" reexecutes are on.
    They can be manipulated by:
        args-in-reexec arg1 arg2 arg3 ....
        Args are process in the order found.
        None (case-insensitive) turns all off
        All (case-insensitive) turns all on
        + means turn it on any succeeding commands
        - means turn it off any succeeding commands
        A command name (e.g. search-forward) means turn that on/off.
    If there is an error in the args then the original setting is left
    unchanged.

version.c
    Check we actually have a libc string before trying to print it...

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Added args-in-reexec ALL [uemacs.rc]
    Update to version GGR4.144

========== GGR4.145

exec.c
    Simplify restoring oldestr value.

buffer.c
eval.c
exec.c
globals.c
main.c
termio.c
    Change some simple "&var[n]" constructs to be just "var".

----------
Add support for integrating user macros into "core" functionality.

eval.c
exec.c
globals.c
edef.h
efunc.h
evar.h
    Add a global (userproc_arg) to allow macro procedures to an arg
    from C-code [globals.c, edef.h]
    Add a function (run_user_proc())) to run a userproc and use it in
    execproc() [exec.c, edef.h]
    Add a user function (%esc) to escape a string for use as a single
    token in an external (shell) command.
    Add a user function (%arg) to pick up any userproc_arg arg, or
    prompt for one if none is set [eval.c, eval.h]
----------

eval.c
    Fix &lef and &mid code to put the trailing NUL onto the result!

random.c
    In writemsg(), if args come in as (1, 2) from "2 write-message ..."
    then just write it directly to stderr. Only for debugging macros.

exec.c
    Edit a comment to refer to execute-file, not include-file (the code
    was changed some time ago...).

----------
Add simple support for displaying directory content in a buffer
for file browsing.

eval.c
fileio.c
globals.c
main.c
spawn.c
edef.h
evar.h
etc/uemacs.rc
    In check_for_file() if we have a directory and a showdir userproc
    then call it to display the entries. [fileio.c]
    If we get to the point of "self-insert" in execute() and we are in
    the view-only //directory buffer for a showdir userproc, then handle
    some chars as specific actions [main.c]
        d, o        open entry on current line
        v           view (read-only) entry on current line
        r           refresh current view
        u           go up to parent directory
    All other "self-inserts" are silently ignored...
    Change the file and buffer name used by pipecmd() ("command" ->
    ".ue_command") and parameterize it. [spawn.c]
    Add showdir_tokskip system variable [eval.c, globals.c, edef.h, evar.h]
    Add the code for the showdir userproc [etc/uemacs.rc]
----------

----------
Rationalization of mlreply* calls.
The terminating-character arg hasn't been used for ages, and is replaced
by an "expansion type" option so that if getstring() is called it can
present the correct options.
Removed mlreplyall (which I'd added in GGR4.109). Macro functions only
pick up one arg, so if you want to use "a list" you just need to quote
it (e.g. char-replace in etc/uemacs.rc).
Added expansion for user-procedure calls (a specific-case of buffer-name
expansion).

Files affected:

basic.c
bind.c
buffer.c
crypt.c
eval.c
exec.c
file.c
input.c
main.c
random.c
search.c
spawn.c
utf8.c
word.c
efunc.h
estruct.h
etc/uemacs.rc
----------

etc/uemacs.rc
    Add QUOTING_STYLE=literal to ls command in showdir.

main.c
    For the "open" (d, o, v) case in directory browsing check we are
    handling a directory or file.

input.c
    Change type to mtype in matcher (for consistency) and add a comment
    about what COMPPROC does.

input.c
efunc.h
estruct.h
    Changed getname() to use the standard getstring() function (via
    mlreply() rather than its own hard-wired completion code.
    Added EXPNAME expansion (using getfname()/getnname() and
    comp_name()+matcher().  [input.c, estruct.h]
    Removed no-longer used ctoec() function [input.c, efunc.h]

exec.c
    Don't print "No such function" on failure return from getname().
    It has either already printed it, or the user aborted the command.

input.c
    Add default case for mtype switch in matcher().

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Update to version GGR4.145

==========
