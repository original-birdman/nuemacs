See GGR4.100.changes for the original changes around moving from 3.9e to
pK4.0.15.

========== GGR4.101 [21 Feb 2017]

.gitignore
CHANGES
   Files added.

Makefile:
   Change the PROGRAM build from em to uemacs

epath.h:
   Fix a left-over from build testing - change the startup file name
   from nuemacs.rc to uemacs.rc

word.c
   Change justpara() so that it can handle unicode characters, based on
   the fillpara() code from merging.
   Get the correct indent from column, not byte offset.
   Handle leading whitespace in the paragraph to reformat.
   Make the temporary buffer dynamically allocated, to cater for long
   strings with no spaces.
   Add punctuation handling in ggr-mode.

etc/uemacs.rc
   Bind EscR to search-reverse (not the default replace-string).

etc/uemacs.hlp
   Put back that Metas that had been changed to Esc.

complet.c
   Replace strncpy() calls to populate choices with memcpy(), as we
   have to nul-terminate manually anyway.

eval.c
exec.c
input.c
   Replace strncpy() calls followed by "manual" nul-termination with
   memcpy() ones.

lock.c
   Replace strncpy() call into tmpname with just strcpy(), as fname
   can't be more the NFILEN anyway.

README
readme.39e
   Moved both to the archive directory.

version.h
etc/uemacs.hlp
   Update to version GGR4.101

========== GGR4.102 [22 Feb 2017]

word.c
   Right-justification in fillpara() was leaving an extra space at eol
   after a punctuation mark.
   Increment gap as well if dotflag is set.

word.c
   justify-paragraph (Esc-J) changes had stopped it working at the
   start of a buffer and if there was no whitespace at the start of the
   paragraph.
   Ignore whitedelete() result and force w_doto to 0 (since at the
   start of the buffer it seems to end up as 1).

buffer,c
   Just entering <CR> when prompted for "Use buffer:" (^XB) used to
   take you back to the last one, but now takes you to "main".
   Add back a save of b_name to savnam in swbuffer() missed in the
   migration.

tcap.c
display.c
   Add test for SCROLLCODE around some declarations to avoid
   compilation warnings if this is turned off.

version.h
etc/uemacs.hlp
   Update to version GGR4.102

========== GGR4.103 [22 Feb 2017]

display.c
   Fix a display issue on de-extending a line (coming back to <~col 80
   after having gone beyond there on a long line).
   Looks like a code migration issue.  The loop in upddex() contained
   the 3.9e code, but with the now-absent w_fcol changed to w_fcolor,
   which was set to 7 resulting in an off-by-7 on the redisplay (the
   underlying data was OK, so a redisplay fixed things).
   Replaced with the 4.1 code (but kept the GGR fix on the loop
   constraint).

version.h
etc/uemacs.hlp
   Update to version GGR4.103

========== GGR4.104 [22 Feb 2017]

input.c
   Ensure that getstring doesn't return a garbage buffer, regardless of
   returned status.
   But beware that some callers use the output buffer as a temporary
   prompt buffer!

edef.h
efunc.h
globals.c
names.c
word.c
etc/uemacs.rc
   Add eos_chars() function, eos_list global list and eos-chars
   macro-callable function to set eos_list.
   Use the eos_list in both justpara() and fillpara() for end of
   sentence character handling (an additional space) and remove any
   such added space from the final sentence of a paragraph.
   Define the standard GGR setting ( .!? ) in uemacs.rc.

.gitignore
   Added core

archive/example.rc
   Added.

version.h
etc/uemacs.hlp
   Update to version GGR4.104

========== GGR4.105 [25 Feb2017]

docs/utf8.info
test-files/combining-diacritics
   Added

Makefile
   Replace "-D_BSD_SOURCE -D_SVID_SOURCE" with "-D_DEFAULT_SOURCE" in
   DEFINES for Linux. Some distros warn about this.

basic.c
   Use next_utf8_offset()/prev_utf8_offset() to find start of utf8
   characters.

display.c
   In updpos() we need to allow for the same number of characters
   used by vtputc() for *all* non-printing characters.

globals.c
names.c
random.c
word.c
edef.h
efunc.h
etc/uemacs.rc
   Rename *ggr.mode to *ggr.style, as it isn't a mode.

random.c
   Tidy up the current position display code in showcpos().

utf8.c
utf8.h
   Use MAX_UTF8_LEN for max length of a utf8 sequence. Which, since
   2003, is 4 (not 6).
   Add next_utf8_offset() and prev_utf8_offset() functions.
   Removed is_beginning_utf8().

word.c
   Change prompt in eos_chars() and display current setting.

version.h
etc/uemacs.hlp
   Update to version GGR4.105

========== GGR4.106 [26 Feb 2017]

Makefile
   Add back "-D_BSD_SOURCE -D_SVID_SOURCE" while keeping
   "-D_DEFAULT_SOURCE" in DEFINES for Linux.
   Both need to be there for a transitional period.
   Also added "-D_DEFAULT_SOURCE" to the non-Linux branches as the
   uemacs code itself doesn't use any of them so is just setting them
   for system header files, which can use them or not as they see fit.

archive/original-git.log
   The log of changes from the original pK4.0.15 git repository.

etc/uemacs.rc
   Add a description of some environment variable settings and set
   $overlap to 2 (which was the value used by 3.9e).

fileio.c
file.c
   Check for strcpy()ing a name to itself, which happens when
   activating an inactive buffer.
   The action of strcpy() is undefined for overlapping strings.
   On a Mac it will crash...

display.c
   Change the unexplained 4 in several malloc()s to be sizeof(unicode_t).

basic.c
   Correct the fix in forwpage() to stop before we loop round, and
   hence stay on the last line, not go one past it.
   (Incorrectly merged from 3.9e.)

input.c
   Remove a redundant set of braces around (c == (CONTROL|'I')) as
   otherwise the Mac compiler warns about a possible intended
   assignment.

version.h
etc/uemacs.hlp
   Update to version GGR4.106

========== GGR4.107...

README
CHANGES
KNOWN_ISSUES
   Added README, moved CHANGES and BUGS (=> KNOWN_ISSUES) up to main
   directory.

random.c
   In cinsert(), skip over trailing blank space when looking for a
   trailing '{' and keep correct indent count (not one less for blank
   lines).

charset.h
efunc.h
estruct.h
   Add #ifndef lines to allow for multiple inclusion.

bind.c
input.c
efunc.h
   Change ostring() calls to mlputs and some tidying.
   Remove unused outstring and (now) unused ostring code and
   declarations.

input.c
   getname() code re-indented to make it readable.
   Changed a while() loop to for().
   Increment ttcol during TTputc calls in the expansion code.

word.c
   Ensure that text comes back in the original order after multiple
   successive delete-previous-word calls.

main.c
   Extended usage() to list all available options.
   Added -h (for --help) and -V (for --version) options.
   Allow options to be given as separate tokens.
   Add -d option for specifying config/help directories.

bind.c
eval.c
exec.c
globals.c
main.c
spawn.c
edef.h
efunc.h
epath.h
   Redo code that looks for start-up/help files etc.
   Add INTABLE and INPATH modes to flook(). Fix calls in bind.c,
   eval.c, exec.c, spawn.c
   to use the appropriate setting.
   Add -i (insecure) command line option and associated global flag.
   Only look in current directory in flook() if the insecure (-i)
   command line option has been given.
   Add set_pathname() to bind.c to allow the command-line processing to
   alter the directory path to one given location.
   Alter the structure set-ups in epath.h.  You can now set the default
   table values by defining DFLT_PATH in the compilation options.  The
   help and start-up file names are now uemacs.hlp and uemacs.rc in all
   cases.

version.h
etc/uemacs.hlp
   Update to version GGR4.107

========== GGR4.108...

display.c
   Add NULL as missing 3rd arg (unused) in updateline() for MEMMAP &
   !SCROLLCODE call.

input.c
   Extend the VT220 conditional code inclusion to cover the
      if (c == 128+27) // goto handle_CSI;
   given that the target label is VT220 dependent.

input.c
   #ifdef for MSC not MSDOS when checking mbdepth against MAXDEPTH.

word.c
   Define "int c" within the #ifndef GGR_MODE block.

tcap.c
   Move includes of curses.h and term.h to be within the #if TERMCAP
   block.

display.c
globals.c
edef.h
   Make chg_width and chg_height global (also used by spawn.c).

spawn.c
   Moved code to force full window redraw into force_resize() and call
   this before returning from any function with a system() call.

termio.c
   Fix ANSI prototyping on some functions.

utf8.c
   Fix prev_utf8_offset() to use char for marker and valmask, so we
   don't end up sign-extending into an int and failing tests.

version.h
etc/uemacs.hlp
   Update to version GGR4.108

========== GGR4.109...
The Great Glyphing code change...

Most of this is about adding a structure to describe a character
displayed at a column (a glyph) which may contain multiple utf8
characters when some are Combining Diacritical Marks, or Zerowidth.
The glyph structure mainly affects vtputc() and updateline() (and
their callers) in display.c, but handling of zerowidth entities
extends elsewhere too.

Makefile
   Use gnu99, not c99 as the --std.

basic.c
   Skip over zerowidth characters in getgoal().
   Tell next_utf8_offset(), prev_utf8_offset() to go to the start of a
   glyph (i.e skip over zerowidth chars).

bind.c
   In bindtokey() and unbindkey() don't write out the message line
   (mini-buffer) prompts if we are processing start-up files.

display.c
   Explicitly initialize scrflags to 0.
   Move vtcol and vtrow to local static storage (display.c is the only
   user).
   Change struct video to have an array of struct glyph rather than
   unicode_t at the end. Changed parameters to affected routines.
   Added set_glyph(), extend_glyph() clone_glyph(), glyph_same(),
   glyph_same_array(), is_space(), TTputglyph() and TTput1char() as
   static functions.
   Add ttput1c() for external callers to reach TTput1char().
   Change vtinit() to setup a struct glyph array for the *whole*
   vscreen and pscreen arrays (not just the currently in use).
   Make the input to vtputc() an *unsigned* int.
   vtputc() now checks for a unicode character over the maximum allowed,
   and display the replacement character for it.
   vtputc() will extend any preceding character glyph on finding a
   zerowidth one.
   vtputc(), vteeol(), updgar(), scrolls(), updext() now call
   set_glyph() to add a character to vscreen.
   scrolls(), texttest() use glyph_same_array() and updateline() uses
   glyph_same() to check for a display change.
   endofline() and updateline() now use is_space() to check for a
   space, so we can cater for any added zerowidth modifiers.
   TTputc() calls were replace with TTputglyph()/TTput1char() ones and
   those functions adjust ttcol.
   Added a missing third arg (as NULL) to another updateline() call.
   Removed use of n as a column counter in modeline(), as vtcol is
   already doing it. Also "unblocked" a code section to remove an
   unnecessary extra level of indentation.
   Use clone_glyph to move vscreen glyphs to pscreen ones in
   updateline().
   Use sigaction(), not signal(), to set-up signals (portability).

edef.h
   Removed vtrow and vtcol (now local to display.c).

efunc.h
   Added ttput1c() and mlreplyall(). Removed (unused) do_backtrace().

estruct.h
   Include utf8.h.
   Define END_UCLIST.
   Lined up comments.

etc/uemacs.rc
   Added some char-replace settings.

globals.c
   Removed vtrow and vtcol (now local to display.c).

input.c
   Added mlreplyall() to get all of the function args in one go when
   called from a start-up script.
   Some TTputc() calls changed to ttput1c().
   Add a SIGWINCH (if defined) handler for getstring to abort the
   minibuffer if it occurs.  Being in a minibuffer confuses the redraw.
   Needs various signal block to ensure we don't pass though
   set-up/take-down code twice.

line.c
line.h
   Added lgetglyph() to get the struct glyph for the current character
   (or just its length).
   Changed ldelchar() to use lgetglyph() for how many bytes to remove.

main.c
   Some TTputc() calls changed to ttput1c().
   Removed the no longer used #define maindef
   Use sigaction(), not signal(), to set-up signals (portability).

names.c
   Added "char-replace" => char_replace() function mapping.

random.c
   In showcpos() use lgetglyph() to get the full glyph data for the
   current character. Display the number of bytes (and unicode
   characters( used in the glyph if more than one.
   Update getccol() to handle zerowidth characters.
   Modified twiddle() to handle multibyte and zerowidth characters.

spawn.c
   Some TTputc() calls changed to ttput1c().

utf8.c
utf8.h
   Modified utf8_to_unicode() to check that the resulting character is
   not more than the maximum utf8 allows.
   next_utf8_offset() and prev_utf8_offset() now have an option to skip
   over zerowidth characters.
   Added zerowidth_type() function and associated data structure.
   Added char_replace() function to map non- (or poorly) represented
   characters to a (user-configurable) replacement one. The list of
   what to map is also user-configurable.
   Added display_for() to work out what should be displayed for a given
   unicode character.

word.c
   Changed the end-of-sentence coding to use END_UCLIST as an end
   marker rather than 0xffffffff (for consistency).

test-files/combining-diacritics
   Added a few more lines

test-files/1ffff
test-files/3uc-test
test-files/3uc-together
test-files/3uc-together-twiddle
test-files/overrun.txt
   Added some small test files. May extend/document more later.

TODO
   Added to the top-level, as a reminder....

version.h
etc/uemacs.hlp
   Update to version GGR4.109

========== GGR4.110

tcap.c
   Change tcapkclose() to not send TE for the systems where it has just
   sent it in tcapclose().

bind.c
   If flook is sent a pathname, check just that and don't look in HOME,
   along PATH or in the table.

spawn.c
   Forbid the running of external commands when you are in the
   minibuffer (spawncli(), spawn(), execprg() and pipecmd()).
   There's a forced redraw on return, which ends up clearing the
   minibuffer data, while displaying its status in the status line.

estruct.h
   Set XONXOFF and NATIONL to 0 if GGR_MODE is defined.

posix.c
   Add turning off of IXON if XONXOFF is not set (as done in termio.c).
   Enables ctl-Q and ctl-S to be usable for commands.

bind.c
names.c
efunc.h
   Added an include-file command (for use in start-up files) to include
   another file for processing at that point.

word.c
   Fix justpara() and fillpara() when adding an eos space at the end of
   a line in the middle of a paragraph.

main.c
   Redo command line parsing.
   Add options:
      -c<filepath> replacement for default rc file
      -x<filepath> an additional rc file

version.h
etc/uemacs.hlp
   Update to version GGR4.110

========== GGR4.111

bind.c
exec.c
names.c
efunc.h
   Merge the include-file code added in GGR4.110 with execute-file, as
   they are essentially the same.

main.c
   Further command line handling tidying up.
   Fix -v/-e option handling when mixed in with filenames.
   Remove second startup file check (after handling filenames) and the
   now-redundant startflag variable.

display.c
spawn.c
   Fix up for screen refresh on return from external commands.
   Call newscreensize() at beginning and end of update(). Add a new arg
   to it to stop it calling update() when it is called from the start
   of update(). This ensures that term.t_nrow and term.t_ncol are set
   to "correct" values before we set off. [display.c]
   In updgar() and updupd() only update the minibuffer line when we are
   actually using the minibuffer. This allows us to remove the added
   mberase() call at the end of newscreensize(). [display.c]

   Add get_orig_size() to save the original screen size before
   system() calls.
   force_resize() checks the current col/rows and only sets the chg*
   variables to force a redraw if things have changed and also to set
   term.t_nrow and term.t_ncol back to what they were, not to 0, which
   can cause redraw issues in display.c.
   Renamed to check_for_resize(). [spawn.c]

version.h
etc/uemacs.hlp
   Update to version GGR4.111

========== GGR4.112

main.c
   Fix the -e/-v handling once we get to looking for files on the
   command line. You can use -v/-e to toggle view mode on/off as you go
   through the file list.

display.c
file.c
main.c
region.c
   Add in some buffer-narrowing code missed in the GGR migration to
   prevent you saving a narrowed buffer without first being queried.
   [display.c, file.c]
   In quickexit(), add back the mlwrite("\n") call when Saving files.
   This lets the user see which is affected if there is a narrowed
   buffer involved.  Also, if the user aborts redraw the screen to
   remove these filenames.  [display.c]
   When narrowing a region, move whichever of mark and point is further
   through the file to the start of the next line if they are not at
   the start of a line.  So you get any line if you are in the middle
   of it (this already happens to whichever is first in the file).
   When rewidening, redraw the screen with the start of the narrowed
   region in the middle of the window, which makes it more obvious that the
   other text has returned.
   [region.c]

version.h
etc/uemacs.hlp
   Update to version GGR4.112

========== GGR4.113
word.c
   Fix the re-allocation need check for wbuf to cater for char vs.
   unicode_t sizes.

tcap.c
   Make curses.h and term.h inclusion conditional, so CygWin and MinGW
   builds can work.

display.c
efunc.h
   Allow mlforce() to take a variable number of args by changing
   mlwrite() to mlwrite_ap() and making both mlwrite() and mlforce()
   front ends to that.

bind.c
buffer.c
ebind.h
edef.h
efunc.h
estruct.h
exec.c
globals.c
main.c
   Make the key table dynamically assigned (so no longer a fixed
   maximum number of bindings) and enable key binding to user-defined
   procedures.
   Add checks for given buffer/procedure name being too long. Silent
   truncation to 14/15 characters could result in running an
   unintended procedure.
   Change "special" buffer names from *name* to /name, since the
   latter leaves more room for "name" and also cannot be generated
   from a filename.

etc/uemacs.rc
   Updated to use the new buffer-to-key binding implemented above.
   This runs the user-defined store-procedure methods directly.
   Entries from the 40 hard-wired store-macro names are no longer
   used.

main.c
   Fix -v/-V handling for consistency.

../CHANGES
../KNOWN_ISSUES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.113

========== GGR4.114

epath.h
   Set DFLT_PATH to the "standard" locations of /opt/local/etc/ then
   /usr/local/etc/ for Unix-style systems.

buffer.c
exec.c
file.c
line.h
   Added lfillchars macro to fill line text buffer using memcpy()
   rather than looping one char at a time.

line.c
   linstr() takes a char * arg, but was passing this on to linsert(),
   which expects a unicode arg, and runs unicode_to_utf8() on it!
   Changed linstr() to call linsert_byte() instead.

etc/uemacs.rc
   Removed H (horizontal scrolling) mode from the toggle-lmode and
   toggle-gmode macros, as it no longer exists.

buffer.c
exec.c
file.c
globals.c
line.c
main.c
names.c
spawn.c
efunc.h
estruct.h
   Added code to handle "phonetic translation tables" on input.
   This allows you to define a table of strings that will be mapped to
   other strings, allowing for simple input of utf-8 characters.
   You may have multiple tables, but only one is ever "ready". Usage is
   defined by a mode (Phon) which may be turned on/off.

ptt/czech.cmd
   Created a ptt/ directory for ptt tables and added a Czech one.

../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.114

========== GGR4.115

ptt/czech.cmd
   Fix the z~ mapping.

basic.c
random.c
utf8.c
utf8.h
   Remove the unneeded third arg (maxlen) from prev_utf8_offset(). When
   going backwards the *minimum* offset is always 0!

Makefile
exec.c
   make use of the Julia language utf8/unicode library
      https://julialang.org/utf8proc/
   to detect character types.

      This first test was to determine the character type for a
      beginning-of-word test in phonetic translation table handling.

   The Julia language utf8/unicode library is now a pre-requisite for
   this version of uemacs (an beyond).

Simplify the code by removing various ifdefs by noting that we always
want:
   PKCODE = 1              // We are extending the pK version
   GGR_MODE = 1            // We really are extending the pK version
   EBCDIC = 0, ASCII = 1      // We're using Unicode
   VMS = 0                // No longer of use...
This will simplify the switch to using the Julia language utf8/unicode
library generally.

>>> VMS deletions
Makefile
vmsvt.c
   Deleted.

complet.c
file.c
fileio.c
input.c
main.c
search.c
spawn.c
termio.c
epath.h
estruct.h
   Deleted VMS references.

isearch.c
   Deleted IS_VMSFORW and IS_VMSQUOTE (also from estruct.h)

>>> EBCDIC/ASCII removal
estruct.h
   Delete EBCDIC. Enable all ASCII.
   Also remove IBMCHR, as we will be replacing isletter(), islower() and
   isupper() with unicode versions.

>>> GGR_MODE forced
display.c
word.c
estruct.h
   Removed GGR_MODE assuming it to be set.
   Also removed NATIONL, as we will be replacing isletter(), islower()
   and isupper() with unicode versions [estruct.h].

>>> PKCODE forced
ansi.c
basic.c
display.c
file.c
fileio.c
globals.c
ibmpc.c
input.c
isearch.c
main.c
names.c
random.c
search.c
spawn.c
tcap.c
termio.c
word.c
ebind.h
edef.h
estruct.h
   Removed PKCODE assuming it to be set.
   Except for:
     Enable "#" for truncated files. [display.c]

basic.c
word.c
   forword(), backword(), upperword(), lowerword() and capword() were
   changed to know about display characters (glyphs) and also to use the
   Julia utf8 library for character types (letters/non-letters) and case
   changing (upper letter to/from lower letter).
   Updated some comments to reflect that backchar()/forwchar() move by n
   display characters (glyphs) not bytes (have done since GGR4.109).

basic.c
display.c
exec.c
line.c
random.c
utf8.c
word.c
line.h
utf8.h
   Changed all references to glyph (including comments) to use grapheme
   instead, as that is what the Unicode documentation uses for the
   concept of the data to describe a sequence of coded characters that
   ‘should be kept together’ and there a glyph is something different.
   No code change.

exec.c
random.c
   Changed token() [exec.c] to not add the starting quote to a quoted
   token (it never added the closing one!).
   Changed istring [random.c] to treat the response as a set of token,
   and handled Unicode (U+xxxx) and utf8 bytes (0x..) in those.
   This allows you to enter known Unicode character points and utf8 code
   sequences. "Normal" text strings can still be added - but you now
   need to put them in "..." if they contain spaces.

random.c
   In showcpos(), remove the printing of the decimal code, and just
   display the unicode codepoint as U+xxxx.

ptt/russian.cmd
ptt/czech.cmd
etc/uemacs.rc
   Added a Russian pttable and moved the toggle-pttmode key binding to
   the main start-up file.

etc/uemacs.hlp
   Added some information at the end about recent additions to macros
   (eos-chars, char-replace, pttables, use defined procedure key
   binding.

Makefile
   Added code to enable finding the Julia utf8proc lib, and exit with
   an error if unable to find it.

../PREREQUISITE
../README
   Added a specific note about the use of the Julia utf8proc lib and
   also commented on it in the README file.

Makefile
   Added code to look for curses term.h.
   Probably specifc to Oleg's router distros, but could be extended
   for others as necessary.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.115

========== GGR4.116

Makefile
   Allow for version numbering on any local utf8proc directory name.

edef.h
efunc.h
random.c
   Disable toggling Phon mode on via adjustmode() if no pt_table is
   yet defined.
   Made adjustmode() static.

eval.c
evar.h
   Add inmb system variable, so macros can check for being, and disable
   use, in the minibuffer.

etc/uemacs.rc
   Change toggle-lmode/toggle-gmode to check $inmb and simplified(?)
   code.
   Added "P" (Phon) as a valid mode to toggle.
   Standardized mode chars to be those used by buffer displays.

etc/uemacs.rc
   Make the file-hooks macro look at the filename for the buffer, not
   the buffer name, as it was failing on long filenames where the
   buffer name is truncated.

utf8.c
   Remove a bug introduced in GGR4.109 (why?  - unknown) that prevented
   unicode 0x80-0xbf being converted to utf8.

word.c
efunc.h
   Expose the ensure_case() function so that it can be used by the ptt
   code in exec.c

etc/uemacs.rc
   Tidy up (remove debug code...) of toggle-lmode/toggle-gmode change.

basic.c
display.c
utf8.c
   Change utf8_to_unicode() so that it checks the incoming args and
   returns a value of 0, with a returned codepoint of 0, if the index
   is outside the given len range,
   Corrected getgoal() [basic.c], mlwrite_ap() and mlputs() [display.c]
   to ensure they don't call utf8_to_unicode() with index >= len.

exec.c
globals.c
utf8.c
estruct.h
utf8.h
   NOTE: globals.c was erroneously checked in as part of commit:
    01f484596f198e02339ddf60d57f933ef5272239
   Add code to handle casing options in Phonetic Translation tables.
   These can now do case modification of the replacement text.
   The tables can contain these commands:
      caseset-on        [which is the default setting]
      caseset-capinit1
      caseset-capinitall
      caseset-lowinit1
      caseset-lowinitall
      caseset-off
   Each applies to all following replacement rules until the next
   caseset-* command or the end of the table is reached,
   For caseset-off the replaced text is treated verbatim and it will do
   a verbatim replacement on a match.
   For the other cases the replaced text is checked case-insensitively.
   For caseset-on it will force upper-case of the replacement on a
   match if the first character in the replaced string is uppercase.
   For caseset-cap* it will uppercase the first character of the string
   (capinit1) or all words (capinitall).  The caseset-low* are similar,
   but force lowercase if the first character of the replaced string is
   lowercase.
   tolower_utf8(), uclen_utf8(), nocasecmp_utf8() and unicode_back_utf8()
   functions added [utf8.c]

line.c
   As utf8_to_unicode() now checks its args, lgetgrapheme() now needs
   to check for being at EOL and return a NL grapheme, so ldelchar()
   knows there is 1 byte to step over.

basic.c
exec.c
random.c
word.c
   Fix for delfword()/delbword(). These use forwchar()/backchar() to
   move over the section to delete, but these functions now move by
   grapheme, so you can no longer just count the number of calls and
   delete that number of bytes.
   Changed forwchar()/backchar() to return the number of bytes moved
   and fixed all callers accordingly.

ptt/czech.cmd
ptt/russian.cmd
   Edited to take account of the caseset-* commands to simplify/shorten
   tables.

basic.c
eval.c
exec.c
isearch.c
line.c
names.c
random.c
region.c
search.c
word.c
ebind.h
efunc.h
   Rename forwchar()/backchar() to forw_grapheme() and back_grapheme()
   as that is what they (now) do, and this should help to avoid
   confusion.
   Changed the return value of both functions on an incomplete move to
   be minus the actual move. Adjusted callers accordingly.

display.c
exec.c
estruct.h
   Added display-code option to ptt tables to let you give a
   2-character code to display in the mode line when it is on. It is
   preceded by "P-" and defaults to the first two characters of the
d    table name.
   Added an internal function, show_utf8(), to display.c to handle
   utf8 strings in the modeline.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.116

========== GGR4.117

exec.c
   Set the WFMODE mode on the buffer after setting the ptt table, so
   that the modeline gets updated with the change, if it is in use.

exec.c
   Unset ptt_storing after compiling a pttable in dobuf().

exec.c
names.c
efunc.h
   Added next-pttable function, to cycle through pttables.

posix.c
   Correct the number of characters to wait for.
   Only wait if we are at the start of an extended utf8 sequence, or
   have an Escape character.
   Replace the tcsetattr() call (doesn't seem to timeout on Ubuntu under
   Windows on Windows10?) with poll().

input.c
   Make display_handler dynamic, not static, so that it can handle
   recursion in the minibuffer.

basic.c
globals.c
word.c
edef.h
   Remove (unused) justflag from ctrulen(), renamed it to
   curline_empty() (which is how it is used) and simplified it.

etc/uemacs.rc
   Combined local and global toggle mode macros.
   Unbound Esc-^T (newwidth) as it is no longer needed with SIGWINCH
   handling and just messes up the display.

ptt/russian.cmd
   Fixes. Put non-alpha entries into caseset-off section and remove an
   uppercase setting (Y -> Ы) accidentally left in.

buffer.c
estruct.h
   Change the size of a buffer name (NBUFN) from 16 to 32. This is
   really to allow longer procedure names. makelist() in buffer.c was
   changed accordingly.

evar.h
   Change NVSIZE from 10 to 32. We aren't memory constrained nowadays.

random.c
   Update setccol() to handle zerowidth characters, and fix getccol().
   Reformatted (tidied) code of both.

line.c
line.h
   Updated lgetgrapheme() to return nothing if point is beyond end of
   line (shouldn't happen, but might in testing things that manipulate
   w_doto field).
   Added lputgrapheme() (currently unused...).

basic.c
   Fixed gotobop() and gotoeop() to check for whitespace, not inword(),
   and made them work properly at beginning/end of buffer.

random.c
   Fix forwdel() and backdel() calls in whitedelete to use (0, 1), not
   pass on the incoming f and n args!

eval.c
   Fix gettyp() to test for, and allow, negative numeric arg.

names.c
word.c
efunc.h
etc/uemacs.rc
   Combined the paragraph filling routines (fillpara() and justpara())
   into one main function (filler()) and make the old routines
   front-end this.
   Added makelist-region function, which is bound to M-^Q.
   Amended the lr-justify macro to work with the new fillpara().
   Bound  to M-^P in etc/uemacs.rc.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.117

========== GGR4.118

word.c
   Initialize status to FALSE in justpara() and fillpara() to avoid
   compiler warnings about possible undefined use.
   Don't add a newline in filler() if at end-of-buffer.
   Got to column, not byte offset, at end of buffer in justpara().

bind.c
etc/uemacs.rc
   Fix stock() to allow binding to M-^X in a command-file (could already
   bind it interactively).
   Bind execute-file to M-^X.

buffer.c
   Fix ltoa() to handle files >1GB by putting "+" in col1 of the size
   (not worth widening field, as such a size will not be common).
   Also correct array size definitions to match the new sizes.

names.c
word.c
efunc.h
etc/uemacs.rc
   Change makelist-region to use " o " as the label, and added
   numberlist-region to fill with (possibly) numbered paragraphs using
   the template stored in the user variable %list-indent-text.
   Fixed the region scan so that it works properly.
   In uemacs.rc, rebound makelist-region from M-^Q to M-/, bound
   numberlist-region to ^X-/ and set a default value of " %2d. " for
   %list-indent-text.

word.c
   After region_listmaker has run (for *list-region functions) set the
   mark to one character ahead of point, otherwise ctl-C will reformat
   the preceding paragraph - again.

etc/uemacs.hlp
   Added notes for makelist-region and numberlist-region and a
   description for the %list-indent-text user variable setting.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.118

========== GGR4.119

eval.c
evar.h
   Replaced the separate structure and tagging for environment
   variables and user functions (which had actually lead to an error if
   SCROLLCODE was not set!) with enums and in-structure settings.

bind.c
buffer.c
display.c
eval.c
file.c
globals.c
input.c
main.c
window.c
word.c
edef.h
estruct.h
evar.h
etc/uemacs.rc
   Re-added the horizontal scrolling code, having found it in an old
   version of 3.10 source from 1992.
   Reformatted several functions involved to use a 4-space indent.
   Renamed scrollcount to scrolljump. [display.c, eval.c, globals.c,
   edef.h, evar.h]
   Made update() re-entrant (by restoring incoming displaying value,
   not FALSE, at end) so that updpos() can call it (since it calls
   update()) to ensure we get an update as the cursor gets to the
   screen edge.
   Switch off horizontal scrolling around update() in the minibuffer
   [getstring() in input.c]

search.c
   Add a check in forwsearch() for being at end-of-buffer and fail if
   so.  If not the rest of the search code (both magical - mcscanner()
   and ordinary - scanner()) wraps round to the start and searches from
   there.

search.c
   Add the FAST search algorithm from 3.10 that was missed during the
   original GGR migration. It was in 3.9e (5 January 1988 comment).
   Defined FAST so as to use it.
   Note that the entire search code is still ASCII-centric.

buffer,c
file.c
   Added code to look for file-hooks-<<sfx>> function ahead of
   file-hooks, and to execute the first found.
   Moved the file-hooks running from swbuffer() and bfind() as the
   latter is reached before the filename is set when reading in a new
   file. The code is now in readin() and only run if lockfl is TRUE
   (which is an accidental convenience).
   So file-hooks now run for file loaded by filefind (^XF).
   They no longer run for files opened in VIEW mode (but that's fine,
   as none of the modes affects VIEW mode).

crypt.c
   Re-done to encrypt more than just ASCII codes (which meant that
   multi-byte utf8 characters were being left unchanged!).
   Now encrypts all bytes above and including space. This means we can
   never generate a newline, which would mess things up badly.
   Simplified the mod coding - mod95 function no longer required.

fileio.c
   Changed ffputline() to work in chunks, so it doesn't call fputc()
   (and possibly myencrypt()) once for each character written.
   Tidied up the whole file to 4-column indenting.

bind.c
   Moved mbstop() from buildlist() into desbind().

ebind.h
   Removed (temporarily?) the ^XD binding to bktoshell, as it messes up
   the tty (leaves it in raw mode?) and so is unusable.

line.c
   linstr() tidied up.  Removed the old linsert() code (in an "#if 0"
   section) and indented to a tab-stop of 4.

buffer.c
exec.c
   Check for excessive macro recursion.
   Also fixed the storeproc() call in storepttable() [exec.c] to not
   pass on the f and n args, as that could end up calling a numbered
   macro! Re-indented some code to a 4 tab-stop.

crypt.c
file.c
fileio.c
   Extended to encrypt all bytes. This required uemacs to be able to
   handle NUL characters on input, so ffputline() and ffgetline() were
   modified to do this. They also now work on 8kB blocks, rather than
   per-character, which significantly speeds up read/writing on large
   files.
   This makes the -n option a no-op.

globals.c
input.c
main.c
names.c
random.c
edef.h
efunc.h
estruct.h
etc/uemacs.rc
   A buffer (//kbd_macro) is now filled with the macro code for the
   keyboard macro as it is created. This allows you to edit it and/or
   save it to file for later execution.
   Various functions now need to add their result to the macro buffer.
   The running of this buffer has been bound to ^XV. The ^XE replay of
   the key strokes is currently unaltered, but these key-bidings may
   swap once this has moved beyond the experimental stage.
   Added insert-raw-string and macro-helper functions to enable this.

file.c
fileio.c
globals.c
edef.h
   Since ffputline() and ffgetline() now work via a cache there is no
   longer any need to run input into fline then copy it all into a
   struct line (which was done to avoid either doing a realloc on every
   character input or allocating unnecessarily large buffers for short
   lines). So modified ffgetline() callers to let ffgetline() call
   lalloc(), which it will mostly do once it knows the final line size
   and will reallocate and copy-over if required, and removed the
   related lfillchars() calls.
   Combined the read and write caches for ffputline() and ffgetline()
   since only one can ever be active at any one time.
   Removed ftrulen and fline, changed fline to be struct line *.

../KNOWN_ISSUES
../TODO
../CHANGES
version.h
etc/uemacs.hlp
   Notes about the non-ASCII search problem (for the next release?)
   Changed the PROGRAM_NAME_LONG from uEmacs/Pk to nuEmacs.
   Update to version GGR4.119.

========== GGR4.120

   Updates for encrypting files so as to make encryption compatible with
   JASSPA uemacs.
buffer.c
estruct.h
   Define and initialize b_keylen and b_EOLmissing in struct buffer.
crypt.c
   So no longer catenates your key to itself until it is at least 63
   chars long (the code is still there and can be enabled by setting
   PARANOID in the compile options).
file.c
   Use curbp->b_keylen, not strlen(curbp->b_key), as the key is
   self-encrypted and hence may contain a NUL.
fileio.c
   Handle the case of binary and crypt file which have no newline at the
   EOF.  We don't want to write these out if they weren't there
   originally.
   Added a heuristic test for where a file is binary.
   Newlines are now added *before* a line is written, except for the
   first call for a file write-out, and the final one is (probably)
   written in the flush call.
main.c
   Check that any command line given encryption key is not longer than a
   valid key length before copying it into the buffer.
   Save the keylength of the plaintext version as b_keylen.

buffer.c
file.c
   Moved the copy in of global modes in swbuffer() to be before the
   readin() call, as that runs file-hooks, which may well wish to set
   modes.
   Change file-hooks running order to be file-hooks then file-hooks-sfx,
   with each being run if it exists.

../README
../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.120.

========== GGR4.121

basic.c
eval.c
exec.c
file.c
isearch.c
line.c
names.c
random.c
region.c
search.c
word.c
ebind.h
efunc.h
   Restore forwchar()/backchar() functions for use by macros (as these
   require functions to return just TRUE or FALSE).
   These are just call-throughs to forw_grapheme() and back_grapheme(),
   which have now lost the unused "f" arg.
   Adjusted callers accordingly (all internal usage calls *_grapheme() not
   *char().

line.c
line.h
   Externalize the linsert_byte() call, as it's more efficient than
   linsert() when you know you have a byte, not a Unicode char.

random.c
   Changed string_getter() so that it doesn't process the results for
   rawstring() beyond unquoting a token.
   Modified istring() and rawstring() calls as a result.

main.c
   Modified the flush_kbd_text() so that text insertion can handle NUL
   characters.
   Extended the macro_helper() call to insert a NUL when given a 0 arg.
   Changed some linsert() calls to linsert_byte().

word.c
   Fix region_listmaker() to get the correct paragraph count.
   It was getting one too many of you were already at beyond the last
   character in a paragraph (at end-of-line).

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.121.

========== GGR4.122

main.c
   Don't update lastflag on a status display (i.e. showcpos()).
----------

buffer.c
file.c
globals.c
edef.h
   Set a flag before getfile() calls in filefind() and viewfile()
   [file.c] and readin() in swbuffer() [buffer.c] to say that we want to
   run file-hooks - don't use the lockfl value.
   Allows us to run file-hooks on view-file.
----------

 Fixes to handle double-width (or more) characters by using
 utf8proc_charwidth() for the column increment, not 1.

test-files/fillpara.long_jap.txt
   Test file
basic.c
   newcol in getgoal()
display.c
   curcol in updpos()
   Step back over any NUL graphemes when placing extended-line $ marker.
   [vtputc()]
   Pad the "unused" graphemes of multi-width characters with NUL. [vtputc()]
   When moving into a line extension, change any NULs following a
   multi-width character at the start of line to be spaces for correct
   alignment. [updext()]
random.c
   col in getccol().
   col in setccol().
word.c
   wordlen in filler().
----------

estruct.h
search.c
   Searching for utf8 chars (i.e. ones with a first byte >= 0x80) was
   failing as the search table was taking this to be a signed char!
   Defined a ch_as_uc() macro in estruct.h to cast to unsigned char, and
   used this where relevant.
crypt.c
line.c
posix.c
utf8.c
   Altered some (unsigned char) castings to use the ch_as_uc() macro.
----------

  Various changes to the minibuffer code so that PHON mode may be set
  there (to enable easier searching).  This meant that the minibuffer
  needed its own modeline display (to show PHON mode on/off, and which
  language).  At the same time I added code to names.c to allow
  searching by function address which enables us to use the per-function
  flags set there to allow/dis-allow usage in the minibuffer, rather
  than checking in each routine and calling mbstop() from there.

----- Details -----

Makefile
   Added idxsorter.c to the build and refreshed depends lists.

bind.c
   Added not_in_mb() call.
   getbind() now checks if in minibuffer and if call is allowed. If not
   it switches it to not_in_mb().

display.c
   Added mb_update() to display a modeline for the minibuffer, and set
   modeline() to call it if we are in the minibuffer.

edef.h
globals.c
   Added mb_info and not_in_mb_funcname definitions.

efunc.h
   Added not_in_mb(), init_namelookup(0 and func_info() definitions.

exec.c
   namedcmd() now checks if in minibuffer and if call is allowed.  If
   not it switches it to not_in_mb().

input.c
   Modified getstring() to show a modeline for the minibuffer. We also
   now return *all* of the minibuffer (not just the current line) as the
   value, which allows you to search for strings with newlines in.
   The ctl-I filename expansion only work on the current (visible) line
   contents, though.

main.c
   Added call to init_namelookup().

names.c
   Added init_namelookup() and func_info() to enable searching for
   function info by function address.

etc/uemacs.rc
   Remove minibuffer check from _mytoggle-mode

idxsorter.c
idxsorter.h
   Added sorting code.

NOTE!!!
   The indexed sorting code works, but could be improved.
   It currently sorts pointers as character arrays (which means it needs
   to know the endianness). Ideally it would sort these as numeric
   fields (and also then allow sorting of signed data).
----------

bind.c
buffer.c
exec.c
input.c
isearch.c
main.c
names.c
random.c
region.c
search.c
spawn.c
window.c
efunc.h
    Removed calls/references to mbstop().
    toggle-ptmode, add-mode, add-global-mode, delete-mode and
    delete-global-mode are now enabled in the minibuffer.
----------

bind.c
idxsorter.c
main.c
names.c
efunc.h
idxsorter.h
    Updated idxsort_fields() (in idxsorter.c) to handle numbers (signed,
    unsigned and pointers) "properly". It can also now sort
    NUL-terminated C-strings from in-memory pointers.
    Used this to provide quick lookups for key-bindings [bind.c] and
    function name lookups [names.c]
----------

input.c
    Added MDPHON to the list of modes allowed to persist in the minibuffer.
----------

  Added further indexing, and also code to delay indexing of bindings
  when processing a command buffer (which may well have multiple
  rebindings in it).

----- Details -----

bind.c
    Add indexed binary search for key mapping to bindtokey() and
    unbindchar() (previously only buffertokey() had it!)
    Move index_bindings() to be earlier in the file.
    Add key_index_valid global to trigger indexing rather then calling
    index_bindings(). As a result made index_bindings() a static function.
    Add pause_key_index_update global to delay indexing.
    Add back code to get_key_tab() to do a linear search when the index
    is invalid, but indexing is being delayed.
exec.c
    Set pause_key_index_update to 1 in dobuf() and restore original
    value on exit.
globals.c
    Add pause_key_index_update and initialize to 0.
main.c
    Add key_index_valid global to trigger indexing rather then calling
    index_bindings().
ebind.h
    Add key_index_valid and initialize to 0.
edef.h
    Add key_index_valid and pause_key_index_update.
efunc.h
    Removed index_bindings() declaration. It is now internal to bind.c.
----------

bind.c
exec.c
globals.c
edef.h
efunc.h
    Remember the keystroke for a "not in minibuffer" command and display
    that in the error message too.
----------

  Reworked getbind() to return a pointer to an information structure,
  rather than just a function address. This makes better use of the
  indexing.

----- Details -----

bind.c
    Renamed get_key_tab() to getbind() and changed callers of getbind()
    accordingly.  (Removed original getbind()).
    Removed getfname() and fncmatch() - no longer needed.
    Moved not_in_mb_error() to main.c

exec.c
    Fixed docmd() for to use name_info() not fncmatch().

input.c
    Fixed docmd() for to use name_info() not fncmatch().
    Corrected some fname->fnc->fname oddities in keyboard macro calls -
    just use fname directly.

main.c
    Modified to use new getbind() calls (mostly in execute()).
    Copied over not_in_mb_error() from bind.c.
    extend_keytab() now copies in init_keytab entries individually and
    sets the fi information pointer for each.

names.c
    Added back the final NULL entry to names[].  The binding listing
    code expects it to be there.

ebind.h
    Changed init_keytab[] to just be a list of key -> function items.

efunc.h
    Removed getfname() and fncmatch() declarations and changed getbind().

estruct.h
   Added name_bind pointer to key_tab structure.
   Added key_tab_init structure definition.
----------

spawn.c
    Fixed bktoshell by calling rtfrmshell(). It appears that the handler
    for SIGCONT doesn't get called on returning with "fg".
ebind.h
    Re-enabled the bktoshell key binding.
----------

  Move the minibuffer prompt back into the minibuffer. It didn't look
  right there, and would have become really odd with split windows once
  the modeline used for it was changed to that of the active window.

----- Details -----

bind.c
    Fix deskey so it display in the minibuffer.

display.c
    Put the minibuffer modeline handling back into modeline() and
    removed mb_update().
    The minibuffer now uses the active window modeline (which makes a
    difference with split windows). It displays abbreviated mode flags
    for the minibuffer, and also notes when it is multi-line.

globals.c
edef.h
    Modified mb_info structure fields.

input.c
    Put back the code to have the prompt in the minibuffer itself.

main.c
    Check for "skip_in_macro" before checking for namedcmd.

names.c
    The binary chop method in func_info() was changed to be one which
    always finds the first entry for any duplicated keys.
----------

  More indexing bits. Including adding the concept of a "next" index to
  the index sorting. Used this for building the keybinding list.

----- Details -----

bind.c
    Add indexing of the keytab data by function, and also create a
    "next" index for it (index_keystr(), next_getbyfnc(), getbyfnc()).
    Fix bindtokey() and buffertokey() to check the need extend_keytab()
    correctly, now that we are using indexed lookups.
    Modify buildlist() to use index routine calls while building the
    function list.

efunc.h
    Add nxti_name_info() declaration.

idxsorter.c
idxsorter.h
    Add make_next_idx() function.

main.c
    Don't declare an internal keytab_alloc_ents in main - there's a
    global of the same name!  Now named init_ents.

names.c
    Remove the end NULL entry from names[] (no longer needed as we use
    indexing to go through the entries).
    Create a "next" index for name_index[].
    Remove extraneous code lines (errant copy&paste?) at the end of
    func_info().
----------

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.122.

========== GGR4.123 [24 July 2017]

idxsorter.c
    Fix the index to be 0-based during the final permutation loop,
    rather than using a special "decrement-by-one" loop.
----------

efunc.h
isearch.c
search.c
    Fix incremental searching (which must have been failing for ages).
    scanmore() was moved form isearch.c to search.c, as it needs to set
    up the patterns and set mlenold and matchlen.

----------
basic.c
display.c
random.c
line.h
    Fix column counting when displaying a tab character, and remember to
    add the '$' at the right-hand column to indicate an over-long line.
    Missed/messed up in the double-width display changes.
    Created a macro for the common column-updating code.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.123.

========== GGR4.124 [28 Aug 2017]

buffer.c
    Return on abort, don't used saved name [usebuffer()].
    Add do_savnam check before saving buffer name [swbuffer()].
globals.c
edef.h
    Add do_savnam, initialized to 1.
main.c
    Change create_kbdmacro_buffer() to call kbdmac_buffer_toggle()
    to get to/from the macro buffer.
    Set do_savnam to 0 (and restore it to 1) around swbuffer() calls
    and save/restore curwp data across a GetTo/OutOf call pair
    [kbdmac_buffer_toggle()].
    Call end_kbdmacro() if recording a macro [ctrlg()].
    Set kbdmode = STOP in end_kbdmacro().

globals.c
    Initialize scrolljump to 0, not 1.

line.c
    If the buffer is empty add a dummy space before restoring text and
    remove it afterwards. Without this the restored text is left off the
    top of the screen and the mark ends up moving with dot [yank()].

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.124.

========== GGR4.125

bind.c
    Cast function pointers to void* before order comparison to remove
    warning on Mac. [getbyfnc()]
    Remove unused nptr variable. [buildlist()]
names.c
    Cast function pointers to void* before order comparison to remove
    warning on Mac. [func_info()]

display.c
    Simplify ex section code in extend_grapheme().
    DO NOT free any target ex field in clone_grapheme() as this is
    always a vscreen to pscreen copy, and we deal with alloc/free in the
    vscreen side. Also don't allocate one-too-many items.
    Correctly initialize all of the vscreen items (not every third one!).

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.125.

========== GGR4.126

pklock.c
   Replace (deprecated) cuserid() with getpwuid(geteuid())

eval.c
   gcc7 has an option to check for case statements that fall through
   implicitly. Enabling it found a bug here.
   Consequently decided to compile with -Wall -Wextra.
   As a result:
   * added /* Falls through */ comments in appropriate locations:
    main.c      search.c
   * removed some unused function parameters:
    fileio.c
   * added an UNUSED() macro for unused function parameters in:
    estruct.h
    basic.c     bind.c      buffer.c    crypt.c     display.c   exec.c
    file.c      input.c     isearch.c   line.c      main.c      random.c
    region.c    spawn.c     tcap.c      utf8.c      window.c
   * changed some int to be unsigned int:
    eval.c      exec.c      isearch.c   main.c      search.c    utf8.c
   * changed some code around a setjmp/longjmp pairing:
    input.c
   * moved "static" to be at the start of a declaration:
    utf8.c
   * used the function parameter width in filler() rather then the
     global fillcol:
    word.c

input.c
    Make two variables volatile to avoid warning about longjmp
    clobbering them.

../CHANGES
../README
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.126.

========== GGR4.127

main.c
    Correct an horrendous bug when inserting a new character. These
    arrive as unicode, but the code called linsert_byte() to insert this.
    The attached comment said "We get utf-8, not Unicode" - why is a
    mystery, as it was never inserting a string.
    This was resulting in attempts to add things like  (2-byte utf8 -
    0xc3 0xbc) ending up as "extended ASCII" (0xfc) and hence non-utf8!
    It also stopped any other extended characters from being entered at
    the keyboard.
eval.c
exec.c
    Rename linsert() to linsert_uc().
input.c
    Change linsert() of a char to be linsert_byte().
line.c
line.h
    Change linsert_byte() prototype to have a char as second parameter.
    Change linsert() to linsert_uc() and make the second parameter a
    unicode_t.
    Change lowrite() prototype to be a unicode_t.
random.c
word.c
    Change linsert() to linsert_uc().
    Change linsert() for space, tab, # and (*)char to use linsert_byte().

../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.127

========== GGR4.128

random.c
line.h
    Use update_screenpos_for_char macro in setccol().

display.c
    Use show_utf8() to display the buffer name.

file.c
    Change makename() and unqname() for unique buffer naming.
    When generating a buffername from a filename makename() now leaves
    4-chars at the end for unqname() to fill in with numbers to create a
    unique name.
    The routines also now handle unicode names.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.128

==========

globals.c
input.c
estruct.h
etc/uemacs.rc
    Added an "eQuiv" mode setting (for utf8 searching).
    No support code to use it yet.

search.c
estruct.h
    Removed MAGIC as a compile-time option - it is now hard-wired.
    Reformatted search.c ahead of editing for utf8 searching.

names.c
    Mark next-buffer as "not in mini-buffer".

input.c
    Check for winch_seen before calling ctrlg()/TTflush() on ABORT in
    getstring().
    This allows macro-collecting to continue over a window resize.

file.c
    Fix buffername generation in makename().

main.c
    Check for there actually *being* another argument before assigning
    it to -c/-d/-g/-k/-s/-x options.
    Add a (required) call to setpattern() for the -s option.
    Reformatted main() to use 4-space indents (also quickexit(),
    emergencyexit(), quit(), ctlxrp() and ctlxe ()).

----------

    Added a set of ring-buffers for the last search and replace buffers
    (one set each).
    This allows you to recall (and re-use) the last 10 search/replace
    strings.
    The mechanism requires a way to update the prompt in getstring()
    as it goes back to loop: This is done using prmpt_buf.

----- Details -----

edef.h
globals.c
    Removed duplicate pat and rpat declarations [edef.h].
    Added in_search_prompt and prmpt_buf. Initialized in globals.c.
    Changed some
         struct xxx {...};
         (extern) struct xxx xxx;
    definitions into
         typedef struct xxx_st;
         (extern) xxx_st xxx;

efunc.h
    Added init_search_ringbuffers(), next_sstr(), prev_sstr() and
    select_sstr() declarations.

input.c
    Changes to getstring().
    o Update the prompt if prmpt_buf.update is set.
    o Preload the result buffer if prmpt_buf.preload is set.

main.c
    o Call init_search_ringbuffers().
    o Remap nextwind/prevwind/listbuffers to (respectively)
      next_sstr/prev_sstr/select_sstr if in_search_prompt is set.
    o Add vis_key_paras setting for no keystroke (not ring-buffer related!).

search.c
    o Added the code to handle search/replace ring buffers.
      init_search_ringbuffers(), update_ring(), previn_ring(),
      nextin_ring(), prev_sstr(), next_sstr() and select_sstr().
    o Modified readpattern() to handle the reprompts as we move through:
        * Take and restore a copy of in_search_prompt around the
          mlreplyt() call and set it to 1 for the call.
        * Set this_rt for the current call before *and* after the
          mlreplyt() call
        * Update the FAST search tables for any default string used.
        * Add the string to the ring buffers if it is a new string.
        * Save and restore the incoming base prompt
    o Reformatted many &mcpat[0] (and similar) to be just mcpat.
----------

../CHANGES
../README
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.129
   Added information on the search ring buffers to README and uemacs.hlp.

========== GGR4.130

random.c
    Changed backdel() to check that back_grapheme() succeeds before
    running kdelete() and marking the command as a CFKILL one.

display.c
    Fixed mlwrite_ap() to print (nil) when passed a NULL pointer to a
    string, rather than crashing with SIGSEGV.
    Reformatted code to 4-space indents.

----------

    Added a set of kill-buffers for the last deletes.
    If you yank (^Y) you can then do yank_prev_killbuf (Esc-Y) to change
    that yanked text with the previous deletes in turn. Only works if
    you do nothing else after the yank.
    Also works after yank-minibuffer.
    Note that yanking rotates the kill-ring list.

----- Details -----

ebind.h
    Add META-Y binding for yank_prev_killbuf.

edef.h
    Declare kused and kbufh to be arrays (of dimension KRING_SIZE).

estruct.h
    Define CFYANK flag. Set when last command is a yank*.

eval.c
    Moved getkill() up and removed unneeded additional declaration.
    Changed getkill() to use kbufh[0] not kbufh to get data.
    Forced a trailing null into the result - the kill buffers have a
    known length so don't have nul-terminated data strings.

globals.c
    Define kused and kbufh as arrays.

input.c
    Set a mark before restoring the last minibuffer in yankmb() so that
    yank_prev_killbuf(0 can replace the region.
    Mark yankmb() as a CFYANK function.

line.c
line.h
    kdelete() changed to delete the last item in the kbufh array, then
    move the rest down one (freeing the top entry).
    kinsert() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).
    yank() changed to use kbufh[0] (from kbufh).
    Added a rotate_kill_ring() function. Not bound by default, but can
    be run by Esc-x rkr.
    Added a yank_prev_killbuf() function to, if the previous command was
    a yank:
        o rotate the kill buffer (by any numeric arg)
        o remove the yanked region (discarding it - not putting it on the
          kill ring).
        o inserting the current top kill=ring buffer.

names.c
    Added an entry for rotate_kill_ring as "rkr".

word.c
    delbword() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).

----------

(search.c)
../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.

========== GGR4.131

edef.h
globals.c
input.c
region.c
(line.c)
    If the last command was a yank then kill_region doesn't need to save
    the killed text, as it is already at the top of the kill-ring.

efunc.h
eval.c
input.c
search.c
    Fix the code for replace-string (sreplace) so that it works again
    after the replace-ring code added in GGR4.130.
    Drop the code for search/replace prompt updating as we go through
    the search-ring into a function (new_prompt()). [efunc.h, search.c]
    Call new_prompt() if a macro sets $search or $replace [eval.c]
    Clear prmpt_buf.update on entry to getstring() in case some
    mis-coding(?) has left it set. [input.c]
    Let empty Replace strings go onto the replace-ring buffer [search.c]
    Fix the check for what to do on an empty response in getstring(). We
    do want to save empty Replaces, but not if the current top-of-ring
    is empty. [search.c]

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.

../README
(search.c)
(search.c)
../CHANGES
../README
version.h
etc/uemacs.hlp
   Update to version GGR4.130
   Added information on the kill ring buffers to README and uemacs.hlp.

========== GGR4.130

random.c
    Changed backdel() to check that back_grapheme() succeeds before
    running kdelete() and marking the command as a CFKILL one.

display.c
    Fixed mlwrite_ap() to print (nil) when passed a NULL pointer to a
    string, rather than crashing with SIGSEGV.
    Reformatted code to 4-space indents.

----------

    Added a set of kill-buffers for the last deletes.
    If you yank (^Y) you can then do yank_prev_killbuf (Esc-Y) to change
    that yanked text with the previous deletes in turn. Only works if
    you do nothing else after the yank.
    Also works after yank-minibuffer.
    Note that yanking rotates the kill-ring list.

----- Details -----

ebind.h
    Add META-Y binding for yank_prev_killbuf.

edef.h
    Declare kused and kbufh to be arrays (of dimension KRING_SIZE).

estruct.h
    Define CFYANK flag. Set when last command is a yank*.

eval.c
    Moved getkill() up and removed unneeded additional declaration.
    Changed getkill() to use kbufh[0] not kbufh to get data.
    Forced a trailing null into the result - the kill buffers have a
    known length so don't have nul-terminated data strings.

globals.c
    Define kused and kbufh as arrays.

input.c
    Set a mark before restoring the last minibuffer in yankmb() so that
    yank_prev_killbuf(0 can replace the region.
    Mark yankmb() as a CFYANK function.

line.c
line.h
    kdelete() changed to delete the last item in the kbufh array, then
    move the rest down one (freeing the top entry).
    kinsert() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).
    yank() changed to use kbufh[0] (from kbufh).
    Added a rotate_kill_ring() function. Not bound by default, but can
    be run by Esc-x rkr.
    Added a yank_prev_killbuf() function to, if the previous command was
    a yank:
        o rotate the kill buffer (by any numeric arg)
        o remove the yanked region (discarding it - not putting it on the
          kill ring).
        o inserting the current top kill=ring buffer.

names.c
    Added an entry for rotate_kill_ring as "rkr".

word.c
    delbword() changed to use kbufh[0] and kused[0] (from kbufh and
    kused).

----------

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.131

========== GGR4.132

----------

    Fixes related to yanking and <CR> at the end of buffer.
    This could result in:
    o   mark and point both ending up at EOB (so yank-replace and
        kill-region both failed)
    o   an additional blank line added at end of buffer

ebind.h
line.c
line.h
names.c
    Rename yank_prev_killbuf to yank_replace (and yank-prev-killbuf to
    yank-replace) [ebind.h, line.c, line.h, names.c]
    If we are adding a newline at the end of the last line, and it is not
    empty, don't allocate a new line - just move w_dotp to the next line
    and set w_doto to 0. [line.c]
    Force the newline in lnewline() if a yank didn't start on the last line.
    [line.c]
    If yank() has no text to insert, still mark it as a yank (otherwise
    yank-replace can't get kick-started [line.c]

---------- Description of issue and solution.

To stop the "phantom" newline being added if you (say) yank a line of
text at End-of-buffer:

In lnewline(), if we are on the last line (actually next-line = the
headp) and are at the last character in the line (so not splitting a
line) and the line is not empty (so it's not a "dummy" last line) we
just update the current point (doto) the start of the next line - we
don't actually add any line at all.

But this leaves us with the issue of:

   ...text...
   <empty>
   <empty>

compared to:

   ...text...
   <empty>

If you enter text into the middle line of the former you get:

   ...text...
   new-text
   <empty>

while if you enter it into the empty (last) line of the latter you get:

   ...text...
   new-text
   <empty>

i.e. the same, as uemacs will add a final (logical) newline. But we need
to distinguish between the two if that new-text ends-with  a newline -
in the first case we want it to be added whilst on the latter we don't.

So, in yank (the newline function for <CR> is OK) I set a force_newline
flag if a newline is about to be inserted and we weren't on the last
line when starting the yank ( a fact that is already known for a fix-up
to mark when yanking at end-of-buffer).

----------

names.c
    Re-add a final NULL entry at the end of names[] as getname() uses a
    serial search and expects to find it there.

input.c
    In getname() take an exact match as found, even if it is also a
    partial match for something else. Otherwise you can never use
    "set" interactively.

edef.h
eval.c
evar.h
globals.c
line.c
    Add yank_mode variable. [edef.h, globals.c]
    Tie $yankmode environment variable to yank_mode. [eval.c, evar.h]
    Handle yank() and yank_replace() (was yank_prev_killbuf()) according
    to the user-defined style ("old" or "gnu"). [line.c]
    yanking an empty string must still set an empty region at the
    current location. [line.c]

    yank styles:
    old:
        ctl-Y (yank) inserts the last-killed string.
        Esc<n> ctl-Y inserts <n> copies.
        Esc-Y (yank_replace):
            if the last command was a yank this replaces that region
            with the previous kill-ring buffer entry, otherwise it
            just inserts the last-killed string (== ctl-Y).
        Esc<n> Esc-Y rotates the kill-buffers by <n> before doing the
        replace.

    gnu:
        ctl-Y (yank) inserts the last-killed string.
        Esc<n> ctl-Y rotates the kill-ring buffers by <n> then inserts
        the current "top" kill-ring string.
        Esc-Y (yank_replace):
            if the last command was not a yank it complains and does
            nothing
            otherwise it replaces that region with the previous
            kill-ring buffer entry
        Esc<n> Esc-Y rotates the kill-buffers by <n> before doing the
        replace.

    The default setting is "old". To change this use:
        set $yankmode gnu
    in your personal uemacs.rc file.

Makefile
main.c
    Add code to generate a stack trace dump on some signals (including
    TERM, so you can find out where a forever loop is).
    Built when TRACE=1 is supplied to the make command.
    This REQUIRES the addr2line program to be accessible.

line.c
    Improve the code to handle yanking into an empty buffer.
    Consolidate the setting of an empty-region at point before yanking.

(basic.c)
../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.132

========== GGR4.133

../PREREQUISITE
Makefile
main.c
    Rework the stack dump code to use libbacktrace.
    Enable the signal handler for all builds: the TRACE option now just
    adds the traceback dump.
    Reworked Makefile to look for the libbacktrace library.
    Added libbacktrace information to the PREREQUISITE file.

line.c
    Change the reposition() in yank() when yanking into an empty buffer
    to put as much yanked text as possible on screen.

main.c
    Extended the stack dump handling to:
      o set stdout to autoflush, so that output interleaves correctly
        with stderr
      o save any modified buffers (and keyboard macro) as
        date-tagged files in a uemacs-dumps/ directory in the user HOME.
        An INDEX file there contains a mapping to the original file names.

Makefile
    Change to -g1 for TRACE, which is sufficient to get line numbers.

names.c
    Ignore the terminating NULL entry in the needed count for
    idxsort_fields().

edef.h
eval.c
evar.h
globals.c
efunc.h
main.c
Makefile
    Added the $autoclean environment variable.
    Add automatic uemacs-dumps/ directory cleanup on start-up based on
    the setting of the $autoclean environment variable.
      o -ve  don't do any
      o 0    remove all files at start-up
      o +ve  remove files older than <n> days
    The default $autoclean setting is 7. You may set your owne value in
    a start-up file.
    If you set the $autoclean variable after start-up that setting will
    have immediate affect for this run of uemacs.
    Added -D_GNU_SOURCE to Linux compile options.

../CHANGES
../PREREQUISITE
version.h
etc/uemacs.hlp
   Update to version GGR4.133

========== GGR4.134

Makefile
   Shell expand dlist before finding which ones exist - to expand any
   wildcard matching multiple entries.
   Changed dlist to blist for BCKT location finding.

buffer.c
edef.h
efunc.h
eval.c
evar.h
globals.c
word.c
etc/uemacs.rc
    Changed makelist-region and numberlist-region to use an environment
    variable (regionlist_text, regionlist_number) for the label rather
    than, respectively, a hard-wired value or user variable. [edef.h,
    eval.c, globals.c, word.c, etc/uemacs.rc]
    Also added const to kbdmacro_buffer and arg1 of bfind declaration
    [buffer.c, edef.h, efunc.h, globals.c]

----------

    Fixes to the minibuffer, and input, so that the minibuffer use
    doesn't need to be cancelled on SIGWINCH.
    (Plus some related tidying up).

---------- Details ----------
bind.c
efunc.h
exec.c
input.c
    Make the prompt a parameter to the getname() call, so that it can
    be redisplayed on a resize.
    getname() now checks for a return char of END_UCLIST (illegal) and
    redraws what it already has if it sees it.

display.c
efunc.h
    Make newscreensize() an external function.

edef.h
globals.c
    Extended mb_info definition to include saving wheadp.

input.c
    Set an internal flag to optionally disable syscall restarts around
    the TTgetc() call, so that we can tell a signal (SIGWINCH) has
    arrived and allow input routines to handle this.
    An illegal unicode value (UC_LIST) is returned and not recorded to
    macros.
    Make the SIGWINCH handler set SA_RESTART on set-up.
    Simplify the original signal handling on leaving getstring().
    Remove the setjmp/longjmp calls and associated flags.
    The handler now saves curbp, curwp and wheadp on first entry and
    restores these before running the resize code. It then sets things
    back. If it arrives from a minibuffer it copies the whole curwp
    structure, as minibuffers all now share the same struct window.
    Create the struct window for minibuffers.
    Base minibuffer names on the minibuffer level "//minib%04d" and
    removed tmpnam().

----------

Makefile
    Fix variable re-usage that lead to missing library locations.

edef.h
estruct.h
file.c
fileio.c
globals.c
main.c
etc/uemacs.rc
    Added a DOS mode, for files with DOS line endings.
    If the first line of a file ends with \r\n the buffer is put into
    DOS mode, and the \r is remove from all lines. This only affects
    reading a file into a new buffer. [file.c]
    Writing out a buffer in DOS mode will write \r\n at the end of each
    line. [fileio.c]
    You can toggle the DOS mode in a buffer, but it only has an effect
    when reading in or writing out a file.
    Included files are also checked for DOS endings, but do not change
    the current buffer mode.
    Add a workaround to (re)display the number of lines read in for the
    first file given on the command line, as otherwise it is lost in the
    initial screen drawing [file.c, globals.c, main.c, edef.h]

Makefile
    Make TRACE the default for x86_64 if the backtrace include file can
    be found, and change the option to NOTRACE to turn it off.

edef.h
globals.c
input.c
line.c
line.h
    Add a kill ring for the last minibuffers.
    Moved the minibuffer saving and yankmb() code into line.c (with
    yank/yank_replace). Enabled local static declarations rather than
    global ones.
    getstring() now calls addto_lastmb_ring() rather than copying to
    lastmb directly.
    Added static lins_nc() routine to insert a known byte count from a
    pointer, rather than a C-string. [line.c]
    Added the yank() tests for handling empty buffer and end of buffer
    to yankmb(). These routines are now very similar, but sufficiently
    different to keep them separate.

    NOTE!!
    Minibuffers (and hence search strings) are usually limited in size -
    often to 128 characters.  This is silently truncated if you overstep
    the length, so a yankmb() might not get all that you expect if you
    copy a large region into a minibuffer.  The kill ring always
    contains all of a delete.

display.c
estruct.h
input.c
line.c
random.c
utf8.c
word.c
    Changed END_UCLIST to be UEM_NOCHAR, better fitting a more general
    usage.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.134

==========

display.c
edef.h
exec.c
globals.c
random.c
    Remove modename[] and just use mode2name[] case-insensitively in tests.

buffer.c
file.c
    Run resetkey() after file-hooks run [file.c]
    Set the b_active flag before running readin() (and hence before
    file-hooks run) [buffer.c]

file.c
    Fix minibuffer display when reading a non-existent file given on the
    command line ([New file]).

exec.c
main.c
estruct.h
    Allow store-procedure to set skip_in_macro and not_mb flags for
    the stored buffer code and check for this in execute().

names.c
etc/uemacs.rc
    Tag more functions as not_mb ones.
    names.c:
        change-file-name, change-screen-size,  change-screen-width,
        count-words, move-window-down, move-window-up, name-buffer,
        restore-window, save-window, scroll-next-up, scroll-next-down,
        set-encryption-key, set-fill-column, unmark-buffer
    etc/uemacs.rc
        spell-check, lr-justify

word.c
    Use linsert_uc() to add the wbuf word, not linsert_byte(), as it is
    a unicode array.

line.c
line.h
names.c
    Change yankmb() to check the yank_mode setting (as yank() does).
    Change rotate_kill_ring() to be an internal, rather than a bindable,
    function.
    Mark lowrite() and ldelnewline() as static, not external.
    Removed lgetchar() - lgetgrapheme() must be used.
    Mark lputgrapheme() as CURRENTLY_UNUSED.

random.c
ebind.h
estruct.h
    When in DOS mode, allow for the extra \r at the end of each line
    when reporting the position in showcpos().
    Reformat file to 4-space indenting.
    Assume NBRACE is set (remove old insbrace() code) and remove its
    setting from estruct.h.
    Assume CFENCE is set.
    [Also main.c and names.c fixups later...]

----------
Various removals for optional code. Just set these to be on - there is
sufficient memory in systems nowadays.
This makes the code easier to read.
----------

ebind.h estruct.h exec.c names.c word.c
    Assume PROC is set.

buffer.c crypt.c ebind.h estruct.h file.c fileio.c main.c names.c
    Assume CRYPT is set.

basic.c buffer.c crypt.c ebind.h estruct.h file.c fileio.c main.c
names.c word.c
    Assume WORDPRO is set.

ebind.h estruct.h isearch.c names.c
    Assume ISRCH is set.

bind.c ebind.h estruct.h names.c
    Assume APROP is set.

bind.c ebind.h estruct.h names.c random.c
    Assume AEDIT is set.

display.c estruct.h main.c
    Assume CLEAN is NOT SET!

ansi.c bind.c epath.h estruct.h file.c fileio.c search.c spawn.c tcap.c
termio.c vt52.c
    Remove V7 and EGA.

ansi.c basic.c display.c estruct.h eval.c evar.h ibmpc.c line.c random.c
tcap.c vt52.c window.c
    Assume SCROLLCODE and CVMVAS are set.

estruct.h eval.c main.c termio.c
    Assume TYPEAH is set.
    Remove unused ADDCR from estruct.h

posix.c
estruct.h
Makefile
tcap.c
    Enable compiling under CygWin.
    If __CYGWIN__ is set, define __linux__  [estruct.h]
    Set compilation options if under CygWin [Makefile]
    Set undefined (non-POSIX) XCASE, ECHOPRT and PENDIN to 0 [posix.c]
    Do include curses.h and term.h for CygWin [tcap.c]

display.c
eval.c
exec.c
main.c
random.c
efunc.h
    Change itoa() to ue_itoa() to avoid name-clash in CygWin.

efunc.h
display.c
    Fixes for handling the ex field in graphemes.
    Add no_free flag to set_grapheme() and set it when calling for a
    pscreen entry. Also make the function static (and move it up the file)
    as it is only used here.
    Don't allocate space for an existing ex section in clone_grapheme.
    This was a memory leak, as we never free from pscreen.

estruct.h fileio.c
    Assume CTRLZ is NOT SET!

bind.c complet.c ebind.h epath.h estruct.h file.c fileio.c input.c
main.c spawn.c termio.c
    Assume MSDOS is NOT SET!

main.c
    Add SIGABRT to the list of signals handled.

estruct.h search.c
    Assume TURBO is NOT SET!

estruct.h input.c search.c
    Assume MSC is NOT SET!

eval.c
exec.c
line.c
line.h
main.c
random.c
   Rename ldelchar() to ldelgrapheme(), as that is what it does.

../CHANGES
version.h
etc/uemacs.hlp
../test-files/multi-uc-graphemes
   Update to version GGR4.135

========== GGR4.136

main.c
    Use buffer (proc) name when reporting that an execute-procedure
    cannot be run in the mini-buffer.

line.c
    Run through the correct pointers in kdelete.
    Keep mark on original line if at eol when adding a newline.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.136

========== GGR4.137

search.c
    Add four missing ch_as_uc() macros wrappers for isalpha calls.
    Affects old systems that use a lookup table.

pklock.c
    Make compilation conditional on FILOCK being set.

display.c
    Rename TTput1char to be TTput_1uc, as it handles unicode.

line.c
    Use the correct pointer to get np when freeing multi-block kill
    buffer ring text in kdelete().

eval.c
file.c
globals.c
edef.h
evar.h
    Add an autodos system variable to enable/disable the DOS file
    detection as a file is read.
    The default setting is TRUE.
    NOTE that this flag is checked, and the pre-buffer DOS flag
    set/unset at any re-reading of a file.

etc/uemacs.rc
    Extended the toggle-mode code to have an "F" option, which toggles
    the autodos flag value.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.137

========== GGR4.138

random.c
    Make gl_descr larger to prevent gcc8.2 (Ubuntu 18.10) warning about
    snprintf() possibly having too much to put into the buffer.

input.c
    Handle a bug in gcc4.4.7 that reports "may be used uninitialized"
    for restoring wsave. Add more comments to save/restore blocks.
    Simplify inmb setting.

input.c
    A better fix for the "may be used uninitialized" issue with
    gcc4.4.7.

buffer.c
input.c
region.c
    Fixes to check for the BFNAROW flag being set on reading in a file to
    a buffer.
    Without this you can narrow a file, re-read it, then widen it again
    to get a modified file (entire file within the region of the file)
    that is marked as unmodified.
-----
    If bclear() is about to clear a narrowed buffer, then widen it first
    so that all lines may be freed. [buffer.c]

    Clear the minibuffer line of the prompt at end of mlyesno().
    (Format all file to my 4-space standard.) [input.c]

    sleep(1), rather than reposition, at end of widen() if n is passed
    in as -ve. [region.c]
-----

line.c
    Speed up the most-likely case (an ASCII char) [linsert_uc].

Makefile
epath.h
    Enable a static armv7l build for Android (for use with SS Helper).

random.c
    Count { and } more intelligently in C-mode, so it works better for
    Perl.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.138

========== GGR4.139

complet.c
fileio.c
lock.c
efunc.h
estruct.h
    Combined the expand_tilde() and expand_shell functions into
    fixup_fname() and removed the conditional compilation bits.
    Extended fixup_fname() to handle any leading (multiple) ".."
    directories to mean "get $PWD, strip that number of entries and
    append the rest".
    This is to handle this sort of case:
     o  A user's HOME is /home/user
     o  They have a symlink, slw, to a working dir /workdir/user.
     o  In their HOME they cd slw.
     o  Now that can cat ../.bashrc and it will cat what they expect.
     o  Previously, uemacs ../.bashrc would try to open /workdir/.bashrc
        as the .. would be relative to the physical location.
     o  This changes means it uses an edit of $PWD, so opens the
        expected file.

     If you really want to go via the physical location you can use
     ./../.bashrc.

     Reformatted (tidied) code of complet.c and lock.c.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.139

========== GGR4.140

etc/uemacs.rc
fileio.c
    Check that we only open *files* for reading/writing and also for the
    &EXIst macro function. [fileio.c]
    Remove code that checks for environment variables in filenames. It
    leads to inconsistent handling of $ in filenames. [fileio.c]
    Added an expand-envvar macro function, bound to Esc-$. [uemacs.rc].

exec.c
line.c
    Report the name of a function when we can't find it. [exec.c]
    Mark code buffers as read-only whilst they are being executed. [exec.c]
    Add read-only check to linstr(), to avoid incorrect error
    message. [line.c]
    Fix insspace() to check that linsert_byte() succeeded. [line.c]

bind.c
globals.c
main.c
edef.h
    Remember current_command when running one. [bind.c]
    Mark that we are running a function when we are. [main.c]
    Change rdonly() to display the offending command and buffer if
    we are running a function at the time. [main.c]

buffer.c
    Check when going to a buffer that it is active and, if not, read in
    its file.

bind.c
exec.c
buffer.c
    Reformatted (tidied) code of recently-changed files.

ptt/czech.cmd -> etc/czech.cmd
ptt/russian.cmd -> etc/russian.cmd
    Move *.ptt files to etc/, which is where they need to be installed.
    Remove the ptt/ directory.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.140

========== GGR4.141

bind.c
buffer.c
file.c
input.c
main.c
efunc.h
    Disable making keyboard macro buffer be the current buffer while it
    is being collected.
    Add arg to swbuffer() to allow switch to actually add the macro text.
    Add return code checks to swbuffer() calls.
    Minor change to end_kbdmacro() call in ctlxrp() [main.c]

bind.c
    Simplify the prefix key coding.

bind.c
exec.c
input.c
efunc.h
    Return name_bind struct from getname() rather than just the function.
    Changed the two callers to handle this - they now have more info available.

bind.c
    Display, and allow in commands, the 2-char sequence "^?" for Delete (0x7f).

main.c
    Fix the ~/uemacs-dumps clean-up code to actually work (multiple errors).

buffer.c
main.c
names.c
    Allow negative arg to "next-buffer" (nextbuffer()). [buffer.c]
    Take any numeric arg to "select-buffer" (usebuffer()) to mean go
    back to previous buffer without prompting.  [buffer.c]
    Remove any numeric arg message from the mini-buffer before executing
    a command [main.c], and add comment to execute() call in getstring()
    that mlerase() after execute() isn't needed there.  [input.c]
    Disable "select-buffer" when in the mini-buffer.  [names.c]

exec.c
main.c
efunc.h
    Add code to remember the text of the last command line run in a
    buffer for reexecute.
    Fix addto_kbdmacro() to record a 0 numeric arg when it is set. [main.c]
    docmd() is only used in exec.c, so make it static there. [efunc.h, exec.c]
    Add struct line_info and struct line_seen. [exec.c]
    Add push_lsb(), pop_lsb(), switch_lsb_lines(). [exex.c]
    docmd() use *_lsb code to preserve commands and, if the command is
    "reexecute", recurse with the previous command. [exec.c]
    Tidy up the 40 numeric macro functions by using a generating macro.
    [exec.c]

globals.c
input.c
main.c
search.c
edef.h
    Fixes for keyboard macro so that reexecute and numeric multipliers
    work for it.
    Merge saved c/f/n vars into a last_arg structure. [edef.h,
    globals.c, input.c, main.c]
    Only record getstring input to macro text buffer if there is some.
    [input.c]
    If getpattern() inserts the default reply for searching, add that to
    the macro text buffer. [search.c]
    If in reexecute mode, put mapped search function names into the
    macro text buffer, not the originals. [main.c]
    Save last c/f/n when in PLAY kbdmode, so reexecute works, but don't
    save them for ctlxrp. [main.c]
    Modify ctlxe() and ctlxrp() so that things like Esc2^Xe Esc3^C work
    as expected (keyboard macro runs 6 times). [main.c]

globals.c
input.c
main.c
edef.h
efunc.h
    Move the (identical) numeric prefix code in main.c and input.c into
    a function (multiplier_check()) and get them both to call it.
    [main.c, input.c, efunc.h]
    Redefined (and renamed) the last_arg structure to func_arg.
    [globals.c, input.c, edef.h]

../CHANGES
../TODO
version.h
etc/uemacs.hlp
   Update to version GGR4.141

========== GGR4.142

Some utf8 changes

bind.c
efunc.h
    Changed character case check in stock() to handle utf8 strings.
    Made all internal functions static, removed them from efunc.h and
    re-ordered some functions accordingly.

input.c
efunc.h
line.h
    Changed character case check on input to handle unicode chars.
    Added ensure_uppercase() to do the mapping.
    Move yankmb() declaration from efunc.h to line.h.

eval.c
efunc.h
    Checked mklower() and mkupper() for utf8, but they only deal with
    ASCII text. In the process made all internal routines static,
    removed them from efunc.h and re-ordered some functions accordingly.
    Reformatted/tidied code.

buffer.c
exec.c
file.c
isearch.c
lock.c
random.c
search.c
efunc.h
    Removed all extern definitions of functions only used in one file
    and made them static. Re-ordered/reformatted files in the process.
    Removed:
        makelist, ltoa, addline [buffer.c]
        freewhile [exec.c]
        ifile [file.c]
        checknext, match_pat, promptpattern, get_char, uneat, reeat [isearch.c]
        unlock, lckerror [lock.c]
        tabsize (a variable), cinsert [random.c]
        savematch, delins, rmcclear [search.c]
        non-existent meexit, sys, shellprog, execprog
    This shrunk the Intel x64 binary by >2%.

region.c
utf8.c
utf8.h
    Add a generic utf8_recase() function. Change tolower_utf8() to use
    it. [utf8.c, utf8.h]
    Change lowerregion() and upperregion() to be front-ends to
    casechange_region(), which uses utf8_recase() and so now handles
    unicode recasing. [region.c]
    Re-ordered/reformatted region.c and utf8.c.

exec.c
region.c
word.c
utf8.c
efunc.h
utf8.h
    Simplify ensure_case() to use utf8proc_toupper/tolower/totitle
    directly and do nothing if the result is the same as the input.
    Insert replacement *before* deleting original, so mark is moved
    correctly if it directly follows the original.
    Add code to fix-up mark location if ensure_case() changes byte-count
    of the character.
    Add special case of ß -> SS for UTF8_UPPER. [word.c]
    Use the UTF8_UPPER/UTF8_LOWER/UTF8_TITLE option names from
    utf8_recase() and changed callers to reflect this. [exec.c, word.c]
    Remove tolower_utf8() [utf8.c/h] and change caller [exec.c] to use
    utf8_recase().
    Changed utf8_recase() calling sequence [utf8.c/h] to return more
    info (via an mstr struct) and updated callers [exec.c, region.c].

ansi.c
basic.c
eval.c
exec.c
ibmpc.c
names.c
pklock.c
posix.c
spawn.c
tcap.c
termio.c
usage.c
version.c
vt52.c
window.c
wrapper.c
charset.h
ebind.h
estruct.h
line.h
    Finally decided to tidy up all source files to use 4-space indenting.
    No actual code changes except:
    o Removed abs() from eval.c and efunc.h, as it's a C library function.
    o Removed '#undef abs' checking from estruct.h

Makefile
bind.c
buffer.c
display.c
eval.c
exec.c
fileio.c
globals.c
input.c
line.c
lock.c
main.c
names.c
search.c
utf8.c
window.c
word.c
wrapper.c
estruct.h
edef.h
efunc.h
evar.h
wrapper.h (deleted)
    Change all malloc/realloc calls to Xmalloc/Xrealloc, so that the
    check for failure (NULL pointer returned) is only done in one place.
    For those calls which check for NULL, removed that test and any
    dependent code block.
    If such an error does occur then exit - as we are in real trouble.
    Changed wrapper.c to contain Xmalloc() and Xrealloc() definitions
    and removed the existing (unused) xmkstemp() and xmalloc().
    Deleted wrapper.h [Makefile]
    Removed the unused code for memory stats envram, EVRAM and the
    associated $ram system variable, RAMSIZE and RAMSHOW. [eval.c,
    globals.c, main.c, edef.h, estruct.h, evar.h]
    Moved two bits of common code into a static get_display_code()
    function. [exec.c]
    Tidied up the failexit/failexit2/noram goto label usage [exec.c]

main.c
    In end_kbdmacro() restore f_arg from p_arg if we were in PLAY mode,
    as this gets called on a macro abort, and we need to reset things so
    that re-executing a macro (clt-C) re-executes the macro after it
    aborts, not re-executes the failing command.

search.c
    Drop the common search-loop code into forwscanner()/backscanner().
    This means that the end-of-buffer check is now done for forwhunt()
    as well as forwsearch().

eval.c
input.c
search.c
../TODO
    Fixes for tgetc() returning a unicode char, not an ASCII one.
    Just change char c to int c [input.c, search.c]
    For eval.c:
        o Fix GTKey to handle unicode input and return a utf-8 string.
        o Fix UPPer and LOWer to work with utf-8 strings.
        o Fix CHR to work with codes > 255. Allow hex and U+... codes
    Removed this from TODO list.

utf8.c
    Fix utf8_recase() to check for len == 0 *after* obtaining the real
    length.

isearch.c
    Use strcpy() not strncpy() to copy back pat_save in isearch().
    Removes compiler warning on Debian buster, and is better code.

Makefile
complet.c [deleted]
input.c
efunc.h
    Included code from complet.c into input.c, as that was the only user
    of it.
    Made previously external routines (comp_file() and comp_buffer())
    static.
    Removed complet.c references. [Makefile, efunc.h]
    Dropped matching loop from comp_file() and comp_buffer() into an
    internal matcher() function.
    Replaced strncpy() call for moving so_far into choices with code to
    limit so_far size, then use strcpy(). Removes compiler warning on
    Debian buster, and is better code.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.142

========== GGR4.143

utf8.c
utf8.h
    Re-order some code and extended comments about how to use
    utf8_recase(). Changed to being a void() function - any unknown
    casing request is handled as TITLE case. No real code change.

version.c
    Print utf8proc version as well.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.143

========== GGR4.144

-----
Changes to how re-exec (ctl-C) works for some commands that require
further input.
Under re-exec, just execute the previous input rather then get (the
same) info from the user again.

exec.c
    In namedcmd() save the last function and re-use it when in
    reexecute.
    Also change ":" to "name:" in prompt.
    In execcmd() change ":" to "command:" in prompt.
    In do_cmd(), replace the line_seen *lsb structures with a
    prev_line_seen that is always updated before exit. This handles
    recursion (e.g. a reexecute of a command buffer that itself contains
    reexecute commands).
    In execproc() and execbuf() save the last buffer name and re-use it
    when in reexecute.
    In execfile() save the last buffer filename and re-use it when in
    reexecute.

random.c
    In quote() save the char to quote and re-use it when in reexecute.

spawn.c
    Combine spawn() and execprg() into simple front-ends to a common
    back-end and remember last run common, for reexecute.
    Remember last command for pipecmd() and filter_buffer() as well,
    using a common command-line fetcher.
    Fix filter_buffer() to not prompt to "Discard changes" if original
    buffer was modified.

main.c
names.c
search.c
    Use inreex flag internally to handle reexecuting searches rather
    than remapping function calls to *hunt() [search.c, main.c]
    Remove hunt-forward and hunt-backward from name binding list as they
    are no longer needed for macro-running [names.c]
    Put "reexecute" into the keyboard macro buffer, rather than adding a
    copy of the actual previous command. [main.c]
-----

version.c
    Display the GCC version used to compile, compile date/time and libc
    version in use at run-time.

globals.c
edef.h
    Remove unused quotec variable.

basic.c
bind.c
eval.c
exec.c
file.c
input.c
isearch.c
main.c
random.c
region.c
spawn.c
window.c
word.c
estruct.h
    Add MLbkt macro for MLpre/MLpost bracketting of fixed text.
    No real code change.

exec.c
globals.c
names.c
random.c
search.c
spawn.c
edef.h
efunc.h
estruct.h
    Added the ability to turn the "extended" reexecute arg functionality
    on/off on a per-handler basis. The "args-in-reexec" command.
    Structure data and setting. [edef.h, efunc.h, estruct.h, globals.c,
    names.c, random.c ]
    Add the per-handler test to current inreex checks for:
        o namedcmd(), execproc(), execbuf() and execfile() [exec.c]
        o Added (missed) inreex handling to execcmd() [exec.c]
        o quote() [random.c]
        o forwsearch() and backsearch() [search.c]
        o spawn(), execprg(), pipecmd() and filter_buffer() [spawn.c]
    Removed the realloc() from reexec handling by using a large enough
    static buffer instead [spawn.c]

    By default all "extended" reexecutes are on.
    They can be manipulated by:
        args-in-reexec arg1 arg2 arg3 ....
        Args are processed in the order found.
        None (case-insensitive) turns all off
        All (case-insensitive) turns all on
        + means turn it on any succeeding commands
        - means turn it off any succeeding commands
        A command name (e.g. search-forward) means turn that on/off.
    If there is an error in the args then the original setting is left
    unchanged.

version.c
    Check we actually have a libc string before trying to print it...

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Added args-in-reexec ALL [uemacs.rc]
    Update to version GGR4.144

========== GGR4.145

exec.c
    Simplify restoring oldestr value.

buffer.c
eval.c
exec.c
globals.c
main.c
termio.c
    Change some simple "&var[n]" constructs to be just "var".

----------
Add support for integrating user macros into "core" functionality.

eval.c
exec.c
globals.c
edef.h
efunc.h
evar.h
    Add a global (userproc_arg) to allow macro procedures to an arg
    from C-code [globals.c, edef.h]
    Add a function (run_user_proc())) to run a userproc and use it in
    execproc() [exec.c, edef.h]
    Add a user function (%esc) to escape a string for use as a single
    token in an external (shell) command.
    Add a user function (%arg) to pick up any userproc_arg arg, or
    prompt for one if none is set [eval.c, eval.h]
----------

eval.c
    Fix &lef and &mid code to put the trailing NUL onto the result!

random.c
    In writemsg(), if args come in as (1, 2) from "2 write-message ..."
    then just write it directly to stderr. Only for debugging macros.

exec.c
    Edit a comment to refer to execute-file, not include-file (the code
    was changed some time ago...).

----------
Add simple support for displaying directory content in a buffer
for file browsing.

eval.c
fileio.c
globals.c
main.c
spawn.c
edef.h
evar.h
etc/uemacs.rc
    In check_for_file() if we have a directory and a showdir userproc
    then call it to display the entries. [fileio.c]
    If we get to the point of "self-insert" in execute() and we are in
    the view-only //directory buffer for a showdir userproc, then handle
    some chars as specific actions [main.c]
        d, o        open entry on current line
        v           view (read-only) entry on current line
        r           refresh current view
        u           go up to parent directory
    All other "self-inserts" are silently ignored...
    Change the file and buffer name used by pipecmd() ("command" ->
    ".ue_command") and parameterize it. [spawn.c]
    Add showdir_tokskip system variable [eval.c, globals.c, edef.h, evar.h]
    Add the code for the showdir userproc [etc/uemacs.rc]
----------

----------
Rationalization of mlreply* calls.
The terminating-character arg hasn't been used for ages, and is replaced
by an "expansion type" option so that if getstring() is called it can
present the correct options.
Removed mlreplyall (which I'd added in GGR4.109). Macro functions only
pick up one arg, so if you want to use "a list" you just need to quote
it (e.g. char-replace in etc/uemacs.rc).
Added expansion for user-procedure calls (a specific-case of buffer-name
expansion).

Files affected:

basic.c
bind.c
buffer.c
crypt.c
eval.c
exec.c
file.c
input.c
main.c
random.c
search.c
spawn.c
utf8.c
word.c
efunc.h
estruct.h
etc/uemacs.rc
----------

etc/uemacs.rc
    Add QUOTING_STYLE=literal to ls command in showdir.

main.c
    For the "open" (d, o, v) case in directory browsing check we are
    handling a directory or file.

input.c
    Change type to mtype in matcher (for consistency) and add a comment
    about what COMPPROC does.

input.c
efunc.h
estruct.h
    Changed getname() to use the standard getstring() function (via
    mlreply() rather than its own hard-wired completion code.
    Added EXPNAME expansion (using getfname()/getnname() and
    comp_name()+matcher().  [input.c, estruct.h]
    Removed no-longer used ctoec() function [input.c, efunc.h]

exec.c
    Don't print "No such function" on failure return from getname().
    It has either already printed it, or the user aborted the command.

input.c
    Add default case for mtype switch in matcher().

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Update to version GGR4.145

========== GGR4.146

input.c
    Moved some routines around to avoid having to pre-declare functions.
    Removed the "#if BSD | USG" conditional (always true for us).
    Added comp_gen() function and made comp_buffer() and comp_name()
    front-ends to it.

bind.c
file.c
fileio.c
main.c
spawn.c
efunc.h
    Move the directory check to call showdir out of check_for_file()
    and into getfile() - before any buffer is created.
    Made the check optional for the caller.

display.c
random.c
efunc.h
    Added mlwrite_one() and mlforce_one() to print strings that may
    contain '%', but don't want printf-style interpolation.
    Could lead to missing '%' in write-message output. [display.c, efunc.h]
    Simplified writemsg() by using mlwrite_one() and changed all other
    1-arg mlwrite() calls to be mlwrite_one(). [random.c]

eval.c
input.c
efunc.h
estruct.h
evar.h
    Added sort routine for environment and user variable names for
    use in the completion code in input.c and added EXPVAR and COMPVAR
    to use it. Had to externalize uv(user_variable) and evl(struct evlist)
    data. Had to shift some definitions from evar.h to estruct.h so that
    input.c could see them. Simplified the user variable setting code in
    setvar(). [eval.c, efunc.h, estruct.h, evar.h]
    Added getfvar/getnvar functions to support a comp_var()
    functionality in getstring(). Use mlwrite_one() when printing
    choices to prevent loss of leading % on user vars. [input.c]

basic.c
bind.c
buffer.c
crypt.c
exec.c
file.c
fileio.c
input.c
isearch.c
line.c
lock.c
main.c
random.c
region.c
search.c
spawn.c
window.c
word.c
    Changed all 1-arg mlwrite() calls to be mlwrite_one() and replaced
    any %% with % in args.
    Stop expandp() from changing % to %% [search.c]
    Removed unnecessary string building for mlwrite() [exec.c, random.c]

file.c
globals.c
main.c
edef.h
efunc.h
    Put the directory test and showdir call into a showdir_handled()
    function. [file.c, efunc.h]
    Don't set readin_mesg if silent [file.c]
    Call showdir_handled() for command line file args, so directory
    browsing works there too. [main.c]
    Add a comline_processing flag, so we can sleep to let an error
    message be read [edef.h, globals.c, main.c, file.c]

../CHANGES
version.h
etc/uemacs.hlp
    Update to version GGR4.146

========== GGR4.147

display.c
    Use a union for va_list/NULL arg passing in mlwrite_ap() calls.
    gcc on Raspberry Pi (arm) complains otherwise.

etc/uemacs.rc
    Fix the handling of "./"xxx directory names.

basic.c     bind.c      buffer.c    crypt.c     eval.c      exec.c
file.c      input.c     main.c      random.c    search.c    spawn.c
utf8.c      word.c      estruct.h
    Merge the EXP* enum and COMP* defines into a CMPL_* enum.

basic.c     bind.c      buffer.c    charset.h   crypt.c     display.c
estruct.h   eval.c      exec.c      file.c      fileio.c    globals.c
ibmpc.c     idxsorter.c input.c     line.c      lock.c      main.c
posix.c     random.c    region.c    search.c    spawn.c     tcap.c
utf8.c      utf8.h      vt52.c      window.c    word.c
    Spell-check the block comments.

random.c
etc/uemacs.rc
    Fix insert-raw-string to really insert it raw (preserving spaces).
    So insert-string *actually* inserts tokens (handling 0x.. and U+...
    character specifications).
    insert-raw-string inserts its arg as-is. [random.c]
    Change insert-string calls to insert-raw-string, as that is what we
    actually want (particularly expand-envvar) [etc/uemacs.rc]

spawn.c
    Tag temporary files for pipecmd() and filter_buffer() with the pid
    of the uemacs process.
    Simplify(?) pipecmd() by just re-using any PIPEBUF buffer and
    switching from getfile() to readin() to get the result.

search.c
    Remove a left-behind debug 'fprintf(stderr, "preload...' call.

globals.c
input.c
main.c
search.c
edef.h
estruct.h
    Added the search prompt to the list of context-specific completions,
    although it's not really "completion".
    o <tab> will set the default search string to the previous one in
        the search ring.
    o Esc<tab> will set the default search string to the next one in the
        search ring.
    o ^X<tab> will insert the default search string into the search
        buffer.
    The previous remapping of prevwind, nextwind and listbuffers to
    these functions while searching has been removed.
    NOTE: that this does mean that ^X<tab> (i.e. ^X^I == handle-tab)
          can't be used in the minibuffer (to insert a tab char).

version.c
Makefile
    Added the hostname of the building system to the version
    information. [version.c, Makefile]
    Removed the unused sparse, install (which was wrong...), lint, errs
    and tags nodes.

input.c
search.c
efunc.h
    Since the *_sstr function no longer need to have a "bindable"
    function calling syntax, simplify this, and combine
    prev_sstr/next_sstr into rotate_sstr.

exec.c
input.c
search.c
efunc.h
estruct.h
    Change enum exp_type to cmplt_type, for consistency with member names,
    and used this in function prototypes.

bind.c
    Apply apropos filter to procedure buffer bindings too.

exec.c
input.c
estruct.h
    Added CMPLT_PHON for Phonetic Table completion. [all]
    Use CMPLT_FILE in execfile(). [exec.c]

input.c
    Correct getnbuffer() to skip //minib* names for minibuffers, not the
    old CC$ prefix.

etc/uemacs.hlp
ebind.h
estruct.h
    Edited to update current information and keybindings. [etc/uemacs.hlp]
    Remove keybindings for newsize() and newwidth() - SIGWIN now handles
    this automatically. [ebind.h]
    Fix type in comment [estruct.h]

etc/uemacs.rc
    Remove the unbinding of M-^T, as it is no longer bound - so we get
    an error and the rest of the file is ignored...

../CHANGES
version.h
etc/uemacs.hlp
    Update to version GGR4.147

========== GGR4.148

input.c
    Disable "standard" Esc<tab> and ^X<tab> actions in getstring()
    minibuffer. Print "No match" on completion attempts which fail.

bind.c
buffer.c
file.c
window.c
efunc.h
    Add a windata_to_buffer() function to handle the 10 occurrences of
    flush window data to buffer data on window closing.

utf8.c
etc/uemacs.rc
    Correct an "&&" to be "&", which meant char-replace hasn't been
    working properly!
    Fix unicode_to_utf8() to work for 4-byte uf8 strings.
    As a result, remove U+10000 from char-replace [etc/uemacs.rc]

display.c
utf8.c
word.c
utf8.h
    Add an interlude to Julia utf8lib's utf8proc_charwidth() as it
    incorrectly marks U+00a8 and U+00b4 as zero-width.
    Could be extended if other corrections are needed.

random.c
    Increase the message buffer size from NPAT(128) to NSTRING(513).
    You might wish (and I did so wish) to write a longish message to
    stderr (2 write-message ...).

main.c
    Must take a copy of any startup filenames mentioned on the command
    line, as their value may be edited *in-place* by fixup_fname().

file.c
fileio.c
efunc.h
etc/uemacs.rc
    Add fixup_full(), which expands a leading "." (and calls
    fixup_fname() otherwise). Needed as the showdir userproc expects to
    have an absolute pathname. [fileio.c, efunc.h]
    Changed the showdir userproc to first test it has an absolute
    pathname, and only if not, try to work it out. [etc/uemacs.rc]
    Take a copy of the file path and call fixup_full() before calling
    showdir userproc. [file.c]

eval.c
    Initialize the values of user variables to NULL at startup.

file.c
    Use local variable for exp_pname rather than malloc/free one.

fileio.c
    Make fixup_full() always call fixup_fname().
    Extend fixup_fname() to change all "/./" to "/".

eval.c
globals.c
evar.h
edef.h
estruct.h
etc/uemacs.rc
    Add $uproc_opts system variable to allow macros to control &arg
    handling [eval.c, globals.c, edef.h, estruct.h, evar.h]
    Run fixup_full() if UPROC_FIXUP is set in uproc_opts [eval.c]
    Remove showdir macro code to create an absolute path with a
    $uproc_opts setting to get it done internally, but leave in a check
    that it does have an absolute path [etc/uemacs.rc]

fileio.c
    Fixes to fixup_full().
    Extend fixup_fname() "..". ".". "//" handling and let it handle
    things after just prepending $PWD.

estruct.h
basic.c     bind.c      buffer.c    display.c   eval.c      exec.c
file.c      input.c     isearch.c   line.c      main.c      random.c
region.c    search.c    window.c    word.c
    Put five items that switch between the window and buffer structs
    into a struct locs, so that it can be copied in one go.
    w_dotp, w_markp, w_dodo, w_marko, w_fcol -> w.* (same for b_*).

bind.c
buffer.c
file.c
window.c
efunc.h
    Replace the windata_to_buffer() function with inline copying of the
    struct locs items.

display.c
input.c
    If mlwrite_ap has been sent an empty format, return straight after
    clearing the minibuffer line. Not doing this resulted in the
    mlwrite("") at loop: in getstring() wiping out the start of the
    prompt if you typed the same characters in the reply. [display.c]
    Remove an unneeded WFEDIT setting left over from some earlier testing.
    [input.c]

buffer.c
window.c
    Use structure copies (struct locs) for 3 more instances.

../CHANGES
version.h
etc/uemacs.hlp
    Update to version GGR4.148

========== GGR4.149

buffer.c
main.c
search.c
    Declare make_active as static, since it's only used internally
    [buffer.c]
    When displaying a mini-buffer message at start-up put the cursor
    back to where it was, not (0,0). It may be positioned anywhere
    within the file (-g/+ option). [main.c]
    If setpattern() is called during command-line parsing add the
    pattern to the search ring. Add const to update_ring() arg to remove
    a compiler warning that resulted. [search.c]

main.c
    Add a -m option to define a message to be displayed in the minibuffer
    after start-up (overriding any "Read n lines" message). [main.c]

spawn.c
    When using < and > in system() commands put the temp files into HOME
    (if defined and not empty) rather than the current directory.

../CHANGES
version.h
etc/uemacs.hlp
    Update to version GGR4.149

========== GGR4.150

input.c
    In getfile() add back any trailing '/' after calling fixup_fname().

display.c   line.c      random.c    utf8.c      utf8.h
tools/(.gitignore Makefile combi-class.c combi.h combi.info)
    In lgetgrapheme() check that we actually used some of the buffer
    before continuing to loop. [line.c]
    Rename zerowidth_type() to combining_type(), as that is what it
    is actually meant to be testing. [all]
    Generate the range data (combi.h) for combining_type() from a
    program (tools/combi-class) which queries the utf8proc lib for all
    non-zero combining class characters. (tools/*). This should be
    regenerated for any utf8proc update, and the new combi.h copied into
    the code/ directory.

line.h
    Correct the update_screenpos_for_char() macro to use utf8char_width()
    not utf8proc_charwidth(), allowing fix overrides to take effect.

etc/uemacs.rc
    Change shell-command to execute-program so you always have to hit
    <return> as culspell ends.
    Otherwise a file with no error looks really odd (it appears to do
    nothing) and it does let you know that the spell check has actually
    ended!

search.c
estruct.h
    Extended regex code to handle a range for repeat matches.
    + for 1 to "infinity" and {m,n} for m to n.

search.c
    Allow {,n}, {m,}, {,}, {} for regex ranges too.

search.c
estruct.h
    Allow ? after a closure to mean "minimum length match".

globals.c
input.c
estruct.h
etc/uemacs.rc
    Rename the (unused) EQUIV mode to be UNICO.

estruct.h
search.c
    Allow \n (newline), \s (whitespace) and \t (tab) in Magic mode.

utf8.c
    Extended utf8char_width() with a longer list of unicode chars
    incorrectly zero-length tagged in utf8proc v2.3+.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
    Update to version GGR4.150

========== GGR4.151

Makefile
    Fix typo in (my) ANDROID build test.

search.c
word.c
    Tidy-up in passing...
    Conditional free() then Xmalloc() -> Xrealloc() [search.c]
    Better arg handling [word.c]

basic.c
globals.c
    Rename getgoal() to be offset_for_curgoal(), update related comment
    and variable name to make it more clear what it is.

input.c
    Remove ljust(). Filenames starting with spaces are valid (if,
    perhaps, a little odd).

search.c
estruct.h
idxsorter.h
    Change all shorts to ints. We don't have space issues, so using
    "native" lengths makes more sense.
    o struct terminal and struct magic/magic_replacement [estruct.h]
    o struct fields [idxsorter.h]
    o magical and rmagical [search.c]

tools/utf8file_to_unicode.pl
    Added a simple script to decode (small) utf8 files to unicode.
    Useful for debugging...

line.c
word.c
line.h
    Activated the lputgrapheme() code [line.c, line.h]
    Fixed ensure_case to carry-over any combining marks on a grapheme
    when changing case [word.c]

tools/utf8file_to_unicode.pl
    Handle the invalid unicode (iso8859-1?) chars that uemacs actually
    allows.
    Added some comments.

eval.c
    Change $curchar to be the Unicode char (not ASCII byte) at point.
    Change &asc function to return the base unicode char.
    These do *not* add in any combining characters!

test-files/search-magic1.sh
test-files/search-magic2.sh
test-files/search-magic3.sh
test-files/search-magic4.sh
test-files/search-test1.sh
    Add some test scripts for magic search testing.

eval.c
    Change the &asc function to return the unicode point of the base of
    the next grapheme, not just an ASCII byte (but keep the same name).
    Needed for test scripts to check where they are.

exec.c
eval.c
globals.c
estruct.h
evar.h
edef.h
    Add a $force_status environment variable to keep the actual status
    of any !force's command. Useful in test scripts.

file.c
    Remove the line count check. There was a maximum of 10000000 set
    but we may as well keep going as long as malloc() can handle it.

random.c
    Only insert spaces (never tabs) in insbrace().

line.c
    Correct (reverse) the logic on extended character insertion in
    lputgrapheme().

fileio.c
line.c
line.h
    Reallocate rather than malloc/copy/free in add_to_fline.

Makefile
    Remove *.tfile and uetest.rc in clean option.

-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
    Enabled unicode searching
    This is some of the changes made along the way. Rather than commit
    a multitude of changes and minor fixes I decided to get the basic
    code changed and do one large commit of it.

Plan A:
    Duplicate all of the search code, update the copy to use Unicode and
    add calls between them according to whether we needed Unicode.
Result:
    Too complicated. many of the sub-calls would become very messy where
    they shared data and hence couldn't really be duplicated.

Plan B:
    Start by adding Unicode handling just for basic searching (not Magic
    mode).
Result:
    This also became very messy with having to decide whether to check a
    byte or create a grapheme to check. Also the interaction with the
    jump patterns was not clear.

Plan C:
    Make Unicode searching use the Magic mode!
    Spilt a Unicode search string into (new) Magic Types and just adapt
    the Magic code to use them.
Perceived advantages:
    Magic code already works. Just need to worry about each individual
    new type and the progressing forwards/backwards through the file
    should follow.
    Should be able to handle Magic mode at the same time - just
    dependent on the new Types.

    So the following changes are all about piggy-backing onto the Magic
    mode search code (which became step_scanner), then adding more (and
    Unicode) regex matching to Magic mode.

display.c
utf8.c
utf8.h
    set_grapheme() and grapheme_same() moved from display.c to utf8.c
    and made external functions.
    Renamed grapheme_same[_array]() to same_grapheme[_array]().
    Simplify clone_grapheme() [display.c]

search.c
estruct.h
    In readpattern(), check for a unicode char in the search string
    (byte > 0x7f) unless we are in Exact and non-Magic mode.

    In mcstr() added UCLITL and UCGRAPH types for "magic" searching. If
    we hit a byte in the search pattern which is > 0x7f add it as one
    of these new types.

    In mcclear() free any gc->ex allocs in UCGRAPH types.

    In amatch(), handle UCLITL and UCGRAPH mc_type entries.

    Change boundry() to check for "on last line" (b_linep) rather than
    at the end of the "line pointing at b_linep" so that we can include
    the terminating newline in a search.

search.c
    Rename scanner() to fast_scanner() and mcscanner to step_scanner().

search.c
estruct.h
    Changed "struct magic" layout. turned mc_type into bit field structure.
    Renamed "magical" to "slow_scan" [search.c]
    Call mcstr() for all search patterns and use that to work out
    whether to use fast_scanner or step_scanner.

search.c
estruct.h
    Removed NCCL as an mc.type and added a negate_test flag instead.
    Added get_grapheme flag to struct magic.

../test-files/dump_mc.debug
    Code that can be included to dump the struct magic(_replacement)
    info for debugging.

search.c
    Added brace_text() function.
    Added handlers for \X, \u, \P and \p to mcstr().
    Added nextgph() function and use it to step in step_scanner()

search.c
estruct.h
    Added extended CCL code. Can now put
     o property tests
     o Unicode chars and Unicode ranges
     o Graphemes
    into character class lists ([..]).

isearch.c
search.c
estruct.h
    The Incremental search defines (IS_) moved to isearch.c
    The metacharacter defines and structure moved to search.c
    (MCNIL... MC_ANY...
     struct range/mg_info/xccl/magic/magic_replacement)

search.c
    Remove mceq() usage and use mgpheq() for all magic tests.
    Change cclmake() to read/use graphemes.
    Added \d, \D, \w, \W and \S to cclmake CCL handling, and
    extended \s character set.

search.c
    replaces() need to remember the location of the last replace
    location to prevent a loop changing nothing with nothing.

search.c
    Renamed "closure" to "repeat", to reflect what it does, rather than
    what it is in abstract terms.

search.c
    Implement grouping by allowing struct magic to contain a pointer to
    another struct magic item.
    mcstr() and mclear() now take args to cater for recursion.

search.c
    Remove the reverse magic patterns and instead do reverse magic
    searches by stepping backwards through the file but performing the
    match using the forward code. Add a new boundry() condition for
    reverse searching so that it cannot advance past the original point.
    Non-magic searching still uses a reverse pattern.

search.c
    Remove MCNIL. An EGRP for group 0 is now the equivalent.

display.c
    Stop mini-buffer messages at ncol-1, to prevent wrapping messing up
    the display.

search.c
    Added group (()) and choice (|) handling code.
    Removed the struct magic * entry from struct magic and hence removed
    recursion for mcstr() and mclear(). The magic structure is now just
    a linear list again. Much simpler...

eval.c
search.c
efunc.h
evar.h
    Added a &grp function, to allow access to the text found in each
    group of a magic match. Mainly for testing purposes.

display.c
globals.c
input.c
estruct.h
etc/uemacs.rc
    Rename the (unused) UNICO mode back to EQUIV, as that is how it is
    now going to be used. It only applies in MAGIC mode.

search.c
utf8.c
    Implemented \k{x} (a "kind of" x) and EQUIV character matching.
    Added grapheme_to_bytes() [utf8.c]
    Extended same_grapheme() to check for grapheme EQUIValence.

globals.c
main.c
search.c
edef.h
    Removed srch_patlen_old. No longer used.

bind.c      buffer.c    display.c   eval.c      exec.c      line.c
lock.c      main.c      random.c    region.c    search.c    window.c
word.c      utf8.c
    Change all free() to be Xfree().

bind.c      buffer.c    crypt.c     display.c   edef.h      efunc.h
estruct.h   eval.c      evar.h      exec.c      globals.c   input.c
isearch.c   line.c      lock.c      main.c      random.c    region.c
search.c    tcap.c      utf8.c      utf8.h      window.c    word.c
wrapper.c
etc/uemacs.rc
../test-files/search-magic2.sh
../test-files/search-magic3.sh
../test-files/search-test1.sh
../test-files/dump_mc.debug
    Finally committed the "basic" Magic Unicode changes in one go.
-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-

eval.c
globals.c
utf8.c
edef.h
estruct.h
evar.h
    Check for bare ASCII before running check_equiv code in
    same_grapheme(). [utf8.c]
    Add option to set which equivalence method to use (NFC, NFD, NFKC,
    NFKD) with a default of NFKC. Handled by the system variables
    $equiv_type.

isearch.c
utf8.c
    Fixes for the prompt display in incremental search mode.
    In echo_char(), add the charwidth to col when leaving, not always
    increment by one. [isearch.c]
    Check for (most likely) ASCII char first in utf8char_width() [utf8.c]

eval.c
    Reinstated setting EVREPLACE. Needed for NUL-ifying it.

search.c
    Change incremental replace loop detection to just look for a zero
    length match.

etc/accents.cmd
etc/russian.cmd
    Added a Phonetic Translation table for ease of adding Western
    European accented characters. [accents.cmd]
    Corrected some spelling errors in comments. [russian.cmd]

search.c
    Correct the saving of the match string (group0) in Exact, reverse
    searching.

display.c
globals.c
    Fix mini-buffer modeline display to allow for Equiv mode.

search.c
    Set match_p and repl_p outside of query block, so replace-string
    works (not just query-replace-string).

autotest/dump_mc.debug
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-groups.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
    Moved the dump code and test files into a (new) subdirectory
    of code/ and renamed the test files by what they test.
    Added search-u_hex.sh and search-groups.sh.

search.c
    Initialize prev_gc to avoid a compiler warning in gcc 4.4.7.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
    Update to version GGR4.151

========== GGR4.152

display.c
    Fix the display of DOS mode in the modeline.

etc/accents.cmd
    Fix typos. case-set off/on should be caseset off/on.

autotest/dump_mc.debug
    Print out the bitmap for character classes.
    Fix utf8.h include, which was failing after the move from
    test-files.

search.c
    Handle a "]" as the first character in a class correctly. It will be
    taken literally, but might be the start of a range, not just a
    literal character to match.
    Fix the check for ASCII when matching character classes, so that
    they actually work.

search.c
    Fix handling of "-" when it is the first or last character in a
    class (and hence is literal, not a range specifier).

autotest/search-char_classes.sh
autotest/search-props2.sh
    Renamed search-char_classes.sh to search-props2.sh (as it actually
    tests properties) and added search-char_classes.sh.

Makefile
    Added a test-clean node to clean up temporary testing files without
    removing *.o and uemacs.

etc/uemacs.hlp
    Added a description of the new Magic mode regex functionality and
    change the (very old) %list-indent-text entry to be regionlist_text
    and regionlist_number.

main.c
    Fix directory-browsing key-handling to be case-insensitive.

../CHANGES
../README
version.h
etc/uemacs.hlp
    Update to version GGR4.152

========== GGR4.153

display.c
    Remove (long-since unused) #ifdef RAINBOW code.

bind.c
efunc.h
    Mark next_getbyfnc() as a static function. [bind.c]
    Add getbyfnc() - from bind.c [efunc.h]

input.c
estruct.h
evar.h
    Remove/fix comment about getname having its own internal command
    name expansion, as it no longer does. [estruct.h, input.c]
    Note that &esc does SHELL escape, *not* ~ escape. [evar.h]

main.c
etc/uemacs.rc
    Extend directory-browsing display sorting with A (A->z), Z (z->A),
    T (by mod-time, newest first) and R (by mod-time, oldest first).
    For o/u/d displays it uses the last used method (start default: A).
    In VIEW mode make Return and Space go down a page and b/B go up a
    page.

Makefile
display.c   globals.c   main.c      random.c    estruct.h
ansi.c      ibmpc.c     termio.c    vt52.c
    Removed AUTOCONF, as this is really Linux/Unix(?) only now. [estruct.h]
    No longer set -DAUTOCONF in CFLAGS. [Makefile]
    Remove IBMPC, VT52 and ANSI defines [globals.c, main.c, random.c,
    estruct.h]
    Move ansi.c, ibmpc.c, termio.c and vt52.c to removed/, as they are
    all now unused. Removed their entries from Makefile.
    Removed MEMMAP conditionals (they were for IBMPC). [display.c]

exec.c
    If parsing a buffer fails in dobuf(), unmark the buffer as a BTPROC
    one, so that we don't try to execute it (and loop...)

eval.c
random.c
    Remove the '%' to "%%" expansion in setvar() as it isn't needed
    (similar code was removed from exec.c some time ago). [eval.c]
    Add a comment to writemsg() pointing out that the first character
    of any write-message string (even with "") is tested for being an
    active character. [random.c]

main.c
etc/uemacs.rc
    Modify directory-browsing key handling so that:
    o H toggles the display of hidden files
    o T switches to sort by time if not in time mode and toggles
      newset/oldest first when in it
    o A switches to ASCII sort (== by name) if not in name mode and toggles
      A->z/z->A when in it.
    o R refreshes the current view in the current style.
    Going up/down in the directory tree keeps the same mode.

../CHANGES
../README
version.h
etc/uemacs.hlp
    Update to version GGR4.153

========== GGR4.154

eval.c
main.c
estruct.h
evar.h
etc/uemacs.rc
    Add directory browsing bindings for M and F.
    M   Toggle mixed/type-sorted display
    T   Toggle dirs/files order in type-sorted mode
    [main.c, etc/uemacs.rc]
    Make the %showdir* variables used by the showdir userproc into
    system variables ($showdir*) instead. [eval.c, estruct.h, evar.h,
        etc/uemacs.rc]

buffer.c
exec.c
    Update the buffer list display to cater for there now being 11 modes
    and display p/x Type (for BTPROC/BTPHON) after Modes. [buffer.c]
    Updates some comments relating to BTPROC and BTPHON, so that I'm not
    tempted to fix things in the wrong place. [exec.c]

search.c
autotest/search-file-start.sh
    Fix Magic reverse search to match at start-of-file. [search.c]
    Added a test file for this case.

exec.c
autotest/search-reexec-macro.sh
    Reexecuting a macro (user procedure) meant that all subcommands
    thought they were reexecing. So unset the flag while dobuf() runs.
    Also, docmd() needs to honour any numeric arg for reexecute.
    [exec.c]
    Add a test harness for reexec in macro.

main.c
    If stack dumps are enabled, write them to a file under
    ~/uemacs_dumps, as well as to the screen, if possible.

../CHANGES
version.h
etc/uemacs.hlp
    Expand description of system variables and add a description of
    reexecute and numeric commands to the help file. [etc/uemacs.hlp]

    Update to version GGR4.154

========== GGR4.155

main.c
    Removed "#if defined(SIGWINCH)" around buffer dumping code, as it
    only needs signals in general, not SIGWINCH in particular.

version.c
    Added display of the Unicode version supported by utf8proc, if
    available.

search.c
autotest/dump_mc.debug
autotest/search-line-endings.sh
    Fix broken ^/$ test in Magic mode. [search.c]
    Add missing BOL/EOL cases to dump_mc. [dump_mc.debug]
    Add test-harness for ^/$ in Magic mode.

buffer.c
eval.c
evar.h
    Allow deleting procedure buffers (/xxxx) even though they are
    invisible. [buffer.c]
    Initialize showdir_sort_dirf to the correct default ("r" not "")
    [eval.c]
    Add a "buffer exist?" (&exb) function.  [eval.c, evar.h]
    Rename DYNAMIC to DINAMIC, since it means "two". [eval.c, evar.h]

etc/uemacs.hlp
etc/uemacs.rc
    Change $showdir_opts handling by creating a showdir_opts_ user
    procedure to do it, running it if it exists and then deleting it.
    This allows you to set $showdir_opts at start-up *after* uemacs.rc
    has loaded.
    Added it to the help file (along with a typo correction).

autotest/search-char_classes.sh
autotest/search-file-start.sh
autotest/search-reexec-macro.sh
    Corrected some incorrect (but irrelevant) line numbering.

search.c
autotest/dump_mc.debug
autotest/search-groups.sh
    Fix some regex searching.
    Only the string match data needs to be reset on a group/choice
    failure, not the control info, so split into two structures.
    [search.c, autotest/dump_mc.debug]
    In mgpheq() LITCHAR cannot match any non-ASCII character. [search.c]
    Extended groups test-harness to include groups with choices (?) in.
    [autotest/search-groups.sh]

../CHANGES
version.h
etc/uemacs.hlp
    Expand description of system variables and add a description of
    reexecute and numeric commands to the help file. [etc/uemacs.hlp]
    (Actually added earlier in 1bc98a7522f2054b674bc20638c8dcd5abd599d7)

    Update to version GGR4.155

========== GGR4.156

version.c
    The run-time test for utf8proc version needs to be a compile-time one.

search.c
    Do not let ")" close group zero (so the error message is correct).
    Change the offset sent in to parse_error() on a few calls to improve
    the resultant error message.

search.c
    Make "?" greedy and allow "??" to mean a non-greedy 0/1 match.

window.c
    Fix a bug introduced in GGR4.148 with an erroneous edit.
    When getting rid of the current window in delwind(), update the
    current window's buffer locations, not the (arbitrary) wp ones.

buffer.c
file.c
globals.c
line.c
search.c
spawn.c
edef.h
    Invalidate the group-match info if we modify the buffer that the
    matches refer to. (For search-replace this means they are never
    valid after the function completes).
    If the data is marked invalid, return "" for any match-group
    request. [search.c]

random.c
    In adjustmode() check for PHON mode with a 1-char code check, rather
    than comparing a string with strcmp().

search.c
    When closing the highest open group at the end of mcstr we must set
    gpend as well. This is needed for CHOICEs in group 0.

../CHANGES
version.h
etc/uemacs.hlp
   Update to version GGR4.156

========== GGR4.157

globals.c
input.c
edef.h
    Set a flag around the mlreply() call in getname() so that
    getstring() doesn't add the name to the keyboard macro buffer.
    getname() adds the result anyway.
    Tidy up the setting of the buf reply to an empty string so that
    we never return with garbage in it. [input.c]

globals.c
main.c
random.c
edef.h
    Add a flag in writemsg() so that any write-message output from a
    keyboard macro will still be displayed after it ends.
    (Executing the /kbd_macro buffer already does this).
    Fix the check for "Remove any numeric arg" to test the f, not n,
    flag as n is set to 1 by default. [main.c]

exec.c
    Correct token() to flag a quoted string as such by including the
    leading " (which was lost in a85a4d3bb5d491855701ae5730d5e83f5e7aa919
    for version GGR4.115).

eval.c
evar.h
    Added a printf-like function, &ptf.
    The place-holder is %ws, where the width w is optional.

eval.c
    When returning a user variable we need to check that the value is
    not NULL. Otherwise "set %test &add %test 1" will crash uemacs if
    %test doesn't have a previous value.
    This is an ancient error (it affected version3!).

buffer.c
globals.c
eval.c
exec.c
edef.h
estruct.h
    Add per-buffer variable (.varname).
    Free any vars when clearing a buffer [buffer.c]
    Remember the currently-executing buffer for var access [globals.c,
    exec.c, edef.h]

exec.c
    Add back a src++ missing from the recent change to fix quoted string
    handling. (This made some strings appear to be empty...)

etc/accents.cmd
    Change all " to ~" as it needs to be escaped for token handling to
    not treat it as the start of a string.

etc/uemacs.rc
autotest/search-groups.sh
    Use buffer variables instead of user ones where appropriate.
    [uemacs.rc]
    Update to test file to quote strings starting with ".", which would
    otherwise now be mistaken for buffer variables.  [search-groups.sh]

eval.c
names.c
efunc.h
    Added a delete-var (delvar) function to delete user and buffer
    variables.
    Change (always the same) 3rd arg to findvar() to be a "create"
    option. [eval.c]
    In view of buffer variables existing, and user and buffer variables
    now being deletable, lowered the number of user variables (MAXVARS)
    from 255 to 64. [eval.c]

eval.c
estruct.h
evar.h
etc/uemacs.rc
    Change showdir to use buffer variables for the showdir_sort_*
    variables. [uemacs.rc]
    Remove the now obsolete $showdir_sort_* environment variables.
    [eval.c, estruct.h, evar.h]

../CHANGES
../README
etc/uemacs.hlp
version.h
    Update to GGR4.157

========== GGR4.158

input.c
    Just make getfname() a simple frontend to getnname().
    Added/tidied comments and return statements.

input.c
    Add login id lookup expansion for ~ at start of filename.
    Removed (rather than corrected the inverted logic) the clearing of
    choices on a unique match, as it wasn't doing anything. Leaving the
    one choice in place gives a useful visual hint that this is the case.

main.c
    Fix quoting in addto_kbdmacro.

bind.c
exec.c
globals.c
main.c
names.c
edef.h
efunc.h
estruct.h
    Added not_interactive and caller_handles_macro flags to func_opts.
    [names.c, estruct.h]
    Disallow key binding for a not_interactive function. [bind.c]
    Disallow not_interactive command via namedcmd() when we are
    not-interactive. [exec.c] and check for not_interactive in execute()
    when we are not interactive. [main.c] [efunc.h]
    Add not_interactive and caller_handles_macro options to
    storeproc handling. [exec.c]
    Added not_interactive_fname global. [globals.c, edef.h]

Makefile
version.h
etc/uemacs.rc
    Updates to allow a build for a Motorola G8 Power Android phone, done
    statically on a Debian aarch64 system.
    The directory browsing code works for this, so updated the showdir
    code to handle it (as far as it can - the -s option doesn't seem
    to work in sort on the phone, even though it is documented...).

bind.c
exec.c
input.c
efunc.h
    Fixed bind-to-key macro-recording, and improved prompting.

estruct.h
exec.c
names.c
    Removed caller_handles_macro flag from func_opts, as it isn't
    going to be able to replace the no_macrobuf_record global.

main.c
    addto_kbdmacro() needs to quote text that starts with an "active"
    character.

eval.c
evar.h
etc/uemacs.rc
    Removed the &arg function (UFPROCARG) and moved the userproc_arg and
    uproc_opts handling into the TKARG (@"text...") handler, as it does
    exactly the same thing. [eval.c, evar.h]
    Removed an unneeded copy-back of a buffer in the TKBUF branch of
    getval(). [eval.c]
    Updated showdir to replace &arg with @. [uemacs.rc]

exec.c
    Check for TKLIT rather than !TKCMD when looking for a numeric arg in
    docmd().

names.c
random.c
efunc.h
etc/uemacs.rc
    Rename insert-string (istring()) to insert-tokens (itokens()) and
    insert-raw-string (rawstring()) to insert-string (istring()) to
    better reflect what they actually do.

random.c
    Get the value of a token in string_getter, so that we handle
    quoted strings correctly.

input.c
etc/uemacs.hlp
    Add (hard-wired) CTLX-return to evaluate the result before returning
    (it will still be added literally to any macro).
    Don't pause to display multiple choices on a keyboard macro rePLAY.

bind.c
    Limit keybindings to the ASCII key range.
    Add a list of key-bindings in key order in describe-bindings.

../CHANGES
../TODO
eval.c
version.h
etc/uemacs.rc
etc/uemacs.hlp
test-files/fillpara.long_jap.txt
    Add the copying of userproc_arg to buf in getval, that was (somehow)
    forgotten in the recent UFPROCARG change. [eval.c]
    Minor (typo) fixes. [fillpara.long_jap.txt]
    Update to GGR4.158

========== GGR4.159

fileio.c
    Add a test to stop a warning from -fanalyzer in gcc 10.

autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
    Changed to use insert-string not insert-raw-string to fit in with
    function name change at GGR4.158.

estruct.h
    w_force in struct window needs to be int (not char) for windows of
    >127 lines.

../CHANGES
../TODO
version.h
etc/uemacs.hlp
evar.h
exec.c
    Remove wish to use unsigned-char from TODO.
    Typo-fixes to evar.h, exec.c, uemacs.hlp.
    Update to GGR4.159

========== GGR4.160

estruct.h
line.c
region.c
word.c
    Changed incorrect usage of r_size in getregion(). It is bytes, but
    was being used as graphemes. [region.c]
    Renamed r_size to r_bytes to clarify [all]
    Added r_endp field to struct region so that narrow() knows exactly
    where to go without having to skip through the buffer on a
    per-character basis. [region.c]

region.c
    Avoid "may be used uninitialized" in gcc4.4.7 by assigning creg to
    itself.

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.160

========== GGR4.161

random.c
    Make typetab() work with columns, not byte counts, so that typing a
    tab in a line with tabs doesn't shoot past where you expect.

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.161

========== GGR4.162

random.c
    Add a comment as to what re_args_exec does.

file.c
    Change the unqname() code to remove a "may be truncated" compilation
    warning.

etc/czech.cmd
    Change (correct) e~~ -> U+0115 (breve) to be e~~ -> U+011b (caron).

exec.c
etc/uemacs.rc
    Display the name of what was not found for absent procedure, buffer
    and label searches. [exec.c]
    Allow labels to be the result of function evaluations. [exec.c]
    Rework _mytoggle-mode to use an evaluated !goto rather than
    successive tests. [etc/uemacs.rc]

search.c
    If we are in reexecute mode for a forward magic search and the
    previous match was zero-length, step-forward 1 place first, so we
    don't get stuck in the same place. And step back on no match.

search.c
    In check_next() check that there *is* a next character to check, so
    we don't loop round at the end of a buffer on wildcard magic buffer
    matches.

search.c
    In mgpheq() don't return mid-function. Set res and break so that the
    negate and free code at the end can run.

autotest/dump_mc.debug
    Change i, j loop variables to avoid namespace clashes.

names.c
search.c
    Re-add hunt-forward and hunt-backward to the name binding list, but
    mark them as not-interactive (so can't be bound to keys) [names.c]
    Remove check for inreex in forwhunt() in zero-length match handling.
    [search.c]
    This allows hunt-forward (hunt-backward) in a macro to work as
    reexecing a search, while allowing a debug write statement in between.

search.c
    Cater for \n, \r, \f and \t within character classes as well as
    outside of them.
    This allows you to put \n in a negative class match to limit it to
    matching on one line.

exec.c
globals.c
main.c
names.c
search.c
edef.h
estruct.h
    Added srch_can_hunt flag to ensure that a repeated search
    string is valid. [edef.h, globals.c]
    Added search_ok option to functions which do not affect dot
    [estruct.h, names.c]
    Force search_ok on for stored procedures, as individual commands
    will "do the right thing". [exec.c]
    Set srch_can_hunt to valid direction after a successful search
    [search.c]
    Unset srch_can_hunt if executed command is not a search_ok one.
    [main.c]

autotest/zero-length-magic.sh
    New test file for testing zero-length re-matches in Magic mode.

search.c
autotest/zero-length-magic.sh
    Changed forwhunt/backhunt to move to "other end +1" of the
    previously found search before searching again.
    This allows for overlapping matches to be found (e.g. "issi" twice
    in "mississippi").
    This handles the zero-length match handling repeats as well.
    Update the zero-length-magic test script to reflect the additional
    match from allowing overlaps.

autotest/search-groups.sh
autotest/search-props.sh
autotest/search-u_hex.sh
    Added a missing "execute-procedure report-status" line to each.
    The tests were being done and counted, but not reported.

search.c
    Removed the move to "other end" in backhunt as it isn't required
    (we're already at the right end).
    Removed the move to "other end" in forwhunt on first call via
    forwsearch, as there is nothing to skip then.
    It now passes all of its tests again.

eval.c
    Unset srch_can_hunt when variables that affect the state of text are
    modified.
    curcol, curline, curchar, cwline, cmode and line.

utf8.c
utf8.h
    Add glyphcount_utf8(), which gets the "glyph-count" for a utf8
    string (uclen_utf8 gets the unicode character count).

exec.c
    In docmd() and namedcmd(), unset the srch_can_hunt flag if the
    called function doesn't allow it

efunc.h
search.c
    Changed nextch() to nextbyte(), for clarity.
    Make search, search (with same string) behave in the same way as
    Esc2 search. i.e. it allows overlapping matches.
    Since forw/backscanner() no longer loops, moved the remaining code
    into forw/backhunt() (which now loops).
    Fixed the pre-skipping code to cater for slow/fast scan differences
    (fast always needs it, slow doesn't for back searching).

eval.c
estruct.h
evar.h
    Add $srch_can_hunt system variable, to allow setting the flag in test
    macros. Also globals.c

autotest/search-classes_in_closures.sh
    Wipe out memory of a search, now we detect overlapping ones.

autotest/search-props.sh
    Up the match count from 9 to 10, as an additional overlapping one is
    now found.

autotest/zero-length-magic.sh
    Set $srch_can_hunt  to 1 before all hunt-forward calls, as we switch
    buffers when reporting, which wipes out the flag (but we know it is
    OK to run it).

display.c
globals.c
input.c
search.c
estruct.h
etc/uemacs.rc
    Add R(eport) mode. When on and in Magic mode, report the matchlen
    and match (<<multiline>> if match contains \n) in the minibuffer.

search.c
    Fix group_match to just return any allocated match, not make a new
    one on each call(!) (a memory leak).

eval.c
globals.c
search.c
edef.h
estruct.h
evar.h
    Add $srch_overlap system variable, to determine whether we want
    successive searches to find overlapping matches. Defaults to true.
    Use it in search.c to affect the actual search.
    Modified group_match fix.
    Correct setting of srch_can_hunt (set it to given value, not 1)
    [eval.c]

search.c
    Corrected slow_scan setting. Only turn it on in mcstr if the
    original search string cannot be used literally.
    Added can_repeat to \n, \r, etc. mapping in mcstr() and mark them
    for slow_scan.
    Added mc_alloc to indicate whether mcpat has allocated strings to
    be freed.

search.c
    Simplified the delete/replace logic in delins() for replaces().
    NOTE that the replaces() code does NOT use any srch_overlap setting,
    as that might mean it finds a match involving the text it has just
    added as a replacement. Which could be confusing and is highly
    unlikely to be intended or useful.

display.c
efunc.h
    Fix TTput_1uc() to handle character widths > 1.
    Added backcol_cursor().

isearch.c
search.c
efunc.h
estruct.h
    Fixed up scanmore() to handle preskips for incremental searching
    and ensure that Magic mode is off when i-searching. [search.c]
    Make risearch() just call fisearch() with a reversed direction.
    Remove match_pat() and checknext() functions - just let scanmore()
    handle everything.
    Don't add previous search string to the prompt, as it is never used.
    [isearch.c]
    On a failure reverse-highlight the last character (which caused the
    failure). [isearch.c]
    Added two parameters to scanmore() to indicate when we want the next
    match and to extend the current match. [efunc.h, isearch.c,
    search.c]
    Enable scanmore(0 to tell step_scanner() not to preskip 1 for a
    reverse search. [search.c, estruct.h]
    Mark step_scanner() and fast_scanner() static functions. [search.c]
    Make fast_/slow_scanner() call init_dyn_group_status() at their
    start. Also call this at the end of replaces(). [search.c]
    Make isearch() remove group match info as it returns. [isearch.c]

buffer.c
main.c
    Correct incorrect logic in killbuffer() when deleting invisible
    buffers. [buffer.c]
    Remove the AutoClean_Buffer after start-up. Rename /List to //List
    (so it is ignored on invisible buffer deletion) [main.c]

random.c
    Add the byte offset to the information line (after the column info)

buffer.c
globals.c
    Tidied up list-buffer output alignment after adding the Report mode.

isearch.c
search.c
efunc.h
    Add handling of //incremental-debug buffer so that test scripts can
    be written for incremental searching and query replace.
    This handles the 1-char replies expected alomng with defining a
    user-procedure to run the relevant test(s).
    Re-ordered some isearch.c code.

autotest/incremental-search.sh
autotest/query-replace.sh
    Added two simple scripts to test incremental searching and query
    replace.

search.c
    Avoid a report of "may be used uninitialized" for used.

../CHANGES
../PREREQUISITES
version.h
etc/uemacs.hlp
    Updated Magic mode help to mention \n, \r, \f and \t now allowed in
    classes and added comments about a negative class possibly matching
    newline unexpectedly and a repeat search starting "one in" from the
    other end of the previous match.
    Updated info on building libbacktrace.
    Update to GGR4.162

========== GGR4.163

word.c
    In inword(), having looked for a zero-width break, return FALSE if
    we find it!

bind.c
    Tidy up index_bindings()/bindtokey() keycode setting.
    In show_key_binding() check for (k_type == PROC_KMAP), not
    (n_func == execproc) as execproc may not have a handler.
    In buildlist() dump all key combinations (several were missing).
    In cmdstr() handle unicode (and Delete).

word.c
    In wrapword(), check for an empty line (==error) and whether we are
    at EOL before backing up a char.  Makes more sense for a bindable
    function.

tcap.c
ebind.h
estruct.h
    Removed the SPEC|'c' (metafn) and SPEC|'i' (cex) bindings [ebind.h]
    Removed VT220 #define and made conditional usage true.
    Removed unused VT100, ANSI and VT52 #defines
    [ebind.h, estruct.h]
    Removed TERMCAP #define and made conditional usage true. [tcap.c,
    estruct.h]

bind.c
input.c
    Change stock():
        o to look for Ctlx first (enables extra Ctlx bindings)
        o to return 0 on mal-formed strings
        o better handling of SP for space and ^? for Delete
        o disallow literal Control-char input
    Added the new Ctlx+Meta+Control, Ctlx+Meta and Ctlx+SPEC bindings to
    buildlist, and also the (internal) Meta+SPEC ones. [bind.c]
    Changed getcmd() to hard-wire CSI handling, and changed what the
    CSInn~ key mappings returned.  F1 now maps to FN1, F2 to FN2. etc.
    Added Ctlx prefix handling for ControlX+Meta+Control, ControlX+Meta
    and ControlX+SPEC bindings to work. [input.c]
    You can now bind a function to Esc-Esc.

bind.c
    Abort various functions on a zero character return from getckey()
    as stock() can now do this.

bind.c
buffer.c
isearch.c
    Ensure all internal/control buffers start with "//" not just "/".
    Change help buffer name to //Help and remove filename from it. [bind.c]
    Check for NULL buffer pointer before switching to it in swbuffer().
    Fix buffer's filename printing in makelist. Also make it use the
    current screen with. [buffer.c]
    Comments updated. [isearch.c]

exec.c
search.c
word.c
efunc.h
estruct.h
    Removed isletter (which was from pre-Unicode days).
    Extended inword() to take an optional line buffer parameter (and
    moved it to be ahead of its users in the file). [exec.c, word.c,
    efunc.h, estruct.h]
    Reworked wordcount() to use new inword(), not isletter() [word.c]
    Changed isletter() to isASCletter() and correct CCL bitmaps to only
    be sized for the ASCII char set. [search.c]
    Moved some #defines from estruct.h to search.c (only user).

eval.c
search.c
efunc.h
estruct.h
    Removed islower and isupper (unused) - both from pre-Unicode days.
    Renamed eq() to asceq() [eval.c, search.c, efunc.h]
    Added simple isASClower() define. [search.c]
    Removed is(x)lower and is(x)upper defines. [estruct.h]

input.c
    Treat Esc[[x abd Esc[x to handle console keys in Linux.

Various tidying up(?) whilst looking for missing free()s.

bind.c
eval.c
estruct.h
    Updated some comments.
buffer.c
    Free any Phonetic Translation table info in bclear().
exec.c
    Clear global ptt in ptt_free if we are freeing it.
-----
Makefile
    Add ANALYZE option.
-----
exec.c
    Updated comment.
region.c
    Consolidate some duplicated code in casechange_region().
utf8.c
    Change a for{} loop to a do{} one in utf8_recase(), to satisfy
    the gcc analyzer.
-----
wrapper.c
efunc.h
    Added attributes to Xmalloc() and Xrealloc() and added Xstrdup() to
    aid in missing free checks.
-----
exec.c
    Switched strdup() to Xstrdup().
    The gcc 11.2.0 analyzer reports a leak, but adding a printf("")
    statement before the return makes it go away.
    Added a comment and ignored it.
-----
bind.c
line.c
    Switched strdup() to Xstrdup().
-----
word.c
    Fixed a leak of wbuf and space_ind on a filler() failure.
-----
word.c
    Free any extended grapheme data we get in inword().
-----
main.c
    Only allow one of -c or (deprecated) @ setting of the main start-up
    file.
    Ensure that a copy of the command line text is taken for any @ option.
-----
search.c
    Remove test in cclmake() for clearbits() returning NULL, as it can't.
-----
line.c
edef.h
    Update some kill ring comments.
-----
lock.c
    Rework lockchk so that the malloc()ed tmpname is freed if not used.
    (This code is only used if FILOCK is set at compile time).
-----

autotest/decrypt-file.sh
autotest/encrypt-file.sh
    Added two tests to check that encrypted mode continues to produce
    the same results.

eval.c
exec.c
globals.c
names.c
edef.h
estruct.h
evar.h
etc/uemacs.rc
    Fixes for the toggle-lmode user-proc aborting any macro collection.
    Caused by it ending with !finish (which sets a FALSE exit status).
    The !finish was put there to stop a useless (and very annoying) loop
    (the FALSE exit does this) on a given arg count.
    Often hit by accident if:
        Esc 2000 ^X^T     (trim the next 2000 lines)
    was mis-typed as:
        Esc 2000 ^XT      (prompt me 2000 times for mode to toggle)
    -----
    Added $uproc_lpcount and $uproc_lptotal system variables.
    [eval.c, globals.c, edef.h, estruct.h, evar.h]
    Add a "one_pass" option for user-procs. [exec.c, names.c, estruct.h]
    Set the $uproc_lpcount (current loop no.) and $uproc_lptotal (total
    loops requestd) variables as a user-proc is executed.
    Handle the "one_pass" option for user-procs (but still set
    $uproc_lptotal to the total requestd).
    Allow an optional True arg to !finish (to set a TRUE exit status -
    by default it sets it to FALSE - so more of an abort..).  [exec.c]
    Various macros (centre-line, rm-dflt-repl, spell-check,
    toggle-lmode, toggle-gmode, del-sp-right) marked as one_pass.
    lr-justify set to use $uproc_lpcount to only prompt for indents on
    the first run of a loop. [etc/uemacs.rc]

main.c
    Fix addchar_kbdmacro() to use insert-string not the old
    insert-raw-string.

bind.c
file.c
globals.c
input.c
main.c
names.c
random.c
window.c
edef.h
efunc.h
estruct.h
    Add a new function, switch-internal, to allow swapping in a user
    procedure for the 4 "internal" ones (META|SPEC|'x', X = W/C/R/X)
    Usage is:
        switch-internal X my-user-proc  # install window change handler
        switch-internal X dflt          # to reset to the system handler
    In the process added an internal update_keybind() function for the
    common code used by buffertokey(), switch_internal() and bindtokey().
    [bind.c, names.c, efunc.h]
    Check that the meta-spec handler is not already running before
    activating in (to prevent looping). [file.c, globals.c, input.c,
    main.c, random.c,  edef.h]
    Don't allow the meta-spec-X (new buffer) handler to run if
    collecting a macro [window.c].
    (Comment extended [estruct.h])

input.c
isearch.c
efunc.h
    Removed ectoc() function.
    Just use get1key() and check against CONTROL|'x' directly.

More tidying up(?) whilst looking for missing free()s.

region.c
    Change one Xfree() call in each of three branches to one at the end.
-----
search.c
    Check that the character after a '\' is ASCII.
    Add some comments about gc.ex being known to be NULL.
-----
utf8.c
    Declare grapheme_to_bytes() as static.
-----
word.c
    Make sure we free any gc.ex in ensure_case().

bind.c
    Do an unsigned sort for the key bindings (and lookup!).
    desbind() can now dump all keys in order without the SPEC ones
    showing up first. Simplified desbind to do so.

input.c
    Extended the F-key (CSI nn~) mapping sequences and change the result
    to start at FNa, not FN1, to avoid clashes with Application key
    sequences (CSI n ~, where n = 1, 2, ....).
    Changed Esc[[A mapping from FNA to FNA, as it's sent by F1.
    This results in more unique keys being seen, and more commonality.

exec.c
ebind.h
etc/uemacs.rc
docs/Func+AppKey-Info
    Update comment in freewhile() about available macro commands.
    [exec.c]
    Remove SPEC bindings from the initial keytab [ebind.h]
    Add them in to the start-up file and change the bindings.
    Add some to two different keys, so they will be bound for
    whichever terminal is in use. [etc/uemacs.rc]
    Added Func+AppKey-Info file with results of test key mappings.

input.c
    Removed some old commented out code in getcmd(), slightly
    restructuring the real code knowing it will never go back in.
    Handle CSI2Q, etc.. for Konsole Xfree mode Shift-F2/3/4.

bind.c
    Now that desbind() can dump the entire binding table in order,
    regardless of character ranges, allow non-ASCII keybindings.
    Check for, and disallow, setting any of the four internal bindings
    via bind-to-key or buffer-to-key - it must go via switch-internal.

efunc.h
    Modify __attribute__ statements on X* functions to remove gcc 11+
    options when not using gcc 11+.

autotest/run_all
    Add a script to run all autotest files.

../CHANGES
exec.c
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Comment tidy-ups [exec.c, etc/uemacs.rc]
    Add Key bindings, Internal Key bindings and Function, Application
    and KeyPad keys sections to help.
    Added a Universal argument description. [etc/uemacs.hlp]
    Update to GGR4.163

========== GGR4.164

word.c
    If wordcount() is given a +ve numeric arg, count the whole file.

efunc.h
    Modified malloc attributes to cater for ggc4.

bind.c
input.c
    In getcmd(), ignore meta once we get to the CSI (SPEC) handling.
    [input.c]
    Add comments that getcmd() and stock() both prevent SPEC|META being
    set. So the internal_handlers are "safe". [bind.c, input.c]

bind.c
main.c
estruct.h
    Allow a key-binding to have a defined multiplier for its function,
    by carrying over any numeric arg to bind-/buffer-to-key.
    Displayed as {n}func when displaying.

main.c
random.c
search.c
word.c
    Fix UNUSED() usage in wordcount() now that we do use n. [word.c]
    For tests of n being different to 1, *don't* test f as well. For n to
    be != 1, f must be TRUE (see multiplier_check in main.c)
    reexecute() [main.c], writemsg() [random.c], replaces() [search.c],
    wordcount() [word.c]

bind.c
input.c
estruct.h
    Set completion type to CMPLT_PROC (not CMPLT_BUF) when prompting for a
    user-procedure name. Changed the prompt text. [bind.c]
    Check for leading '//' on BTPROC expansion to skip //kbd_macro
    [input.c]
    Expand completion-type comments [estruct.h]

main.c
word.c
    Fix inword() to check for a Zero-width break correctly (it is not a
    combining character!).
    Modify wrapword() to use inword().
    Simplified backword() and forwword() and extended comments.
    Added comment in main.c that the space is added *after* wrapword() runs.

basic.c
eval.c
main.c
random.c
word.c
efunc.h
    Removed the bflg option to getccol(), after noticing that no call
    used it. [random.c, efunc.h]
    Callers:
        forwline [basic.c]
        $curcol [eval.c]
        execute [main.c]
        showcpos, typetab, insert_tab, insert_newline, insbrace,
        inspound [random.c]
        filler, justpara [word.c]

word.c
    Modify wordcount() to wrap the entire line (not just the last word)
    when passed an arg > 1.

eval.c
globals.c
edef.h
estruct.h
evar.h
    Added ggr_opts as a bit-mask for ggr options. [all]
    Added ue_atoi to allow some variables to be set using hex (or
    octal) ($curchar $cmode $gmode $gflags $ggr_opts) [eval.c]

globals.c
random.c
word.c
edef.h
estruct.h
    Replaced single using_ggr_style variable with ggr_opts bit map.
    ggr-style function now turns all bit on/off (used in etc/uemacs.rc).
    [globals.c, random.c, word.c, edef.h, estruct.h]

eval.c
    Switch to ue_atoi() as input for the bit function.

main.c
random.c
word.c
estruct.h
    Added GGR_FULLWRAP bit for ggr_opts.
    Used it to set the numeric arg for the META|SPEC|'W' word-wrap call.
    [main.c, random.c, estruct.h]
    Corrections to wordwrap() [word.c]
    Set *all* bits on in ggr_style() [random.c]

etc/uemacs.rc
    Added toggle-ggr-opts procedure, to toggle $ggr_opts settings. Bound
    it to ^XG.
    Changed the bit settings in _mytoggle-mode to be in hex.

random.c
    Add the code for (documented) -ve args to killtext.

word.c
efunc.h
    Fix do_actual_wrap() so word wrapping still occurs when there are
    multiple spaces at the end of the line.
    Cater for "mid-line" space inserting in FullWrap mode.
    Add at_wspace() (since inword() is incorrect for wrapping) with
    at_wspace and inword using class_check().
    class_check() now handles and advances correctly at a newline.
    wordcount() corrected using the modified inword().

autotest/wordwrap.sh
    A script for testing word wrapping in different modes.

autotest/wordwrap.sh
    A script for testing forw/back-word in different modes.

word.c
    Correct test for GGR_FORWWORD being set in forwword().

random.c
    Correct test for GGR_TWIDDLE being set in twiddle() and honour any
    numeric arg.

autotest/incremental-search.sh
autotest/query-replace.sh
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
autotest/zero-length-magic.sh
    Print the expected value in all cases when the test fails.

buffer.c
    Ensure there is always a space between the buffer name and file name
    when listing buffers.

word.c
    Check that a zero-width break has no combining char(!) in class_check.

etc/uemacs.rc
    Change count-words FNl binding to have a 2 prefix, so that it works
    on the entire file. (Can override back to region with Esc0).

eval.c
evar.h
autotest/wordwrap.sh
    Added &blit function (for generic hex, dec, oct input) and switched
    to using it in autotest/wordwrap.sh.

eval.c
estruct.h
evar.h
    Combined the delete code for user and buffer variables (they have
    the same structure) and corrected a comment that user vars couldn't
    be deleted.

input.c
    In getcmd() return 0 if we reach the CSI code with meta set.
    Unset meta before intentionally going to CSI code.

globals.c
line.c
region.c
word.c
edef.h
    Add a global system mark (updated in the same way as the buffer
    mark) [globals.c, line.c, region.c, edef.h, word.c]
    Use it, so that word wrap and kill paragraph don't lose any user
    mark. [region.c, word.]

word.c
efunc.h
    Renamed at_wspace() to be at_break() and added a new at_wspace()
    that does only check for whitespace.
    Complete rewrite of filler(), the generic filling routine called
    by various front-ends, to much simpler code.
    It now reformats as it goes (rather than building up a dynamic new
    line of text and adding that).  As a result it no longer wipes out
    the mark.

word.c
    Fix a long-standing (original?) bug in backword() that would cause
    it to return FALSE when stepping back over the first word in a file
    if it started in column 1.  Added same fix to filler_bword().

autotest/parawrap.sh
autotest/wordwrap.sh
    Added a test script for paragraph wrapping.
    Modified the word-wrap test to check for entire line contents, not
    just a character in one position.

../CHANGES
../README
version.c
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Added some generic change comments to README.
    Add sections on Opening a directory, Keyboard macros and GGR style
    to the help file.
    Update to GGR4.164

NOTE: The code now compiles cleanly in ANALYZE mode. The leak reported
for exec.c (q.v.) has gone.

========== GGR4.165

search.c
    Reset slow_scan for the EXACT and not MAGIC setting. Otherwise we
    end up searching for the previous string via its pattern.
    (Broken in GGR4.162)

main.c
random.c
    If we are in column 1 after running the word-wrapping on a space, do
    not insert the space.

exec.c
    Allow commands to start with an variable or function to set
    a numeric arg for execution.

word.c
efunc.h
    Fixed a loop in wrapword() when trying to wrap an over-long line.
    Simplified do_actual_wrap().
    Re-order functions and marked filler() as static.
    Handle zero-width breaks in paragraph filling.

autotest/parafill.sh
    Renamed from autotest/parawrap.sh.
    Added zero-width break and modified test results to allow for it.

autotest/wordwrap.sh
    Updated tests.

autotest/search-magic-on_off.sh
    Added a test for a Magic non-exact search followed by a non-Magic
    exact one (for recent search.c bug and fix).

search.c
    Only reset slow_scan for the EXACT and not MAGIC setting if we are
    looking at the srch pattern.

search.c
    For a forward fast-scan check that the next character is not a
    combining diacritical as, if it is, we haven't actually matched.

../CHANGES
../KNOWN_ISSUES
../TODO
version.h
etc/uemacs.hlp
    Update KNOWN_ISSUES and TODO to reflect changes.
    Update to GGR4.165

========== GGR4.166

eval.c
    Correct the buffer var address sent to del_simple_var().

utf8.c
    Initialize gc->cdm+ex *before* offset check returns.

eval.c
globals.c
edef.h
estruct.h
evar.h
    Added $uproc_lpforced variable to indicate a user-given numeric arg.

exec.c
file.c
main.c
efunc.h
    Set $uproc_lpforced for user procedures run via run_user_proc().
    Set $uproc_lptotal to the requested value even when negative. [exec.c]
    Add the forced parameter to run_user_proc() calls. [file.c, main.c,
    efunc.h]

etc/uemacs.rc
    Changed toggle-ggr-opts to change-ggr-opts.
    Marked it as one_pass and treat no forced arg as toggle, a given +ve
    arg as turn on and a given -ve one as turn off.

eval.c
globals.c
search.c
edef.h
estruct.h
evar.h
    Replaced the $srch_overlap variable with a bit in $ggr_opts

etc/uemacs.rc
    Added an O option to change-ggr-opts to handle srchOlap.

autotest/search-boundaries.sh
    New test script for matches at beginning/end of line/buffer.

search.c
    Only switch to slow scan on a non-ASCII char in mcstr() when we are
    not in EXACT mode.
    Only add the case-insensitive entries to the jump tables in
    setpattern() when we are not in EXACT mode.

display.c
line.h
    Handle the display (perverse case) of a combining char as the first
    on a line.

utf8.c
    Fix cdm handling in build_next_grapheme().
    Fix ex handling in grapheme_to_bytes().

tools/Makefile
tools/combi-class.c
tools/combi.h
tools/combi.info
    Updated combi-class.c to check for Mn and Me categories too.
    Rebuilt combi.h and combi.info.

combi.h
    Installed new version for uemacs use.

search.c
    Added the test for a reverse fast-scan check that the next character
    is not a combining diacritical.

autotest/multi-ex.sh
    Add a simple test for multiple combining diacriticals.

display.c
utf8.c
utf8.h
    Moved set_grapheme() function into display.c and marked it static.
    Removed its usage from build_next_grapheme().

eval.c
isearch.c
search.c
utf8.c
word.c
utf8.h
    Add a no_ex_alloc option to build_next/prev_grapheme().

line.c
    Change lgetgrapheme() to use build_next_grapheme() for its work.

utf8.c
    Change loop limit in prev_utf8_offset() to stop offset going
    negative if the line starts with a combining diacritical.

autotest/00-decrypt-file.sh
autotest/00-encrypt-file.sh
    Add 00- prefix to ensure they are run first when run_all is run.
    (Their output is different to the other scripts).

autotest/combi-col0.sh
    Add test for lines starting with a combining diacritical.

Makefile
    Added combi.h as a dependency for utf8.o

eval.c
    Change some build_next_grapheme() calls to utf8_to_unicode().

random.c
    Remove combining_type() check in setccol().
    It was never needed, and is wrong when a line starts with a
    combining diacritical.

utf8.c
    Change utf8_to_unicode() to return UEM_NOCHAR no NUL if index is out
    of range.

../CHANGES
../PREREQUISITE
version.h
etc/uemacs.hlp
    Update to GGR4.166

========== GGR4.167

exec.c
file.c
main.c
efunc.h
    Modified unqname() to avoid integer overflow in power10() (undefined
    behaviour since C99). Removed power10() and combined unqname() with
    makename(). [file.c]
    Added extra arg for makename calls and remove the associated
    unqname() calls. [exec.c, file.c, main.c, efunc.h]

exec.c
    Free the while_block correctly (without using a pointer in what
    you've just freed).

main.c
    Initialize sigact.sa_mask and remove oldact from sigaction() calls.

search.c
    Allocate the screen data in one block, and assign the p/vscreen
    arrays into it.

buffer.c
    Delete buffer variable values in bclear().

utf8.c
    Ensure we always have enough space allocated in grapheme_to_bytes().

word.c
    Null eos_list if we free it.

Makefile
    Added a FREE option to Makefile to define DO_FREE when compiling.

bind.c
buffer.c
display.c
eval.c
input.c
line.c
lock.c
main.c
names.c
search.c
utf8.c
efunc.h
    If DO_FREE is set, add a routine to free things at exit that are
    normally just left allocated.
    To enable valgrind to look for leaks and incorrect usage.
    The routines are called from quit() in main,c

buffer.c
    Save/restore current buffer correctly when unnarrowing.

file.c
fileio.c
globals.c
    Set fline to NULL in the correct places!

eval.c
    Add free of user-var names to free_eval().

search.c
    Add free of srch/repl ring buffers to free_search.

exec.c
main.c
efunc.h
    Add a free_exec() (called from quit()) to free prev_line_seen.
    Add (missed) free_bind() call in quit(). [main.c]

file.c
fileio.c
globals.c
    More fixes for fline handling to avoid a memory leak.
    Don't call add_to_fline() with an empty cache in ffgetline().
    At EOF, return immediately if there is no fline.
    Just initialize fline to NULL at start of ffgetline().

estruct.h
    Change max dimensions to 600x300 (not 500x500).

buffer.c
display.c
tcap.c
    First changes for making the screen data truly dynamic.
    No maximum setting for cols/rows. [buffer.c, display.c, tcap.c]
    Tidy up sigaction call parameters [display.c]

main.c
    Move setpattern() call (and srch_can_hunt setting) for -s command
    line option to just before use, rather than when it is found as it
    now needs a valid curwp.

search.c
    Don't run setpattern() for slow scans and initialize mcpat[0].mc.

buffer.c
    Fill buffer list info to t_mcol, not just to t_ncol.

bind.c
isearch.c
region.c
edef.h
    Fix some comments.

eval.c
random.c
etc/uemacs.hlp
    Change the external usage of columns to be 1-based for $curcol and
    $fcol [eval.c]
    Change buffer-position display to show columns as 1-based [random.c]
    Document $fillcol in help file [etc/uemacs.hlp]

autotest/combi-col0.sh
autotest/incremental-search.sh
autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/query-replace.sh
autotest/search-boundaries.sh
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-magic-on_off.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
autotest/zero-length-magic.sh
    Update tests to allow for $curcol now being 1-based.
    Ensure all test macros end with "-2 redraw-display".

display.c
eval.c
input.c
isearch.c
main.c
spawn.c
tcap.c
window.c
edef.h
efunc.h
estruct.h
    Change term.t_nrow to be the real row count and add t_mbline (-1)
    and t_vscreen (-2) for display usage. [display.c, eval.c, input.c,
    isearch.c, main.c, spawn.c, tcap.c, window.c, estruct.h]
    Add SET_t_nrow define to set all 3 from a new row count [edef.h]
    Add set_scrarray_size() function [display.c, tcap.c, efunc.h]

file.c
    Combined the readin() and ifile() ffgetline() loop into a file2buf()
    function.

display.c
globals.c
posix.c
tcap.c
window.c
edef.h
estruct.h
    Dynamic sizing handling changes to newsize and newwidth. The default
    sizing is now to the values set at start-up. [globals.c, tcap.c,
    window.c, edef.h]
    Change ttrow/ttcol "no value" setting to be -1, not -100, 999 or
    HUGE (1000). [display.c, globals.c, posix.c, tcap.c, estruct.h]

display.c
    Fix bug in modeline mode display.

file.c
    Use local static variables rather then passing args by ref for
    file2buf().

display.c
    Fix newsize() and newwidth() calls in newscreensize().

window.c
    Call vtinit() on screen width/size increases if needed.

display.c
eval.c
globals.c
input.c
main.c
names.c
spawn.c
tcap.c
window.c
edef.h
efunc.h
    Assume all builds have SIGWINCH and TIOCGWINSZ.
    Removed #if tests for SIGWINCH and TIOCGWINSZ by using the TRUE
    branch in each case. [display.c, input.c, main.c, spawn.c, tcap.c]
    Remove change-screen-size (newsize) and change-screen-width
    (newwidth) commands. Changed newsize() and newwidth() to just take
    one parameter. [display.c, eval.c, names.c, window.c, efunc.h]
    Remove orig_ncol and orig_nrow as they are no longer needed.
    [globals.c, tcap.c, edef.h]
    NOTE: You can still change the height and width "manually" by
    setting $pagelen and $curwidth.

display.c
    Improve data initializing and freeing in vtinit().
    Free any old grapheme ex data then initialize all of the new vscreen
    and pscreen.  This is simpler, and allows for ncol/nrow shrinking.

Minor changes to get uemacs working on Solaris11 (x64)
-----
Makefile
    Remove obsolete compile options.
    Fix code to look for static libbacktrace.
    Add Solaris options, and enable libbacktrace for it.

display.c
    Include sys/termios.h if needed for TIOCGWINSZ, and change
    getscreensize() to query stdout, not stdin.

estruct.h
    Make FILOCK an optional compile-time setting, and off by default.

lock.c
pklock.c
    Fixes to header file inclusions.

tcap.c
    Remove internal putpad() and change all its callers to use putp().
    Optionally defined _BOOL.
    Change CS variable to be _CS (Solaris has a problem otherwise).

-----

basic.c
    Fix a(n ancient) logic bug in curline_empty().

eval.c
evar.h
estruct.h
    Added $sys_type system variable.

etc/uemacs.rc
    Set .sort to be gsort for Solaris (otherwise sort) in userpoc
    showdir for directory browsing.

autotest/00-decrypt-file.sh
autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/search-boundaries.sh
autotest/search-groups.sh
autotest/search-magic-on_off.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
    Change "awk -b" to "gawk -b" as that works on both Linux and Solaris.

bind.c
eval.c
estruct.h
    Remove ENVFUNC define and enable all code it controlled.

display.c
    Parameterize minimum column and row sizes in set_scrarray_size().
    Set MINCOL to 240 and MINROW to 70.

tools/run_valgrind
    A simple front-end script for running uemacs under valgrind.

file.c
    Avoid a gcc 8.4.0 compilation warning in makename().

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.167

========== GGR4.168

main.c
    Uppercase key1 before command option check to shorten tests.

exec.c
estruct.h
    Fix typos in comments

version.c
Makefile
    Use a run-time test to look utf8proc_unicode_version as it really
    does depend on what we have now, not what we had when we compiled.
    Also, fix up libraries used - all now have ncurses.

Add force_mode_on and force_mode_off settings to allow specific modes to
be force on regardless of file-hooks.
Useful if you know you are about to edit a series of long-lined files
and don't want the default WRAP mode on, even though file-hooks would
set it.
-----
buffer.c
edef.h
efunc.h
    Add force modes to buffer modes after file-hooks are run.
    Display forced modes in buffer list.
    Add code to set force_mode_on and force_mode_off.

eval.c
evar.h
estruct.h
    Add force_mode_on and force_mode_off as readable variables.

globals.c
    Initialize force_mode_on and force_mode_off to be empty.
    Change eQuiv buffer status char to be "Q" not "q" - so that
    the buffer list display makes sense.

main.c
    Add -f keyword for force_mode_on/off.

names.c
    Add set-force-mode as a command.

etc/uemacs.hlp
    Extend description of buffer modes to explain force_mode_on and
    force_mode_off.
-----

region.c
    Avoid going to the end of the full buffer when widening whilst at
    the end of the narrowed buffer.

file.c
    Allow a user arg of 2 to insfile (insert-file) to mean "replace the
    active content", so if the buffer is narrowed that gets overwritten,
    otherwise the whole buffer is overwritten.

etc/uemacs.rc
    Use "2 insfile" in spell-check to allow spell checking only the
    narrowed part of a buffer.

exec.c
    Ensure all einit mallocs are freed, and use realloc in the loop.

autotest/run_all
    Print out the number of tests run.

main.c
    Put a case block in braces to allow a declaration on the first line
    with older gcc.

../CHANGES
version.h
    Update to GGR4.168

========== GGR4.169

display.c
globals.c
main.c
window.c
    Fix bug introduced in GGR4.167 vscreen/pscreen changes.
    Set all windows for a full redraw and modeline update in vtinit()
    [display.c]
    Initialize wheadp to NULL. [globals.c]
    Comment note that vtinit() must precede edinit(). [main.c]
    Remove w_flag setting after vtinit() call. [window.c]

eval.c
globals.c
edef.h
Makefile
    Use a random start to random numbers (compile-time option).
    Define RANDOM_SEED during compilation. [Makefile]
    Make seed a local variable and set it from getpid() if RANDOM_SEED.
    [eval.c]
    Removed global seed. [edef.h, globals.c]

eval.c
estruct.h
evar.h
    Added $pttmode user variable (read only). [eval.c, estruct.h,
    evar.h]

etc/uemacs.rc
    Change spell-check to use spell4ue external command and pass along
    any PTT mode (spell4ueLANG) and user arg (spell4ueRPT), allowing the
    user to write a suitable script to do what they wish.
    Also return to the original line in the file after spell checking.

combi.h
tools/combi.h
tools/combi.info
    Generated latest values.

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.169

========== GGR4.170

main.c
    Reinstate setting global mode to main buffer at start, erroneously
    removed in GGR4.168.

eval.c
    Modified ue_print (the &ptf function) to allow it to use many printf
    formatting options (but not * or $).
    Added a real division function (&rdv).

etc/uemacs.hlp
    Reformatted and expanded the FUNCTIONS section.

eval.c
    Make ue_print re-entrant.
    Correct the adding of an error message text to the output.

eval.c
evar.h
Makefile
etc/uemacs.hlp
    Added and documented user functions for real (double) numbers.
    Add, subtract, multiply, divide, power, less than, greater than and
    real-to-int conversion.
    Extended &ind function to evaluate its argument, not just expand it
    as a variable, so that all variable types and functions can be used.
    [eval.c, evar.h]
    Added -lm to the build. [Makefile]
    Updated the FUNCTIONS section. [uemacs.hlp]

eval.c
    Check for division by zero in integer functions in gtfun().
    Also check for overflow in real to integer conversion.
    Refactor the large switch statement in gtfun() to pull out common
    arg handling requirements.

autotest/arithmetic-tests.sh
    Added simple tests for arithmetic functions.

autotest/*.sh
    Add the name of the test at the start and end of each output report.

autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/search-boundaries.sh
autotest/search-groups.sh
autotest/search-magic-on_off.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
    Test for a working gawk -b before running the test.

window.c
    Reformat enlargewind() function.

random.c
    Mark string_getter() as static.

main.c
    Mark usage(), stk_printf(), get_to_dumpdir(), exit_via_signal() and
    set_rcfile as static.

input.c
    Mark sigwinch_handler() as static.

fileio.c
    Mark file_is_binary() as static.

exec.c
efunc.h
    Mark cbuf() as static. [exec.c]
    Remove cbuf from the extern list. [efunc.h]

isearch.c
pklock.c
spawn.c
    Mark reeat() as static. [isearch.c]
    Mark gethostname() as static. [pklock.c]
    Mark get_orig_size() and check_for_resize() as static. [spawn.c]

main.c
efunc.h
    Mark edinit() as static and move to before main(). [main.c]
    Remove edinit from the extern list. [efunc.h]

efunc.h
estruct.h
    Reorder all extern statements to be in the order they are in the
    given file, and put the file sections into alphabetical order.
    [efunc.h]
    Remove references to cexit (which is not in main.c). [efunc.h,
    estruct.h]
    Remove (now gone) vtfree declaration. [efunc.h]
    Remove a duplicated movecursor() declaration. [efunc.h]

isearch.c
search.c
    Fixed a bug in "find next match" in incremental search (in
    scanmore() as it was adding an (unneeded) pre-skip of the current
    match length. [search.c]
    Spell checked comments. [isearch.c, search.c]

autotest/incremental-search.sh
    Added a simple test for ctl-S/R in incremental search.

eval.c
autotest/arithmetic-tests.sh
    Correct TOOOBIG to TOOBIG and fix the regression test to work with
    string responses.

etc/uemacs.hlp
    Mention that arithmetic functions may return non-numeric results.

search.c
    Check for GGR_SRCHOLAP in scanmore() so that incremental searching
    can match overlapping strings, if chosen.

random.c
    Change insert-tokens in macro (non-interactive) mode to insert all
    of the remaining (evaulated) tokens on the line,
    (insert-string sill inserts just the evaluated first token).

isearch.c
    Fix the display and handling of control characters in the search
    string.

display.c
    Don't bother moving cursor if we aren't displaying in mlwrite_ap().

iline.c
isearch.c
autotest/incremental-search.sh
    Ensure that the text in struct line always has room for a
    terminating NUL char to be added. [line.c]
    Allow strings of characters (not just one) as control input in the
    //incremental-debug buffer in idbg_nextchar().  [isearch.c]
    Extend incremental search tests. [incremental-search.sh]

isearch.c
etc/uemacs.hlp
    Change get_char() to use tgetc() not get1key() and alter the code to
    look for "normal" control characters. [isearch.c]
    Update incremental search description to mention it may not work
    with combining characters. [uemacs.hlp]

display.c
    Allow mlwrite_ap() to clear the message line if it has no text to
    display.

autotest/incremental-search.sh
    Use 0x07 (ctl-G) not 0x03 (ctl-C) to abort searches.
    Clear resulting "search failed" message line.

----------
    Minor syntax changes for clang compiler on FreeBSD,

eval.c
    It objects to "string"+8. Needs &"string"[8].
    Also, ensure Solaris returns [-]INF rather than any other string for
    Infinity.

isearch.c
    Put braces arround a default clause as it starts with a definition.

----------

autotest/arithmetic-tests.sh
autotest/combi-col0.sh
autotest/incremental-search.sh
autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/query-replace.sh
autotest/search-boundaries.sh
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-magic-on_off.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
autotest/zero-length-magic.sh
    Changed the use of "awk" or "gawk -b" to use perl, as that is
    available everywhere - and works.

----------
    Changes to remove the BSD/SVR4/SYSV/UNIX defines, none of which is
    now required.

PREREQUISITE
    Mentioned that Linux, Solaris or FreeBSD are required as the OS.

Makefile
    Use cc on FreeBSD, but gcc elsewhere.
    Remove all -DBSD and -DSYSV from DEFINES.
    Change DEFINES for FreeBSD.

display.c
    Include <signal.h> unconditionally.

file.c
lock.c
pklock.c
efunc.h
    Remove BSD, SVR4 from #if.
    Remove sys/systeminfo.h + gethostname definition (pklock.c)

fileio.c
    Remove #if (BSD | USG) around fixup_fname() code.

input.c
    Remove UNIX, USG and BSD #ifs.
    Remove struct direct mention.

main.c
    Remove UNIX, USG and BSD #ifs.
    Remove CLRMSG code, and GOOD definition.

names.c
ebind.h
    Define "suspend-emacs"/bktoshell unconditionally.

posix.c
    Remove SYSV from a define.
    Edit comments referring to VMS and CPM so that they no longer do.

spawn.c
    Remove BSD, SVR4 #ifs.
    Define "suspend-emacs"/bktoshell unconditionally.

tcap.c
    Make includes non-conditional. Remove possible _BOOL definition.

epath.h
    Remove BSD | USG test,.

estruct.h
    Remove the Machine/OS definitions.

----------

eval.c
autotest/arithmetic-tests.sh
    The real arithmetic can produce NAN as a result, so standardize that
    casing and add a test for it.

autotest/*
    Changed tests to exit at the end and drop a FAIL-testname file on
    errors when run from run_all.
    Dropped common store-procedures into their own rc files and
    exec-file them as needed into each test.

Makefile
    Add a "make check" option, and add additional files to the
    test-clean rule.

isearch.c
    Rewrite idbg_nextchar() to allow for empty lines.

autotest/arithmetic-tests.sh
    Allow for FreeBSD giving NAN for INF/0, but Linux giving -NAN.

autotest/run_all
    Discard *all* output from the "/bin/ls FAIL-*" command.

display.c
efunc.h
    Make the update() function return void, as nothing ever uses any
    return value.

display.c
isearch.c
search.c
    Just return from update() if not displaying. [display.c]
    Set discmd to FALSE during running of fisearch [isearch.c] and
    qreplace [search.c] so that the incremental-search.sh and
    query-replace.sh autotests don't mess up the display on FreeBSD in
    FULL-RUN mode.

etc/uemacs.hlp
    Extended the Incremental search information.

version.c
    Change the "Compiled on" message when using the clang compiler (e.g.
    FreeBSD).

search.c
    Only run incremental_debug_check() in replaces() if query is TRUE.

main.c
    Allow 'n' and 'p' to move to next-/prev-line in VIEW mode.

README
    Update the list of additions.

autotest/arithmetic-tests.sh
    Allow NAN or -NAN on any system for the INF/0 test.

../CHANGES
version.c
version.h
    Move xstr define in version.h and remove from version.c to avoid
    double definition on Android build.
    Update to GGR4.170

========== GGR4.171

Makefile
    Build a statically-linked version if STATIC=1 is given as a
    parameter.
    Remove moto4g Android option.

bind.c
    Remove type arg from buildlist().
    Always use free_path_reqd code.
    Comments tidy-up.

display.c
input.c
    Fix odd overwrite of "Search:" if searching for "Search:"
    Code re-order in mlwrite_ap().  [display.c]
    Remove mlwrite("")/mbupdate() call at start of loop:. [input.c]
    Comments tidy-up.

Makefile
version.c
    Assume we always have utf8proc_unicode_version() available.

main.c
random.c
efunc.h
    Move fmatch to main.c (only caller) and make it static.
    Use sleep() for the delay.
    Comments tidy-up.

crypt.c
    Remove the PARANOID optional code.
    Using it would produce incompatible output files with builds that do
    not use it.

display.c
efunc.h
    Reordered code to avoid pre-declaring internal static functions.
    Declare updpos(), upddex(), updupd() and vtmove() as static.
    Fixed a misplaced #endif in updateline(). [display.c]

buffer.c
    Changed some "start; while(test); next" loops to for loops.
    In namebuffer(), report when you try to use an existing name.

main.c
Makefile
    Change the static build command option to be STANDALONE. [Makefile]
    In STANDALONE mode, use the executable's location for start-up
    files. [main.c]
    This allows you to put uemacs and its start-up files in one
    location on a USB stick...

Makefile
globals.c
main.c
epath.h
version.h
etc/uemacs.rc
    Make the ANDROID moto8g build a general case of STANDALONE.
    Set -DSDIR_SKIP=7 and STANDALONE for ANDROID=moto8g [Makefile]
    Initialize showdir_tokskip to SDIR_SKIP [globals.c]
    Change error message for a negative showdir_tokskip. [main.c]
    No longer set a DFLT_PATH for ANDROID (as a STANDALONE build it will
    set one dynamically at start-up). [epath.h]
    Remove ANDROID specific PROGRAM_NAME_LONG setting. [version.h]
    Remove the $progname check and $showdir_tokskip setting in
    store-procedure showdir. [etc/uemacs.rc]

names.c
random.c
efunc.h
etc/uemacs.rc
    Added an open-parent function and bound it to ^XU by default.

eval.c
autotest/xlate.sh
    Rewrite of xlat to:
        o handle graphemes, rather than bytes
        o cater for trans being shorter than lookup (remove source)
    Added a test file for the function.

bind.c
    Change "/Binding list" to "//Binding list" and make it invisible.

buffer.c
    Don't display any buffer modes for files not yet read in.

Makefile
usage.c
usage.h
wrapper.c
    Correct the text of an error message. [wrapper.c]
    Remove usage.c and usage.h and put a simple die() into wrapper.c

buffer.c
exec.c
fileio.c
line.c
line.h
    Make the text in struct line dynamically allocated, so that it can
    be reallocated for extending (and merging) lines without having
    to (re)allocate a new on and hence have to search for references to
    it and fix up the forw/back pointers. [line.h]
    Use lfree() to free struct line entries [buffer.c]
    Extend l_text, not struct line. [fileio.c]
    Xmalloc l_text (lalloc) and Xfree it (lfree). [line.c]
    Simplify linsert_byte() by just Xreallocing l_text if required, then
    continuing. [line.c]
    Simplify lnewline() by splitting off the excess l_text onto a
    new line. [line.c]
    Simplify ldelnewline() by just extending l_text on the first line,
    copying the second line text in and fixing up pointers and marks.
    [line.c]
    Use memcpy() in getctext(). [line.c]
    Don't check return value of lalloc() for being NULL, as Xmalloc()
    doesn't allow it. [buffer.c, exec.c, fileio.c, line.c]
    Changed some "start; while(test); next" loops to for loops. [line.c]

buffer.c
fileio.c
line.c
region.c
line.h
    Add a ltextgrow() function [line.c, line.h]
    Use ltextgrow() not local, hard-wired code. [fileio.c, line.c]
    Just extend the text buffer, don't allocate a new line. [region.c]
    Let a -ve arg to lalloc() mean that l_text is set to NULL, not
    malloced. [line.c]
    Call lalloc(-1) for the head ("dummy") line creation. [buffer.c]
    Just call Xfree on the malloced part of the line pointers (not
    lfree()) in the DO_FREE code. [buffer.c]

bind.c
buffer.c
main.c
efunc.h
    Add addline_to_curb() to add a line to text to the end of the
    current buffer and make addline() use it. [buffer.c, efunc.h]
    Replace linstr() calls that insert a complete line with
    addline_to_curb(). [bind.c, buffer.c, main.c]
    addline_to_curb() and addline() cannot fail if they return, so make
    them void functions. [buffer.c, efunc.h]
    Remove returned value tests from addline_to_curb() and addline()
    calls. [bind.c, buffer.c]

eval.c
line.c
line.h
    Remove putctext() [line.c, line.h]
    Put simpler code in-line [eval.c]

buffer.c
efunc.h
    Added addline_to_anyb() (with addline() and addline_to_curb() now
    front-ends to this). [buffer.c, efunc.h]

region.c
    If kill-region is passed a multiplier of 2, don't put the killed
    text onto the kill ring.
    Needed to allow a macro to clear a buffer reasonably.

eval.c
exec.c
globals.c
main.c
edef.h
estruct.h
    Remove DEBUGM #define and enable all code that was conditional on
    it. [eval.c, exec.c, globals.c, edef.h, estruct.h]
    Make outline a local variable rather than a global one. [eval.c,
    exec.c, globals.c. edef.h]
    Treat $debug (macbug) as a number (bit pattern) rather than a
    logical. [eval.c]
    Get the macro debug statements to append to the //Debug buffer if
    bit 0x2 is set in macbug. [eval.c, exec.c]
    Use snprintf to format the debug report, and don't limit it to 80
    char output. [eval.c, exec.c]
    Create the //Debug buffer at start-up. [globals.c, main.c, edef.h]

eval.c
exec.c
globals.c
names.c
edef.h
estruct.h
    Add a no_macbug option for macros.
    Define a global macbug_off, to stop debug messages whilst running
    for macros when set.

etc/uemacs.rc
    Added set-debug and clear-debug-buffer macros.
    set-debug - sets $debug to the given numeric arg
    clear-debug-buffer - clears //Debug buffer.
    Bound them to Ctlx-Meta-D and Ctlx-Meta-C respectively.

buffer.c
exec.c
line.c
line.h
    Use addline_to_anyb() to append line to bstore buffer. [exec.c]
    Remove lfillchars macro as it as now only used in one place.
    [buffer.c, line.h]
    Use addline_to_curb() in linsert_byte() if inserting while on the
    final (dummy) line.

exec.c
    Rename cmdstr to thecmd in execcmd() to avoid confusion with the
    function of the same name.

bind.c
main.c
efunc.h
    Move not_in_mb_error() from main.c to bind.c and then make
    cmdstr a static function.

bind.c
    Changed cmdstr() to build result in an internal static buffer and
    return its address.
    Refactored some related "string building" code.

display.c
eval.c
globals.c
input.c
edef.h
estruct.h
evar.h
    Make VISMAC a run time option ($vismac variable) rather than a
    compile time one.

random.c
    Change whitedelete() to delete all spaces in one go.

bind.c
    Tidy up for show_key_binding() and buildlist()

bind.c
input.c
isearch.c
lock.c
    Simplify some prompt code.

random.c
search.c
efunc.h
    Relocate insbrace() and getfence() code [random.c, search.c]
    Move expandp() and boundry() forward in file and mark as static
    functions.  [search.c, efunc.h]
    Change expandp() API to allow sprintf usage. [search.c]
    Changes in new_prompt(), readpattern(), replaces()
    Changed current_base buffer size to avoid a compilation warnings
    about possible buffer overruns. [search.c]

eval.c
    Change an outline size declaration to avoid a compilation warning
    about possible buffer overruns.

line.c
    Add #include alloca.h for Solaris.

buffer.c
    Remove ltoa() and code using sprintf.
    Refactor some makelist() code.

display.c
    Add a static blank (space) grapheme structure for quick assignment.
    Changed mlputli() to use sprintf and made mlputi a front-end to it.
    Changed some "start; while(test); next" loops to for loops.

autotest/arithmetic-tests.sh
    Use &xla to remove any - from -NAN before checking against NAN.

eval.c
    Change sindex() to use strstr().
    Change ue_itoa() to use sprintf().
    Put range (sanity) checks into UFLEFT, UFRIGHT and UFMID.
    Simplify UFESCAPE (strchr() rather than 16-case switch).test.rc
    Change '&' handling in findvar so that any function is evaluated.
    The following now works...
        set &cat ".va" "r1" 777
        2 write-message .var1
    Change EVEQUIVTYPE code.
    General tidy up.

bind.c
    Check for an attempt to bind the (unusable) Meta-minus keystroke.

display.c
input.c
    Fixes for message line display.
    Fix pointer increment location in mlputli(). [display.c]
    Add back mbupdate() after loop: label [input.c]

etc/accents.cmd
    Correct caseset-off/caseset-on typos.

exec.c
    Simplify token().
    Simplify ptt_compile().
    Changed some "start; while(test); next" loops to for loops.

exec.c
random.c
    Check that only one byte has been given by the 0xnn syntax.

word.c
    Fix the post-justify positioning in justpara().
    Position on the next non-blank line - this may not contain
    chars considered to be in a "paragraph".

buffer.c
    Remove setting silent around buffers being made active.

file.c
fileio.c
wrapper.c
    Simplify the read-in message generation in readin() and ifile().
    [file.c]
    Tidy up add_to_fline() and make it void, as it cannot return an
    error. Remove FIOMEM code from add_to_fline()'s callers. [fileio.c]
    Add a comment in wrapper.c noting that any allocation errors
    immediately exit.

eval.c
file.c
globals.c
lock.c
main.c
pklock.c
edef.h
estruct.h
evar.h
    Make FILOCK a run-time option ($filock) rather than a compile-time
    one.

eval.c
evar.h
etc/uemacs.rc
    Allow hex input when setting $debug. [eval.c, evar.h]
    Prompt for $debug setting if no user arg in set-debug.
    [etc/uemacs.rc]

version.c
    Reformat output to indicate what is compiled in and what is the
    result of, possibly, dynamic libraries.

fileio.c
input.c
pklock.c
    For a STANDALONE (static) build, disable code related to getpwnam(),
    setpwent(), getpwent(), endpwent() and getpwnam().

utf8.c
    Just incorporate the reverse_string() code into unicode_to_utf8() as
    it is the only user.

Makefile
basic.c
bind.c
buffer.c
crypt.c
display.c
eval.c
exec.c
file.c
fileio.c
input.c
isearch.c
lock.c
main.c
names.c
pklock.c
posix.c
region.c
search.c
spawn.c
window.c
word.c
ebind.h
efunc.h
    Don't declare functions as external in efunc.h for the source file
    which defines them.
    Also:
      Define middle in getbind() to keep gcc's analyzer happy. [bind.c]
      Remove static from new_* vars in vtinit(). [display.c]
      Remove "#ifdef POSIX" test. Just enable the code. [posix.c]
      Remove -DPOSIX. [Makefile]
      Initialize arg1/2/3 in gtfun() for gcc's analyzer. [eval.c]

fileio.c
    Switch from using file stream I/O routines (fopen, fread, fwrite,
    fclose) to using file descriptor ones (open, read, write, close)
    as we do our own I/O buffering, and this also makes getting relevant
    error codes simpler.

display.c
file.c
fileio.c
input.c
main.c
random.c
    Simplify some string building (e.g. use sprintf).
    Also:
        Simplify readin() [file.c]

main.c
estruct.h
    Correct filock bits in quit() and tidy up. [main.c]
    Remove FILOCK definition. [estruct.h]

region.c
    Simplify narrow() by using r_endp to find out where the region ends.

main.c
    Fix a stack dump bug that has been there since 4.154!
    index_fp was being used in two places and closed prematurely.
    Tidied up the index_fp code, plus some other bits.

crypt.c
file.c
autostart/00-decrypt-file.sh
autostart/00-encrypt-file.sh
    Fix weak CRYPT!  NOTE!! Backwards incompatibility.
    Always repeat user encryption key to fill the key buffer, otherwise
    short keys may produce colliding results. [crypt.c]
    Update autotest files for modified encryption results.
    Remove the two myencrypt() call pairs in resetkey() as the
    result is to go back to where you started. [file.c]
    Simplify line count printing.   [file.c]

file.c
    Fix makename() so that it works for full paths again.

efunc.h
    Add extern free_lock() declaration for DO_FREE.

posix.c
    Use simple loop for small buffer shuffle, not memove.
    Fix (pending < expected) loop and explicitly initialize pending.

globals.c
exec.c
edef.h
    Make golabel local, not global, and avoid possible overlap of args
    in strcpy.
    Comment updates.

main.c
    Simplify typahead() code.
    Not all clear what the previous code actually did, so went by
    the comments.
    Comment updates.

----------

Some changes made whilst looking into the message-line/minibuffer interplay.

display.c
    Remove no_free arg from set_grapheme() and callers as it is now
    always False.
    Make updateline() return void rather than always returning TRUE.
    Just call mlerase() in mlwrite_ap, as it will do all we need.
    Always set mpresf = TRUE in mlwrite_ap().

input.c
    Remove unneeded mlerase() and mberase() calls.
    Comment update.

line.c
    Use spos, having defined it.

display.c
search.c
estruct.h
    Use new MD_EQVRPT define. [display.c]
    Use new MD_MAGRPT define. [search.c]

utf8.c
ebind.h
    Comment updates.

----------

Makefile
autotest/*.sh
tools/run_valgrind
    Added a vgcheck option to Makefile to run the test scripts under
    valgrind and produce per-test reports.

file.c
    Don't check for a line ending of <CR> if the line is empty.

autotest/arithmetic-tests.sh
    Set expected TOOBIG result to be 0 when using valgrind, as that
    seems to prevent the overflow being detected.

Makefile
autotest/run_all
    Mark clean test-clean check and vgcheck as .PHONY, so they will
    always run when asked. [Makefile]
    Allow individual tests to be run by specifying a LIST.
        make check LIST=arith
        make vgcheck LIST=arith
    [Makefile]
    The scripts in autotest matching *<LIST-item>*.sh will be run.
    [run_all]
    Make valgrind run in Verbose mode. [Makefile]
    Set HOME to . so that it doesn't run any user-specific start-up
    files. [Makefile]

file.c
    Correct loop limit in makename() for a pathname.

exec.c
main.c
    Add code (for DO_FREE) so that strdup()ed local variables can be
    freed when a script calls exit-emacs. Keeps valgrind happy. [exec.c,
    main.c]
    In docmd() only Xrealloc a line if extra space is needed. Turns out
    that realloc may move things even when you request a smaller space
    than that already allocated. [exec.c]

Makefile
tools/remove-tcap-bits.pl
tools/run_valgrind
    Added a script to remove the tcap-related entries from a valgrind
    log. [remove-tcap-bits.pl]
    Changed valgrind to add BEGIN/END markers around each block, for easy
    block finding. [run_valgrind]
    Added a vgstrip option for make. [Makefile]

names.c
random.c
efunc.h
    Added a simulate function, for use by test scripts to simulate user
    input.

exec.c
    Made pending_einit a level-based array, for valgrind testing.

eval.c
    Add a missing bytes_to_go decrement to ue_printf().

Makefile
    Added removing uemacs-dumps to test-clean, since HOME is now
    set to the current directory during tests.
    Keep backups when stripping valgrind logs, and delete them in
    test-clean.

autotest/dir-browsing.sh
    Added test file for directory-browsing.

autotest/dump_mc.debug
    Added comment about how to use it.
    Updated CCL printing to use BMBYTES not (now gone) HIBYTE.

search.c
    Correct the loop constraint in mcclear() so that group0 entries are
    cleared.
    For valgrind build, call mcclear() if mc_alloc is set.

eval.c
evar.h
    Added a &rin user function to find the last occurrence of a string
    within a string.
    Renamed internal sindex() function to strindex().

etc/uemacs.rc
etc/uemacs.hlp
    Updated file-hooks to use &rin to get the suffix, so allowing for
    filenames starting with . or ../. [uemacs.rc]
    Add &rin and update &sin arg description. [uemacs.hlp]

fileio.c
    Add a break rather than leave an empty case at the end of a switch.

utf8.c
    Remove the (now uncalled) reverse_bytes() function.

crypt.c
eval.c
globals.c
edef.h
estruct.h
evar.h
etc/uemacs.hlp
    Add various options to crypt mode to cover past algorithms.
    Add back various key_set methods (Fill63 and Raw) and running
    encryption ones (PrintingOnly and Mod95).  [crypts.c]
    (This undoes the earlier removal of optional PARANOID code
    while the "completely filled" code has been removed - we don't
    need another new option...).
    Add code for a new $crypt_mode variable. [eval.c, globals.c,
    edef.h, estruct.h, evar.h]
    NOTE: that there is NO default setting for $crypt_mode. If you wish
    to use the mode you need to set the one you want.

Makefile
    Unset HOME rather than setting it to ".".
    If a test fails and you use ^XC (i-shell) to look at things, bash
    will write its history file into the code directory.

utf8.c
utf8.h
    Added a glyphcount_utf8_array() function to count the grapehemes in
    a utf8 string.

eval.c
    Modify the &sin (strindex()), &rin (rstrindex()), &lef, &mid and
    &rig functions to count in graphemes, not bytes.

exec.c
globals.c
edef.h
    execlevel only used by exec.c
    Make static there and remove from global list.

main.c
    Set cryptflag (and nearby vars) to FALSE in their declaration.

file.c
    Add back the (required) four myencrypt() calls erroneously removed
    earlier.

eval.c
    If $crypt_mode is changed then any encryption key set for any buffer
    needs to be re-encrypted.

autotest/00-decrypt-file.sh
autotest/00-encrypt-file.sh
    Set the correct value for the new $crypt_mode variable in extended
    tests, and update the encrypted file contents to match what is now
    produced.  [00-decrypt-file.sh, 00-encrypt-file.sh]

etc/uemacs.hlp
    Updated for recent changes.
    Graphemes now used for &lef, &mid, &rig, &sin and &rin.
    Correct and extend Crypt section.

Makefile
    Update the test-clean code to handle new files from 00-en/decrypt.sh
    autotest scripts.

eval.c
globals.c
main.c
spawn.c
tcap.c
edef.h
estruct.h
evar.h
etc/uemacs.hlp
    Tidy up of some obsolete code and update help file accordingly.
    Removed unused $flicker variable.  [eval.c, globals.c, estruct.h,
    evar.h, uemacs.hlp]
    Removed unused $palette variable.  [eval.c, globals.c, estruct.h,
    evar.h, uemacs.hlp]
    Remove long-gone MAXCOL, MAXROW, CLRMSG and MEMMAP defines. [estruct.h]
    Actually set $rval from all system() calls. [spanw.c]
    Don't initialize eolexist and revexist as they will be set at runtime
    [globals.c]
    Remove unused nullflag variable. [globals.c, main.c, edef.h]
    Remove unused/unchanging $gflags variable and EVGFLAGS and GFREAD
    defines. [eval.c, globals.c, main.c, edef.h, estruct.h, uemacs.hlp]
    Remove unused FAILED define. [estruct.h]
    Remove no-longer relevant $sres variable. [eval.c, globals.c,
    tcap.c, edef.h, estruct.h, evar.h]
    Move INTWIDTH to eval.c (only user). [eval.c, estruct.h]

autotest/00-encrypt-file.sh
autotest/run_all
    Use $rval to test result of script comparison. [00-encrypt-file.sh]
    Better reporting and tidy up.

etc/uemacs.rc
    Add make-descr procedure and binding.

eval.c
main.c
names.c
random.c
    Use ARRAY_SIZE from util.h, since it is there.
    Add missing {} around the 'X' block command-line code. [main.c]

fileio.c
    Don't save first 100 bytes for later binary file check. Check it
    once we get them and just remember the result.

file.c
    Force the save of a file if numeric arg is given.

line.c
    Move sysmark fixups out of loops, as there is only one.

main.c
    Simplify macro_helper, and make it work for 0 in the process.
    Replace lnewline() calls with "\n" in following linstr() calls.

crypt.c
eval.c
file.c
globals.c
edef.h
etc/uemacs.hlp
    Add a global encryption key option to $crypt_mode, implement and
    document it.

random.c
estruct.h
    Add a GGR_LOW_LGCY bit setting to $ggr_opts. If set (default)
    leave-one-white does nothing if it has no spaces around it.
    If unset it will add a space.

random.c
    Allow simulate to work with a numeric arg.

autotest/wordwrap.sh
    Use simulate for space input and $ggr_opts setting, rather than
    fudging in a hard-wired effect.

bind.c
    Tidy up some code.

bind.c
display.c
spawn.c
efunc.h
    Replace mpluts calls with mlwrite_one and let mlwrite_ap check for
    recursion.

buffer.c
    Tidy up some code.

isearch.c
names.c
efunc.h
autotest/incremental-search.sh
autotest/query-replace.sh
    Implement a simulate-incr function for the test scripts.
    Modify incremental-search.sh and query-replace.sh to use it.
    This replaces the kludgy //incremental-debug usage.

exec.c
    Added a pending_whlist list to dobuf() for valgrind and
    re-organized DO_FREE code.

autotest/00-decrypt-file.sh
autotest/00-encrypt-file.sh
    Add a missing ! in an !endif statement.

exec.c
globals.c
edef.h
    Remove mstore(testing bstore produces the same result).
    Make bstore local to exec.c.
    Skip while list processing while storing a macro. [exec.c]
    Move the mis-placed search_ok setting in storeproc. [exec.c]

main.c
    Fix the standalone set_pathname() code to work if uemacs
    is found along the path, and use an etc/ subdir of the
    location, not the locaton itself.

fileio.c
input.c
    Increase buffer sizes to stop sprintf overflow warning in gcc 8.4.0.

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Updated help file.
    Update to GGR4.171

DO NOT USER GGR4.171 - it has a seriosu BUG when writing out files.

========== GGR4.172

fileio.c
    Add a missed O_TRUNC when opening files for writing.

random.c
estruct.h
etc/uemacs.hlp
    Remove GGR_LOW_LGCY bit from $ggr_opts and use numeric args to
    leave-one-white and white-delete instead.

line.c
    Fix lover() to work with graphemes, not bytes.
    Removed lowrite(), as it is no longer used.
    Remove unneeded % from start of some error messages.

main.c
window.c
    Remove unneeded % from start of some error messages.

autotest/arithmetic-tests.sh
autotest/combi-col0.sh
autotest/incremental-search.sh
autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/query-replace.sh
autotest/search-boundaries.sh
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-magic-on_off.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
autotest/xlate.sh
autotest/zero-length-magic.sh
    Modified to use awk if perl is not available (for busybox systems).

eval.c
    Fix the &len function to return graphemes, not bytes.

random.c
    Fix the force-True code for leave-one-white.

autotest/misc-bits.sh
    Add a new test file for simple checks of:
        numeric args to leave-one-white and white-delete
        file truncation on write-out
        overwrite-string

Makefile
main.c
version.c
    Do not allow STANDALONE on FreeBSD/Sun as they have no static libs.
    Allow STANDALONE=most (only libm and libc are dynamic, allows use of
    ~id) and STANDALONE=all (all static libs - no use of ~id). [Makefile]
    Only leave Linux code in the #ifdef STANDALONE code section to set
    start-up file location to <image-dir>/etc. [main.c]
    Handle dynamic/static for utf8proc and libc separately. [version.c]

../CHANGES
../README
version.h
    Update to GGR4.172

========== GGR4.173

region.c
    Set the end pointer when making a region with dot and mark on the
    same line.
    Prevent narrowing of an empty buffer.

utf8.c
combi.h
tools/combi-class.c
tools/combi.h
tools/combi.info
    Change combining_type() to do a quick range test first, then a
    binary chop on the list if required.
    Modify combi-class.c to not append the no longer required
    UEM_NOCHAR entry and regenerate its files.

eval.c
    Make &sin and &rin return 0 when asked to look for an empty string.

utf8.c
    Check for offset getting too big in next_utf8_offset().

etc/uemacs.rc
    Add a .rctmp omitted in the last change to file-hooks.

line.c
utf8.c
line.h
utf8.h
    Don't declare functions as external in *.h for the source file
    which defines them.

main.c
search.c
efunc.h
    Move getfence() and insbrace() to main.c, so they can share their
    search algorithm with fmatch().
    Mark insbrace() as static. [main.c]
    Add brkt_search() as the common search code for insbrace(),
    getfence() and fmatch(). [main.c]
    Use nanosleep() to get a sub-second match time. [main.c]

eval.c
file.c
    Change code to reflect next_utf8_offset() now returns -1 when offset
    is too large.

eval.c
globals.c
main.c
tcap.c
edef.h
estruct.h
evar.h
etc/uemacs.hlp
    Add $brkt_ms as a configurable delay (in ms) for the bracket
    matching highlight delay. Default is 200ms.
    Removed tpause/EVTPAUSE/term.t_pause (which did nothing).

----------
Some small function-to-#define or inline code changes that make the
executable smaller.

eval.c
    Change ltos() and ue_atoi() into #defines.
    Expand ernd code inline at its only use location.

utf8.c
utf8.c
    Change some utf8 length functions into #defines.

buffer.c
efunc.h
    Change addline_to_curb() and addline(() into #defines.

display.c
    Change is_space(), vtmove(), TTput_1uc_lim() and mlputi() into
    #defines.

exec.c
    Change use_pttable() into a #define.

input.c
    Change getfbuffer() and getfname() to #defines.

lock.c
    Change lckerror() to be a #define.

spawn.c
    Change get_orig_size() to a #define and inline rtfrmshell().

exec.c
    Make the pending_einit and pending_whlist arrays into linked lists
    so we no longer need to limit their length.

eval.c
exec.c
    Use mlforce_one() for some macro debug output so that % isn't
    wrongly evaluated.

----------
Initial code to add per-macro (actually per-executable buffer) pins.
These are marks that only exist for, and only are visible to, a level
of executing buffer. They cease to exist when the buffer finally ends
execution.
pins can refer to any buffer.

buffer.c
exec.c
globals.c
line.c
names.c
region.c
edef.h
efunc.h
line.h
autotest/misc-bits.sh
    Move linked_items definition and add macro pin structures,
    [exec.c, edef.h]
    Remove any pins in a buffer if it is deleted. [buffer.c]
    Add drop_pin(), back_to_pin() and switch_with_pin() code and DO_FREE
    handling code for the pin linked list. [exec.c, efunc.h]
    Define/declare macro_pin_headp. [globals.c,
    Add routines to edit pin values as characters are inserted/deleted.
    [line.c]
    Add back-to-pin, drop-pin and switch-with-pin calls. [names.c]
    Add code to edit pin values on casechange, Moved the mark/dot fixing
    logic into this. [region.c]
    Added an ltext #define for short (text) code to access l_text.
    [line.h]
    Change set-mark/exchange-point-and-mark to drop-pin/back-to-pin.
    [autotest/misc-bits.sh]

basic.c
buffer.c
display.c
eval.c
exec.c
file.c
fileio.c
input.c
line.c
main.c
random.c
region.c
search.c
word.c
line.h
    Added an lsize #define for short (text) code to access l_size.
    and renamed llength to lused. [line.h]
    Change all code to use ltext/lused/lsize #defines [*.c]

word.c
    linsert_byte(1, c) in loop changed to linsert_byte(n, c) call.

etc/uemacs.rc
    Allow make-descr (optionally) to justify and preserve leading
    white-space.
    Change expand-envvar to use drop-pin to preserve mark.

basic.c
    Combine the forwline() and backline() code into an internal
    move_n_lines() function with front-ends.

eval.c
file.c
globals.c
input.c
main.c
edef.h
    Remove saveflag setting for EVTARGET ($curgoal) reading and set
    CFCPCN bit in thisflag on setting EVTARGET. [eval.c]
    Removed global saveflag. It is only meant for temporary local
    saving. [globals.c, input.c, main.c, edef.h]
    Rename save_lastflag to saveflag for consistency [file.c]

file.c
    Use arg of 2 to tell kill-region call not to save text to the kill
    ring, rather than temporarily having to fudge in CFYANK to lastflag.

buffer.c
    Improve comments in addline_to_anyb().

basic.c
eval.c
exec.c
file.c
globals.c
input.c
line.c
main.c
names.c
random.c
region.c
word.c
edef.h
estruct.h
    Generalize the test as to the nature of the previous command for
    up/down moves, yanks and kills.  Replaced thisflag and lastflag with
    the single comflag and a set of per-command mask to denote which
    settings may remain after each command.
    CFCPCN setting in move_n_lines(). [basic.c]
    CFCPCN setting when $curgoal set. [eval.c]
    com_flag masking in docmd(), namedcmd(). [exec.c]
    Remove flag saving. [file.c]
    Replace thisflag and lastflag with comflag. [globals.c, edef.h]
    Remove flag saving. Clear com_flag on minibuffer prompt. [input.c]
    thisflag changed to com_flag. [input.c, random.c]
    Remove thisflag and lastflag. com_flag masking in execute(). [main.c]
    Add the keep_flags initializers. [names.c]
    this/lastflag to com_flag. [region.c, word.c]
    Add keep_flags to struct name_bind and extend CF* #defines. [estruct.h]

exec.c
names.c
    Make the inclusion of the no-longer needed numbered macro buffer
    dependent on defining NUMBERED_MACROS (off by default).

autotest/00-decrypt-file.sh
    Use different encryption keys for the different parts, and
    delete the TEST buffer, rather than just emptying it.

autotest/report-status.rc
    Use drop-pin/back-to-pin to save/return to test buffer.

Makefile
    Reworked to allow removal of the me-specific ANDROID option.
    make STANDALONE=all X_OPTS="-DSDIR_SKIP=7" now works for this.

random.c
    Combine forwdel() and backdel() code.
    Unset the kill flag for a default argument.
    Make backdel() work if it would go back before the start of file
    (in the way that forwdel() works if it would go beyond end-of-file).

etc/uemacs.hlp
    Updated to mention pins, to note that numbered macros no longer
    exist by default and other minor changes.

utf8.c
    Correct the end range in combining_type() to be the last end not the
    last start.

evar.h
version.c
    Corrections to comments.

../CHANGES
../README
version.h
    Update to GGR4.173

========== GGR4.174

region.c
    Fixes for region ending at start of line and also for mark and dot
    being in the same place.

Makefile
    Let Arm64 use backtrace code and correct a typo in the /opt/ setting.

basic.c
bind.c
    Minor simplification.

buffer.c
    Create new struct buffer by copying from a template.

crypt.c
file.c
    Change code to use klen not *klenp. [file.c]
    Update comments to indicate *klenp/klen difference. [crypt.c, file.c]

display.c
    Change clone_grapheme to be a #define.
    Use show_utf8() not a loop to display msg.

isearch.c
    Change strdup to Xstrdup.

exec.c
    Free the item data when removing a pin.

bind.c
buffer.c
main.c
search.c
utf8.c
window.c
word.c
wrapper.c
efunc.h
    Add Xfree_setnull(), a define to call a function that frees, then
    sets the variable to NULL.

bind.c
buffer.c
display.c
eval.c
file.c
fileio.c
main.c
random.c
wrapper.c
efunc.h
estruct.h
    Make the b_fname and b_bname files in struct buffer dynamically
    allocated.  [buffer.c, estruct.h]
    Added update_val_func() [wrapper.c, efunc,h]
    Added update_val(), a define to call a function (that reallocs and
    updates a dynamic variable. [efunc.h]
    Replace strcpy() with update_val() [buffer.c, eval.c, file.c,
    fileio.c, main.c]

buffer.c
crypt.c
estruct.h
    Make b_key in struct buffer dynamically allocated.

bind.c
display.c
eval.c
input.c
line.c
main.c
names.c
search.c
utf8.c
word.c
wrapper.c
    Remove (unneeded) test for NULL ptr before calling Xfree*.

bind.c
buffer.c
eval.c
exec.c
file.c
fileio.c
input.c
isearch.c
line.c
main.c
random.c
search.c
spawn.c
utf8.c
estruct.h
    Added a terminate_str macro to replace "str = '\0'" constructs.

utf8.c
    Enlarge some temporary buffers to avoid spurious gcc 12.2.0 warnings
    on Arm64.

main.c
    Unset com_flag if we are about to self-insert, as none of the bits
    remain valid for that.

../CHANGES
../README
version.h
    Update to GGR4.174

========== GGR4.174

file.c
    In handle_filehooks() don't run a suffix-specific file if we've
    actually found ./xxx.

buffer.c
eval.c
fileio.c

Fixes for fixup_* routines expanding the called path arg "in place",
which causes a problem for the malloc'ed b_fname, which is now only as
large as it needs to be.

    In make_active(), copy buffer's filename to a maxlen temp var for
    readin(), as it may get expanded. [buffer.c]
    fixup the arg before calling fexist() for UFEXIST. [eval.c]
    Remove the fixup_fname() calls from ffropen(), ffwopen() and
    fexist(). [fileio.c]

.gitignore
    Added VG-*, autotest.tfile, uetest.rc.

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Update to GGR4.175

========== GGR4.176

globals.c
edef.h
    Define some vars with their real dimension as defined in edef.h (not
    []).  Avoids warnings for a TinyCC compilation. [globals.c]
    Re-organize code so that globals.c does see the extern declarations
    of things it is defining. [globals.c, edef.h]

region.c
estruct.h
    Remember the end offset of a region and change narrow() to check
    this (not doto) when checking the end of a region.

eval.c
version.c
    Avoid "function might return no value" with TinyCC. [eval.c]
    Cater for TinyCC compilation in version(). [version.c]

line.c
    Update window top-line if we insert a <CR> into an empty buffer.
    Fixes a display bug created by the line text change of GGR4.171.

Makfile
    Change STANDALONE test so that it works properly.

buffer.c
estruct.h
    Add a real pathname field to struct buffer and set NFILEN to
    PATH_MAX+1

bind.c
    Set b_rpname to "" for help file.

eval.c
exec.c
file.c
fileio.c
input.c
main.c
efunc.h
    Change fixup_fname() and fixup_full() to return the modified value,
    not change the arg in-place. [fileio.c, efunc.h]
    Change fixup_fname() and fixup_full() calls to reflect the change.
    [eval.c, exec.c, file.c, input.c, main.c]

file.c
    Change the buffer-loop test in getfile() to check for the realpath
    (unique) not the user-given path. [file.c]

globals.c
main.c
edef.h
    Add a udir structure to hold current, parent and home paths.
    Initialized at start-up.

spawn.c
    Use udir.home in place of getenv("HOME") in pipecmd().

bind.c
display.c
fileio.c
main.c
spawn.c
    Replace getenv(HOME or PWD) with udir element use.

file.c
    Make get_realpath() return input arg if it fails.
    If filewrite() succeeds, update b_rpname with the realpath.

estruct.h
    Set PATH_MAX to 4096 if it isn't already defined.

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Update to GGR4.176

========== GGR4.177

file.c
fileio.c
efunc.h
    Move the fixup_* functions from fileio.c to file.c.

globals.c
main.c
edef.h
    Save the string lengths once, in udir.

file.c
    Try to use ., .. or ~ to shorten get_realpath result.

eval.c
file.c
fileio.c
main.c
efunc.h
    Add a set_buffer_filenames() function [file.c, efunc.h]
    Use set_buffer_filenames() to set both b_fname and b_rpname.
    [eval.c, file.c, fileio.c, main.c]

file.c
    Changed a "start; while(test); next" loop to a for loop [file.c]

display.c
eval.c
random.c
window.c
efunc.h
    Change upmode() to take a parameter. If defined, only update
    modelines on windows containing that buffer. [display.c, efunc.h]
    Use upmode() to set WFMODE on relevant variable changes. [eval.c]
    Add NULL arg to existing upmode() calls. [random.c, window.c]

buffer.c
    Added conditional (SHOW_RPNAMES) code to display the b_rpname of
    buffers - ONLY for debug/test usage.

file.c
efunc.h
    Made get_realpath() non-static and removed (no longer relevant)
    check for testp in getfile().

main.c
    Check for a unique b_rpname when setting up files from the command
    line.
---
    Recent changes means that the b_rpname is a unique identifier for
    the file contained in a buffer. It can be "foiled" by renaming
    things after they've been read in, but it is correct for every file
    write.
---

tools/read-speed.sh
    A simple script to determine the reading speed of uemacs in
    lines/sec. Very basic....

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Update to GGR4.177

========== GGR4.178

Makefile
    Added XCFLAGS to CFLAGS, for adding compiler options on the
    make command-line.

file.c
main.c
    Handle bare "/" in udir entries in get_realpath(). [file.c]
    Initialize udir.hlen if no HOME found. [main.c]

buffer.c
eval.c
efunc.h
    Don't rename a buffer to an existing name.
    Add a set_buffer_name() function. [efunc.h, buffer.c]
    Use set_buffer_name() to change b_bname. [buffer.c, eval.c]

fileio.c
    Move the check_for_file() code into ffropen() - the only user.

file.c
    In getfile(), report if >1 buffer with the same path is found and go
    to the first.

buffer.c
    In make_active() remove local copy of b_fname, as readin() will no
    longer change it.

Makefile
    Change XCFLAGS to be added to the end of CFLAGS.
    Added XLDFLAGS (for LDFLAGS) and XDEFINES (for DEFINES) augmenting.

eval.c
    Ensure that trying to set any read-only system variables returns an
    error.

input.c
    Use mberase() not mlerase() after displaying choices.
    Otherwise we get leading blanks in the prompt on redraw after
    choices.

../CHANGES
version.h
etc/uemacs.hlp
etc/uemacs.rc
    Updated system variables descriptions for read-only status. [uemacs.hlp]
    Update to GGR4.178

========== GGR4.179

etc/uemacs.rc
    Add cpp and c++ to C-Mode file-hooks.

Makefile
    Add -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 to options for
    compilation on 32-bit systems.
    Set UTF8INCL for UTF8=syslocal.

buffer.c
display.c
input.c
line.c
random.c
region.c
word.c
estruct.h
line.h
utf8.h
    Define a uemacs-specifc 8-byte integer type (uelen_t). [utf8.h]
    Use uelen_t to count bytes in file. [buffer.c]
    Use uelen_t in struct region. [region.c, word.c, estruct.h]
    Use uelen_t in ldelete() and ldelgrapheme() [input.c, line.c,
    random.c, line.h]
    Change mlputli to use %ll as the formnat (needed for the "long long"
    type used in uelen_t). [display.c]

main.c
    Change the stack-dump code to use ftello/fseeko and off_t (not
    ftell/fseek and long).

random.c
    Fix chardel() to delete the correct amount for backward deletion of
    multi-byte characters.
    [Bug introduced in GGR4.173]

autotest/run_all
    Correct passing on of any pattern argument.

autotest/char-deletion.sh
    Add test to check for multi-byte backwards/fowards character deletion.

display.c
    Change %D arg type to uelen_t in mlwrite_ap()

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.179

========== GGR4.180

search.c
etc/uemacs.hlp
    Fix delins() to insert the text it is passed, not try to run through
    any magical replace code again (which will fail for group matches as
    we've deleted text in the buffer).
    Save last_match.mline directly, since we no longer reallocate line
    structures. [search.c]
    Allow buffer variables (.xxx) in replace strings.
    Document the MAGIC mode replacement string interpolators (${$var},
    ${%var}, ${.var} and ${n}). [uemacs.hlp]

search.c
etc/uemacs.hlp
    Add an auto-incrementing counter for the replace string in Magic
    mode (${@:start=m,incr=n,fmt=%..d}). [search.c]
    Document the counter in help. [uemacs.hlp]

eval.c
estruct.h
evar.h
    Add $proc_type, to allow scripts to test for processor type.

file.c
edef.h
    Move the strdupa definition (for FreeBSD) from file.c to edef.h.
    (Also now needed by search.c.)

buffer.c
display.c
eval.c
input.c
line.c
region.c
word.c
estruct.h
line.h
utf8.h
autotest/arithmetic-tests.sh
etc/uemacs.hlp
    Use 64-bit integers internally for integers used by macros.
    Change defining uelen_t to defining ue64I_t [utf8.h]
    Change uelen_t to ue64I_t [buffer.c, display.c, eval.c, exec.c,
    input.c, line.c, random.c, region.c, word.c, estruct.h, line.h]
    Use ue_atoi() (which now uses strtoll()) for ASCII to number
    conversion. ue_itoa() now uses 64-bit integers. [eval.c]
    Update &ptf documentation about integer precision [uemacs.hlp]
    Change TOOBIG handling under valgrind [arithmetic-tests.sh]

search.c
etc/uemacs.hlp
    Allow function calls in magic replacement patterns (${&...}).
    brace_text() is now given the buffer to fill.
    Call rmcclear() in free_search(). [search.c]
    Document this. [uemacs.hlp]

search.c
    Add an internal function to create a new, empty func_call item in
    one place.

autotest/search-magic-replaces.sh
    Add a test script for magic replacements (groups, counters and
    function calls).

search.c
    Initialize rmcpat[0] in init_search_ringbuffers() (now that
    free_search() calls rmcclear().
    Free all allocated func_call items (correctly) in rmcclear().

exec.c
file.c
input.c
lock.c
    Some tidy up around fixup_fname() based on the arm64 valgrind
    report.
    Add comment about OK to use fixup_fname() in readin() call in
    dofile(). [exec.c]
    In fixup_full() always copy the incoming name to the internal
    buffer, as it might actually be in fixup_fname()'s buffer and
    calling it means strcpy() will be copying to itself. [file.c]
    Add comment that getffile() using the fixup_fname() result directly
    is OK, but use strcpy() to put the fixup_fname() result back into
    callers buffer in comp_file(). [input.c]
    Actually copy fixup_fname() result into tmpname. [lock.c]

autotest/00-decrypt-file.sh
autotest/00-encrypt-file.sh
autotest/arithmetic-tests.sh
autotest/char-deletion.sh
autotest/check-group.rc
autotest/check-matchcount.rc
autotest/check-position-match.rc
autotest/check-position-matchlen.rc
autotest/check-position.rc
autotest/combi-col0.sh
autotest/dir-browsing.sh
autotest/incremental-search.sh
autotest/misc-bits.sh
autotest/move-over-word.sh
autotest/multi-ex.sh
autotest/parafill.sh
autotest/query-replace.sh
autotest/search-boundaries.sh
autotest/search-char_classes.sh
autotest/search-classes_in_closures.sh
autotest/search-file-start.sh
autotest/search-groups.sh
autotest/search-line-endings.sh
autotest/search-magic-on_off.sh
autotest/search-magic-replaces.sh
autotest/search-no_magic.sh
autotest/search-props.sh
autotest/search-props2.sh
autotest/search-reexec-macro.sh
autotest/search-repeats.sh
autotest/search-u_hex.sh
autotest/wordwrap.sh
autotest/xlate.sh
autotest/zero-length-magic.sh
etc/uemacs.rc
etc/uemacs.hlp
    Replace execute-procedure with the equivalent run.
    Add run as synonym for execute-procedure [uemacs.hlp]

input.c
search.c
efunc.h
    Add, and use, evaluate_cmdstr() to evaluate a string as a command.
    NOTE that we now loop over ALL of the command line.

autotest/arithmetic-tests.sh
    Use hex (and &bli) for MAX and MIN 64-bit integer values.
    With a workaround....

tools/remove-lowlevel-bits.pl
Makefile
    Rename remove-tcap-bits.pl to remove-lowlevel-bits.pl and change
    it to remove low-level valgrind blocks (for Freebsd).

search.c
    Increase size of internal buffers in expandp() and readpattern()
    to avoid overwrites.

../CHANGES
version.h
etc/uemacs.hlp
    Update to GGR4.180

========== GGR4.180

exec.c
    Correct a strcmp() call to strncmp() in the PTT caseset code.

line.c
region.c
word.c
    Fix upper/lowercase-region, which would always crash because of
    incorrectly trying to update sysmark.
    Inline onmodify_*() routines - each was only ever used once [line.c]
    For casechange_region() just loop through the  region calling
    ensure_case() [region.c]
    Update pins if required in ensure_case(). [word.c]

autotest/check-position-match.rc
    Renamed to check-position-char.rc (it does no matching) and updated
    users of it accordingly.

autotest/check-position-char.rc
    Deleted, on realizing it is exactly the same as check-position.rc,
    and updated callers.

word.c
    Remove marks/pin updates from ensure_case() as lputgrapheme() and
    ldelete() do them.

efunc.h
line.c
region.c
word.c
    Fix upper/lowercase-region to work with characters that have
    differing numbers of bytes in the two cases, and correct pin and
    mark handling.
    ensure_case() now returns any difference in the byte-count resulting
    from the case change. [efunc.h, word.c]
    Only update (sys)mark if after dot in linsert_byte() [line.c]
    Remember to set r_foffset in a region for the 1-line case.
    Adjust r_foffset loop limit after ensure_case() call when on the
    final line in casechange_region() [region.c]

autotest/casechange.sh
    Add simple tests for case changing a region.

exec.c
region.c
word.c
    Modify ensure_case() to do forw_grapheme() at its end [word.c]
    Remove forw_grapheme() from its callers. [exec.c, word.c, region.c]

eval.c
exec.c
globals.c
edef.h
evar.h
etc/uemacs.hlp
    Add a function (&ptx) to expand a phonetic translation table entry.
    [eval.c, evar.h]
    Set flag in ptt_handler() to indicate whether the final newline is
    "real". [exec.c, globals.c, edef.h]
    Document this [uemacs.hlp]

display.c
    If getscreensize() can't get the screensize, just exit.

word.c
    Fixes to fillpara() to prevent wrap-around at end of file.
    Only indent if there is more text to handle.
    Don't move forward if we are on last line of file.

eval.c
    Fix the gathering loop in ptt_expand().

eval.c
exec.c
main.c
efunc.h
estruct.h
etc/uemacs.hlp
    Fixes to caseset options.
    Add option to retain added final char in ptt_handler and modify
    callers. [eval.c, main.c, exec.c, efunc.h]
    Prevent newline in the from part of a ptt entry. [exec.c]
    Save the grapheme count of the replacement text. [exec.c]
    Rewrite the case editing for replacement text. [exec.c]
    Update the caseset description in help. [uemacs.hlp]

autotest/ptt_tables.sh
    Add tests for ptt entries.

autotest/parafill.sh
    Add test to check for no wrapping to start of file if last line is
    overlong.

basic.c (comment typo)
version.h
    Update to GGR4.181

========== GGR4.182

display.c
global.c
main.c
edef.h
tools/read-speed.sh
    Add a -P option to pretend we have an 80x24 display and redirect
    stdout to /dev/null, so we can run the read-speed.sh script.

autotest/*.sh
    Fix comment typo [all]
    Changes to TOOBIG test. (Needs more work!!!) [arithmetic-tests.sh]
    Remove unneeded $debug settings. [00-encrypt-file.sh]
    Correct test to use the line that corresponds to the test name.
    [casechange.sh]
    Improve test descriptions, and set 0x07 correctly.
    [incremental-search.sh]

exec.c
names.c
    Only define storemac() if NUMBERED_MACROS is set. [exec.c, names.c]
    In storeproc() only check for numeric argument if NUMBERED_MACROS is
    set. [exec.c]

input.c
posix.c
    Change two mlwrite(NOMATCH) calls to mlwrite_one(NOMATCH).
    Change &tobuf[0] to tobuf in setbuffer() call. [posix.c]

----------------------------------------
Major change to remove NFILEN, NLINE, NSTRING and NBUFN limits with
dynamic buffer allocation.

NPAT moved to search.c.
NPAT changed to NKEY for crypt usage.

dyn_buf.c
dyn_buf.h
Makefile
    New routines added for dynamic buffer usage

basic.c
bind.c
buffer.c
crypt.c
display.c
edef.h
eval.c
exec.c
file.c
globals.c
input.c
isearch.c
line.c
lock.c
main.c
random.c
search.c
spawn.c
utf8.c
word.c
efunc.h
estruct.h
    Code modified to use dynamic buffer calls.
    Buffer display name in modeline now abbreviated if it won't fit.

----------------------------------------

eval.c
autotest/arithmetic-tests.sh
    Correct return value setting for UFR2I case. [eval.c]
    Reinstate original TOOBIG test code. [arithmetic-tests.sh]

dyn_buf.c
dyn_buf.h
    Add a type to struct db and use it to decide whether to add/allow
    for a terminating NUL char.

line.c
line.h
    Use a BUF db for the line buffer. [line,c]
    Rework the lused/ltext etc #defines to use this. [line.h]

basic.c
bind.c
buffer.c
crypt.c
display.c
eval.c
exec.c
file.c
fileio.c
globals.c
input.c
isearch.c
main.c
random.c
region.c
search.c
spawn.c
utf8.c
word.c
    Modify the rest of the code to fit with the line.c/dyn_buf.c
    changes.

----------

*.c
dyn_buf.h
edef.h
efunc.h
line.h
utf8.h
    Change the db_* dynamic buffer access macros to be const and update
    the function prototypes etc.  to handle this.  To avoid attempts to
    change these without going via the dyn_buf.c/h code.
    Tidied up comment alignment as well.

Additional changes/fixes along the way.

dynbuf.c/h
    Add db_truncate()
    Add db_overwrite()

eval.c
    In ue_printf(), fix %p handling.

random.c
    In twiddle, use db_overwrite to add new byte order.

version.c
    Display unknown version for libc if it cannot be determined.

-----
autotest/dump_mc.debug
    Moved to ../tools/dump_mc.debug

buffer.c
    Free line text correctly in free_buffer() now we use BUF db for the
    line buffer.

search.c
wrapper.c
efunc.h
    Added const to return value for group_match(). [search.c, efunc.h]
    Declare die() as static. [wrapper.c]
    Removed non-existent rtfrmshell() declaration. [efunc.h]
    Made cbuf* declarations conditional on NUMBERED_MACROS. [efunc.h]
    Ordered all extern declarations in the order they occur in their
    source file. [efunc.h]

tools/dump_mc.debug
    Add ptr to structure to dump to DUMP_MATCH and DUMP_REPLACE.

input.c
    Fix filename generating in getnfile().

search.c
    Fix group handling to work for choices and nested/multiple groups.
    Replace repl with a dynamic buffer and remove append_to_repl_buf().

search.c
    Remove NGRP limit by dynamically allocating structures.

main.c
random.c
search.c
    Tidy up using lgetc value as a char - it no longer masks with 0xFF.

search.c
dyn_buf.h
tools/dump_mc.debug
    Remove NPAT limit by dynamically allocating structures.
    Add dbp_dcl() define. [dyn_buf.h]
    Update first procedure comment [dump_mc.debug]

eval.c
    Terminate gtkey bytes.

search.c
tools/dump_mc.debug
    Use index of entries, not pointers, in mcpat linking.
    A realloc can move things around.

autotest/search-magic-replaces.sh
    Add more tests, including nested group replacement.

search.c
    Free (r)mcpat after calling (r)mcclear() in free_search().
    Change skip_choices definition for FreeBSD (clang compiler).
    It doesn't like a label on a definition.

autotest/search-magic-replaces.sh
    Add a test to ensure group info is reallocated.

etc/uemacs.hlp
version.h
README
    Update to GGR4.182

========== GGR4.183

display.c
eval.c
random.c
search.c
    Fixes for dynamic buffer changes, missed in GGR4.182.
    Differentiate between last displayed buffer name and last actual
    buffer name in get_buffer_display_name(). [display.c]
    Use db_val_nc() in various places to ensure we end up with "", not a
    NULL pointer. [eval.c, search.c]
    Use correct buffers in twiddle(). [random.c]
    Fix prompt string in new_prompt. [search.c]

eval.c
file.c
    Return b_rpname for EVCFNAME. [eval.c]
    Use a shortened value for fname (if possible) in
    set_buffer_filenames() [file.c]

random.c
    Fix kill on last line in file

eval.c
    Fix UFR2I code to use consistent double size.

search.c
    Fix group invalidation on amatch() failing.
    Wipe out next_choice_idx at start of each search.
    Set mc_alloc in cclmake().

autotest/search-magic-replaces.sh
    Add a test for second group matches second choice.

file.c
    Fix inverted logic in set_buffer_filenames().

bind.c
buffer.c
display.c
file.c
main.c
random.c
spawn.c
estruct.h
    Changes to use b_rpname not b_fname for file manipulation as the
    latter is for display and may now be ~/name.
    Renamed b_fname to b_dfname [all]
    Take copy of fname for set_buffer_filenames() to avoid realloc() and
    copy-to-self issues. [file.c]
    Rename fn_expd to l_fn_expd in fixup_full() to avoid confusing the
    otherwise file-wide and local name clash. [file.c]
    Make filesave() and readin() use b_rpname. [file.c]
    Make crash saving use b_rpname. [main.c]

autotest/arithmetic-tests.sh
    Set TOOBIG to work for valgrind on FreeBSD and Solaris in
    Virtualbox.

eval.c
    Fix TKARG handling in getval().
